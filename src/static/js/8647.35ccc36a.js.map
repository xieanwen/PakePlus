{"version":3,"file":"static/js/8647.35ccc36a.js","mappings":"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","sources":["webpack://daili/./src/components/order-management/create-order/product-detail/message-type-service.vue?bade","webpack://daili/./src/components/order-management/create-order/product-detail/message-type-service.vue","webpack://daili/./src/components/order-management/create-order/product-detail/message-type-service.vue?650a"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode } from \"vue\"\n\nconst _hoisted_1 = { class: \"product-detail\" }\nconst _hoisted_2 = { class: \"service-specs\" }\nconst _hoisted_3 = { class: \"purchased-list\" }\nconst _hoisted_4 = { class: \"word\" }\n\nimport { computed, onMounted, reactive, shallowRef } from \"vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\n\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomCheckboxButtonGroup from \"@components/common/custom-checkbox-button-group.vue\";\r\nimport BaseSumPrice from \"@components/order-management/create-order/product-detail/base-sum-price.vue\";\r\n\r\ninterface InitDataType {\r\n  typeGroupValues: string[];\r\n  typeGroupList: Record<string, any>[];\r\n  buyNum: number | null;\r\n  buyList: Record<string, any>[];\r\n  buyCustomNum: number;\r\n}\r\n\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'message-type-service',\n  props: {\n    productData: {},\n    purchasedData: {}\n  },\n  setup(__props: any) {\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { serviceCode, companyId, profileId } = routeQuery.value;\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = __props;\r\n\r\nconst initData = reactive<InitDataType>({\r\n  typeGroupValues: [],\r\n  typeGroupList: [],\r\n  buyNum: null,\r\n  buyList: [],\r\n  buyCustomNum: 1,\r\n});\r\n\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\n\r\n// 购买信息\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n// 所有信息\r\nconst productInfo = computed(() => {\r\n  return props.productData;\r\n});\r\n\r\n// 服务基本信息\r\nconst serviceInfo = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n\r\n// 增值服务\r\nconst addedServiceList = computed(() => {\r\n  return productInfo.value?.addedServiceList;\r\n});\r\n\r\n// 数量信息\r\nconst countInfo: Record<string, any> = computed(() => {\r\n  const { specsList = [], miniNum = 1 } = addedServiceList.value[0];\r\n  const groupValues = specsList.map((item) => item.groupValues) ?? [0];\r\n  const maxNum = Math.max.apply(null, groupValues);\r\n  const minNum = Math.min.apply(null, groupValues);\r\n  return {\r\n    maxNum,\r\n    minNum,\r\n    increaseNum: miniNum,\r\n  };\r\n});\r\n\r\n// 最终购买数量\r\nconst finalCount = computed(() => {\r\n  return initData.buyNum === -1 ? initData.buyCustomNum : initData.buyNum;\r\n});\r\n\r\n// 购买总计\r\nconst buyTotalList = computed(() => {\r\n  const totalServiceList = addedServiceList.value.filter((item) =>\r\n    initData.typeGroupValues.includes(item.addedServiceCode)\r\n  );\r\n  return totalServiceList.map((item) => {\r\n    const purchasedList = purchasedInfo.value ?? [];\r\n    const { specsList, addedServiceCode } = item;\r\n    const preBuyCount =\r\n      purchasedList.find((item) => item.consumptionTypeCd === addedServiceCode)\r\n        ?.resourceCount ?? 0;\r\n    const totalCount = new BigNumber(preBuyCount)\r\n      .plus(finalCount.value)\r\n      .toNumber();\r\n    return specsList.find((specs) => {\r\n      return specs.minNum <= totalCount && totalCount <= specs.maxNum;\r\n    });\r\n  });\r\n});\r\n// 购买规格描述\r\nconst specsDescribe = computed(() => {\r\n  return buyTotalList.value.reduce((pre, item) => {\r\n    const addedInfo = addedServiceList.value.find(\r\n      (added) => added.addedServiceCode === item.serviceCode\r\n    );\r\n    return (\r\n      pre +\r\n      `${addedInfo?.addedServiceName}：${finalCount.value}${serviceInfo.value.unit}；`\r\n    );\r\n  }, \"\");\r\n});\r\n\r\n// 购买单价总计\r\nconst totalPriceTip = computed(() => {\r\n  return buyTotalList.value.reduce((pre, item) => {\r\n    const addedInfo = addedServiceList.value.find(\r\n      (added) => added.addedServiceCode === item.serviceCode\r\n    );\r\n    return (\r\n      pre +\r\n      `${addedInfo?.addedServiceName}：${item?.unitPrice}元/${serviceInfo.value.unit}；`\r\n    );\r\n  }, \"\");\r\n});\r\n\r\n// 合计描述\r\nconst sumDescribe = computed(() => {\r\n  let totalPrice = 0;\r\n  const buyTipList = buyTotalList.value.map((item) => {\r\n    const addedInfo = addedServiceList.value.find(\r\n      (added) => added.addedServiceCode === item.serviceCode\r\n    );\r\n    const remainingDay = purchasedInfo.value.find(\r\n      (buyItem) => buyItem.consumptionTypeCd === item.serviceCode\r\n    )\r\n      ? \"剩余天数365 / 一年365天 x \"\r\n      : \"\";\r\n    totalPrice += new BigNumber(item?.unitPrice ?? 0)\r\n      .times(finalCount.value)\r\n      .toNumber();\r\n    return `${addedInfo?.addedServiceName}：${remainingDay}${item?.unitPrice}元/${serviceInfo.value.unit} x ${finalCount.value}${serviceInfo.value.unit}`;\r\n  });\r\n  return `合计：${buyTipList.join(\" + \")} = ${totalPrice.toFixed(2)}元`;\r\n});\r\n\r\n// 获取短信类型\r\nfunction getTypeList() {\r\n  initData.typeGroupList =\r\n    addedServiceList.value?.map((item: any) => {\r\n      return {\r\n        label: item.addedServiceName,\r\n        value: item.addedServiceCode,\r\n      };\r\n    }) || [];\r\n  initData.typeGroupValues = initData.typeGroupList.length\r\n    ? [initData.typeGroupList[0].value]\r\n    : [];\r\n  getBuyList();\r\n}\r\n\r\n// 短信类型选择\r\nfunction handleChangeType(list: string[]) {\r\n  if (list.length) {\r\n    initData.typeGroupValues = list;\r\n  }\r\n  getPrice();\r\n}\r\n\r\n// 购买数量\r\nfunction getBuyList() {\r\n  initData.buyList = addedServiceList.value[0].specsList.map((item: any) => {\r\n    return {\r\n      label: item.groupNames,\r\n      value: item.groupValues,\r\n    };\r\n  });\r\n  initData.buyNum = initData.buyList[0].value;\r\n  if (addedServiceList.value[0].isDiy) {\r\n    initData.buyList.push({ label: \"自定义\", value: -1 });\r\n    initData.buyCustomNum = initData.buyList[0].value;\r\n  }\r\n}\r\n\r\n// 参数处理\r\nfunction handleParams() {\r\n  const list = buyTotalList.value ?? [];\r\n  const specsCoding = list.map((item) => {\r\n    return {\r\n      coding: item.coding,\r\n      num: finalCount.value,\r\n      baseCode: item.serviceCode,\r\n    };\r\n  });\r\n  const specsCode = list.map((item) => {\r\n    return {\r\n      baseCode: item.serviceCode,\r\n      number: finalCount.value,\r\n    };\r\n  });\r\n  const params = {\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    agentId: userInfo.profileId, // 代理商id\r\n    companyId: companyId, // 代理商子公司id\r\n    profileId: profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\", // 购买：BUY_SERVER、升级：UPGRADE、续费：RENEW\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 默认1\r\n        marketCode: serviceCode,\r\n        userNumber: finalCount.value, // 购买数量\r\n        coding: specsCoding,\r\n        baseCodeList: specsCode,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: specsDescribe.value,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"2\") {\r\n              item.specsInfo = `${new BigNumber(finalCount.value).multipliedBy(\r\n                12\r\n              )}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\r\nonMounted(async () => {\r\n  getTypeList();\r\n  await getPrice();\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_input_number = _resolveComponent(\"el-input-number\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(BaseServiceInfo, { serviceData: serviceInfo.value }, null, 8, [\"serviceData\"]),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createVNode(_component_el_form, { \"label-width\": \"150px\" }, {\n        default: _withCtx(() => [\n          (purchasedInfo.value.length)\n            ? (_openBlock(), _createBlock(_component_el_form_item, {\n                key: 0,\n                label: \"已购详情\"\n              }, {\n                default: _withCtx(() => [\n                  _createElementVNode(\"ul\", _hoisted_3, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(purchasedInfo.value, (item, index) => {\n                      return (_openBlock(), _createElementBlock(\"li\", { key: index }, [\n                        _createElementVNode(\"span\", null, _toDisplayString(item.resourceName), 1),\n                        _createElementVNode(\"span\", null, \"已购数量：\" + _toDisplayString(item.resourceCount) + \"条\", 1),\n                        _createElementVNode(\"span\", null, \"服务到期时间：\" + _toDisplayString(item.endTime), 1)\n                      ]))\n                    }), 128))\n                  ])\n                ]),\n                _: 1\n              }))\n            : _createCommentVNode(\"\", true),\n          _createVNode(_component_el_form_item, { label: \"短信类型\" }, {\n            default: _withCtx(() => [\n              _createVNode(CustomCheckboxButtonGroup, {\n                direction: \"row\",\n                list: initData.typeGroupList,\n                \"model-value\": initData.typeGroupValues,\n                \"onUpdate:modelValue\": handleChangeType\n              }, null, 8, [\"list\", \"model-value\"])\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, {\n            label: \"购买数量\",\n            class: \"amount-form-item\"\n          }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: initData.buyNum,\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((initData.buyNum) = $event)),\n                onChange: getPrice\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(initData.buyList, (item) => {\n                    return (_openBlock(), _createBlock(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"]))\n                  }), 128))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"]),\n              (initData.buyNum === -1)\n                ? (_openBlock(), _createBlock(_component_el_input_number, {\n                    key: 0,\n                    modelValue: initData.buyCustomNum,\n                    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => ((initData.buyCustomNum) = $event)),\n                    min: countInfo.value.minNum,\n                    max: countInfo.value.maxNum,\n                    step: countInfo.value.increaseNum,\n                    \"step-strictly\": \"\",\n                    \"value-on-clear\": countInfo.value.minNum,\n                    onChange: getPrice\n                  }, null, 8, [\"modelValue\", \"min\", \"max\", \"step\", \"value-on-clear\"]))\n                : _createCommentVNode(\"\", true)\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, { label: \"单价\" }, {\n            default: _withCtx(() => [\n              _createTextVNode(_toDisplayString(totalPriceTip.value), 1)\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, null, {\n            default: _withCtx(() => [\n              _createElementVNode(\"p\", _hoisted_4, _toDisplayString(sumDescribe.value), 1)\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(BaseSumPrice, {\n        onEmitFunc: handleBuy,\n        \"buy-price\": agentInfo.value.sumPrice,\n        \"can-buy\": productInfo.value?.canBuy,\n        hasAgentPrice: agentInfo.value.hasAgentPrice\n      }, null, 8, [\"buy-price\", \"can-buy\", \"hasAgentPrice\"])\n    ])\n  ]))\n}\n}\n\n})","<template>\r\n  <div class=\"product-detail\">\r\n    <BaseServiceInfo :serviceData=\"serviceInfo\"></BaseServiceInfo>\r\n    <div class=\"service-specs\">\r\n      <el-form label-width=\"150px\">\r\n        <template v-if=\"purchasedInfo.length\">\r\n          <el-form-item label=\"已购详情\">\r\n            <ul class=\"purchased-list\">\r\n              <li v-for=\"(item, index) in purchasedInfo\" :key=\"index\">\r\n                <span>{{ item.resourceName }}</span>\r\n                <span>已购数量：{{ item.resourceCount }}条</span>\r\n                <span>服务到期时间：{{ item.endTime }}</span>\r\n              </li>\r\n            </ul>\r\n          </el-form-item>\r\n        </template>\r\n        <el-form-item label=\"短信类型\">\r\n          <CustomCheckboxButtonGroup\r\n            direction=\"row\"\r\n            :list=\"initData.typeGroupList\"\r\n            :model-value=\"initData.typeGroupValues\"\r\n            @update:model-value=\"handleChangeType\"\r\n          >\r\n          </CustomCheckboxButtonGroup>\r\n        </el-form-item>\r\n        <el-form-item label=\"购买数量\" class=\"amount-form-item\">\r\n          <el-select v-model=\"initData.buyNum\" @change=\"getPrice\">\r\n            <el-option\r\n              v-for=\"item in initData.buyList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            ></el-option>\r\n          </el-select>\r\n          <el-input-number\r\n            v-if=\"initData.buyNum === -1\"\r\n            v-model=\"initData.buyCustomNum\"\r\n            :min=\"countInfo.minNum\"\r\n            :max=\"countInfo.maxNum\"\r\n            :step=\"countInfo.increaseNum\"\r\n            step-strictly\r\n            :value-on-clear=\"countInfo.minNum\"\r\n            @change=\"getPrice\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item label=\"单价\">\r\n          {{ totalPriceTip }}\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p class=\"word\">\r\n            {{ sumDescribe }}\r\n          </p>\r\n        </el-form-item>\r\n      </el-form>\r\n      <BaseSumPrice\r\n        @emitFunc=\"handleBuy\"\r\n        :buy-price=\"agentInfo.sumPrice\"\r\n        :can-buy=\"productInfo?.canBuy\"\r\n        :hasAgentPrice=\"agentInfo.hasAgentPrice\"\r\n      ></BaseSumPrice>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, onMounted, reactive, shallowRef } from \"vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\n\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomCheckboxButtonGroup from \"@components/common/custom-checkbox-button-group.vue\";\r\nimport BaseSumPrice from \"@components/order-management/create-order/product-detail/base-sum-price.vue\";\r\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { serviceCode, companyId, profileId } = routeQuery.value;\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\ninterface InitDataType {\r\n  typeGroupValues: string[];\r\n  typeGroupList: Record<string, any>[];\r\n  buyNum: number | null;\r\n  buyList: Record<string, any>[];\r\n  buyCustomNum: number;\r\n}\r\n\r\nconst props = defineProps<{\r\n  productData: Record<string, any>;\r\n  purchasedData: Record<string, any>[];\r\n}>();\r\n\r\nconst initData = reactive<InitDataType>({\r\n  typeGroupValues: [],\r\n  typeGroupList: [],\r\n  buyNum: null,\r\n  buyList: [],\r\n  buyCustomNum: 1,\r\n});\r\n\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\n\r\n// 购买信息\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n// 所有信息\r\nconst productInfo = computed(() => {\r\n  return props.productData;\r\n});\r\n\r\n// 服务基本信息\r\nconst serviceInfo = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n\r\n// 增值服务\r\nconst addedServiceList = computed(() => {\r\n  return productInfo.value?.addedServiceList;\r\n});\r\n\r\n// 数量信息\r\nconst countInfo: Record<string, any> = computed(() => {\r\n  const { specsList = [], miniNum = 1 } = addedServiceList.value[0];\r\n  const groupValues = specsList.map((item) => item.groupValues) ?? [0];\r\n  const maxNum = Math.max.apply(null, groupValues);\r\n  const minNum = Math.min.apply(null, groupValues);\r\n  return {\r\n    maxNum,\r\n    minNum,\r\n    increaseNum: miniNum,\r\n  };\r\n});\r\n\r\n// 最终购买数量\r\nconst finalCount = computed(() => {\r\n  return initData.buyNum === -1 ? initData.buyCustomNum : initData.buyNum;\r\n});\r\n\r\n// 购买总计\r\nconst buyTotalList = computed(() => {\r\n  const totalServiceList = addedServiceList.value.filter((item) =>\r\n    initData.typeGroupValues.includes(item.addedServiceCode)\r\n  );\r\n  return totalServiceList.map((item) => {\r\n    const purchasedList = purchasedInfo.value ?? [];\r\n    const { specsList, addedServiceCode } = item;\r\n    const preBuyCount =\r\n      purchasedList.find((item) => item.consumptionTypeCd === addedServiceCode)\r\n        ?.resourceCount ?? 0;\r\n    const totalCount = new BigNumber(preBuyCount)\r\n      .plus(finalCount.value)\r\n      .toNumber();\r\n    return specsList.find((specs) => {\r\n      return specs.minNum <= totalCount && totalCount <= specs.maxNum;\r\n    });\r\n  });\r\n});\r\n// 购买规格描述\r\nconst specsDescribe = computed(() => {\r\n  return buyTotalList.value.reduce((pre, item) => {\r\n    const addedInfo = addedServiceList.value.find(\r\n      (added) => added.addedServiceCode === item.serviceCode\r\n    );\r\n    return (\r\n      pre +\r\n      `${addedInfo?.addedServiceName}：${finalCount.value}${serviceInfo.value.unit}；`\r\n    );\r\n  }, \"\");\r\n});\r\n\r\n// 购买单价总计\r\nconst totalPriceTip = computed(() => {\r\n  return buyTotalList.value.reduce((pre, item) => {\r\n    const addedInfo = addedServiceList.value.find(\r\n      (added) => added.addedServiceCode === item.serviceCode\r\n    );\r\n    return (\r\n      pre +\r\n      `${addedInfo?.addedServiceName}：${item?.unitPrice}元/${serviceInfo.value.unit}；`\r\n    );\r\n  }, \"\");\r\n});\r\n\r\n// 合计描述\r\nconst sumDescribe = computed(() => {\r\n  let totalPrice = 0;\r\n  const buyTipList = buyTotalList.value.map((item) => {\r\n    const addedInfo = addedServiceList.value.find(\r\n      (added) => added.addedServiceCode === item.serviceCode\r\n    );\r\n    const remainingDay = purchasedInfo.value.find(\r\n      (buyItem) => buyItem.consumptionTypeCd === item.serviceCode\r\n    )\r\n      ? \"剩余天数365 / 一年365天 x \"\r\n      : \"\";\r\n    totalPrice += new BigNumber(item?.unitPrice ?? 0)\r\n      .times(finalCount.value)\r\n      .toNumber();\r\n    return `${addedInfo?.addedServiceName}：${remainingDay}${item?.unitPrice}元/${serviceInfo.value.unit} x ${finalCount.value}${serviceInfo.value.unit}`;\r\n  });\r\n  return `合计：${buyTipList.join(\" + \")} = ${totalPrice.toFixed(2)}元`;\r\n});\r\n\r\n// 获取短信类型\r\nfunction getTypeList() {\r\n  initData.typeGroupList =\r\n    addedServiceList.value?.map((item: any) => {\r\n      return {\r\n        label: item.addedServiceName,\r\n        value: item.addedServiceCode,\r\n      };\r\n    }) || [];\r\n  initData.typeGroupValues = initData.typeGroupList.length\r\n    ? [initData.typeGroupList[0].value]\r\n    : [];\r\n  getBuyList();\r\n}\r\n\r\n// 短信类型选择\r\nfunction handleChangeType(list: string[]) {\r\n  if (list.length) {\r\n    initData.typeGroupValues = list;\r\n  }\r\n  getPrice();\r\n}\r\n\r\n// 购买数量\r\nfunction getBuyList() {\r\n  initData.buyList = addedServiceList.value[0].specsList.map((item: any) => {\r\n    return {\r\n      label: item.groupNames,\r\n      value: item.groupValues,\r\n    };\r\n  });\r\n  initData.buyNum = initData.buyList[0].value;\r\n  if (addedServiceList.value[0].isDiy) {\r\n    initData.buyList.push({ label: \"自定义\", value: -1 });\r\n    initData.buyCustomNum = initData.buyList[0].value;\r\n  }\r\n}\r\n\r\n// 参数处理\r\nfunction handleParams() {\r\n  const list = buyTotalList.value ?? [];\r\n  const specsCoding = list.map((item) => {\r\n    return {\r\n      coding: item.coding,\r\n      num: finalCount.value,\r\n      baseCode: item.serviceCode,\r\n    };\r\n  });\r\n  const specsCode = list.map((item) => {\r\n    return {\r\n      baseCode: item.serviceCode,\r\n      number: finalCount.value,\r\n    };\r\n  });\r\n  const params = {\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    agentId: userInfo.profileId, // 代理商id\r\n    companyId: companyId, // 代理商子公司id\r\n    profileId: profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\", // 购买：BUY_SERVER、升级：UPGRADE、续费：RENEW\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 默认1\r\n        marketCode: serviceCode,\r\n        userNumber: finalCount.value, // 购买数量\r\n        coding: specsCoding,\r\n        baseCodeList: specsCode,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: specsDescribe.value,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"2\") {\r\n              item.specsInfo = `${new BigNumber(finalCount.value).multipliedBy(\r\n                12\r\n              )}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\r\nonMounted(async () => {\r\n  getTypeList();\r\n  await getPrice();\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.purchased-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n\r\n  li {\r\n    display: flex;\r\n    align-items: center;\r\n    column-gap: 50px;\r\n    color: #606266;\r\n\r\n    span:nth-child(1) {\r\n      width: 80px;\r\n    }\r\n\r\n    span:nth-child(2),\r\n    span:last-child {\r\n      width: 160px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import script from \"./message-type-service.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./message-type-service.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./message-type-service.vue?vue&type=style&index=0&id=736752af&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_typescript@5.7.2__webpack@5.97.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-736752af\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_defineComponent","__name","props","productData","purchasedData","setup","__props","routeQuery","useVueRouter","serviceCode","companyId","profileId","value","bd_userInfo","userInfo","LocalStorage","batchGetItem","initData","reactive","typeGroupValues","typeGroupList","buyNum","buyList","buyCustomNum","agentInfo","shallowRef","price","sumPrice","unitPrice","addedPrice","subMarketList","hasAgentPrice","purchasedInfo","computed","productInfo","serviceInfo","addedServiceList","_productInfo$value","countInfo","specsList","miniNum","groupValues","map","item","maxNum","Math","max","apply","minNum","min","increaseNum","finalCount","buyTotalList","totalServiceList","filter","includes","addedServiceCode","_purchasedList$find","purchasedList","preBuyCount","find","consumptionTypeCd","resourceCount","totalCount","BigNumber","plus","toNumber","specs","specsDescribe","reduce","pre","addedInfo","added","addedServiceName","unit","totalPriceTip","sumDescribe","totalPrice","buyTipList","remainingDay","buyItem","times","join","toFixed","getTypeList","_addedServiceList$val","label","length","getBuyList","handleChangeType","list","getPrice","groupNames","isDiy","push","handleParams","_agentInfo$value","specsCoding","coding","num","baseCode","specsCode","number","params","helpOrder","agentId","buyType","shopBuyList","isisTry","dateType","dateValue","marketCode","userNumber","baseCodeList","commodityInfo","specsInfo","augmentedServiceList","calculateType","multipliedBy","async","handlePrice","handleBuy","createdOrder","onMounted","_ctx","_cache","_productInfo$value2","_component_el_form_item","_resolveComponent","_component_el_option","_component_el_select","_component_el_input_number","_component_el_form","_openBlock","_createElementBlock","_createVNode","BaseServiceInfo","serviceData","_createElementVNode","default","_withCtx","_createBlock","key","_Fragment","_renderList","index","_toDisplayString","resourceName","endTime","_","_createCommentVNode","CustomCheckboxButtonGroup","direction","modelValue","$event","onChange","step","_createTextVNode","BaseSumPrice","onEmitFunc","canBuy","__exports__"],"sourceRoot":""}