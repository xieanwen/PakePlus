"use strict";(self["webpackChunkdaili"]=self["webpackChunkdaili"]||[]).push([[6320],{88338:function(e,a,l){l.r(a),l.d(a,{default:function(){return P}});l(95226),l(59784),l(29296),l(47961),l(70549),l(83238);var t=l(6254),u=l(25598),i=l(38627),n=l(85723),s=l(59259),o=l(88365),c=l(10901),r=l(4710),d=l(64108),m=l(51409),v=l(99821),p=l(8610);const f={class:"product-detail"},g={class:"service-specs"},b={class:"word"},C={class:"word"},h={class:"word"},k="CALL_PACKAGE_ADDED_NEW2_CHARGE";var y=(0,t.pM)({__name:"cloud-call-package",props:{tagList:{},productData:{},purchasedData:{}},setup(e){const a=(0,u.KR)(),{routeQuery:l}=(0,c.dG)(),{bd_userInfo:y}=o.DT.batchGetItem(["bd_userInfo"]),L=e,V=(0,t.EW)((()=>L.productData)),P=(0,t.EW)((()=>V.value.serviceInfo)),F=(0,t.EW)((()=>{var e;const a=(null===(e=V.value)||void 0===e?void 0:e.addedServiceList)??[];return a.find((e=>e.addedServiceCode===k))})),$=(0,t.EW)((()=>{var e;let a=0,l=0;const t=F.value.minNum,u=null===(e=F.value)||void 0===e?void 0:e.specsList.map(((e,t)=>{0===t&&(a=e.minNum,l=e.maxNum),a>e.minNum&&(a=e.minNum),l<e.maxNum&&(a=e.maxNum);const u=e.groupNames.split(","),i=e.groupCodes.split(","),n=e.groupValues.split(",");return{...e,groupNameList:u,groupValueList:n,groupCodeList:i}}));return{list:u,minNum:a,maxNum:l,increaseNum:t}}));console.log($.value);const _=(0,t.EW)((()=>-1===W.seatCount?W.customSeatCount:W.seatCount)),I=(0,t.EW)((()=>{const e=parseFloat(W.giftMinute);return e*_.value})),N=(0,t.EW)((()=>`合计： (坐席单价${W.seatPrice}元/坐席/月 + 系统软件费${W.callSoft}元/坐席/月） x ${W.cycle}个月 x ${_.value}个坐席 + 附赠产品${E.value.addedPrice}元 =\n            ${E.value.sumPrice}元`)),S=(0,t.EW)((()=>[parseFloat(W.giftMinute)>=5e3?"不限制分钟数 （不限制分钟数，分钟数可共享）":`${W.giftMinute}分钟/坐席/月 （总计${I.value}分钟/月，分钟数可共享）`,parseFloat(W.giftMinute)>=5e3?"不限制分钟数":`${W.giftMinute}分钟/坐席/月`])),M=(0,u.Kh)({minCharge:[],seatPrice:[],callSoft:[],giftMinute:[]}),W=(0,u.Kh)({scenariosLabel:L.tagList.map((e=>e.tagName)),scenariosList:L.tagList,minCharge:"",seatPrice:"",callSoft:"",giftMinute:"",cycle:1,customCycle:1,seatCount:$.value.minNum,customSeatCount:$.value.minNum,effectiveTime:"",specInfo:{},isOvertake:!1}),E=(0,u.IJ)({price:"0.00",sumPrice:"0.00",unitPrice:"0.00",addedPrice:"0.00",hasAgentPrice:!1,subMarketList:[]}),A=[{label:"1个月",value:1},{label:"3个月",value:3},{label:"6个月",value:6},{label:"12个月",value:12},{label:"自定义",value:-1}],w=[$.value.minNum,30,50,100].concat(F.value.isDiy?[-1]:[]).map((e=>({value:e,label:-1===e?"自定义":`${e}个`})));async function D(){await x()}async function x(e){e?W.minCharge=e:(M.minCharge=K("minCharge",0),W.minCharge=M.minCharge[0].value),await T()}async function T(e){e?W.seatPrice=e:(M.seatPrice=K("seatPrice",1),W.seatPrice=M.seatPrice[0].value),await U()}async function U(e){e?W.callSoft=e:(M.callSoft=K("callSoft",2),W.callSoft=M.callSoft[0].value),await Y()}async function Y(e){e?W.giftMinute=e:(M.giftMinute=K("giftMinute",3),W.giftMinute=M.giftMinute[0].value),W.specInfo=$.value.list.find((e=>e.groupValues.startsWith(`${W.minCharge},${W.seatPrice},${W.callSoft},${W.giftMinute}`)))??{},await B()}function K(e,a){const l=[],t=$.value.list;let u=[];switch(e){case"minCharge":u=$.value.list;break;case"seatPrice":u=t.filter((e=>e.groupValues.startsWith(W.minCharge)));break;case"callSoft":u=t.filter((e=>e.groupValues.startsWith(`${W.minCharge},${W.seatPrice}`)));break;case"giftMinute":u=t.filter((e=>e.groupValues.startsWith(`${W.minCharge},${W.seatPrice},${W.callSoft}`)));break}return u.forEach((t=>{const u=t.groupNameList,i=t.groupValueList,n=l.find((e=>e.value===t.groupValueList[a]));!n&&l.push({value:i[a],label:`${u[a]}${"seatPrice"===e?"/坐席/月":""}`})})),l.sort(((e,a)=>e.value-a.value))}function O(){const e=W.scenariosList.map((e=>({id:e.id,pid:e.pid,name:e.tagName||e.name})));a.value.trigger(!0,e)}function X(e){const{list:a=[],label:l=[]}=e;W.scenariosList=a,W.scenariosLabel=l}function R(){var e,a,t,u;const i=W.scenariosList.map((e=>({id:e.id,name:e.name}))),n={helpOrder:1,agentId:y.profileId,companyId:l.value.companyId,profileId:l.value.profileId,buyType:"BUY_SERVER",businessTagsInfo:JSON.stringify(i),shopBuyList:[{agentId:y.profileId,dateType:"2",dateValue:W.cycle,marketCode:l.value.serviceCode,userNumber:_.value,coding:[{code:null===(e=W.specInfo)||void 0===e?void 0:e.serviceCode,coding:null===(a=W.specInfo)||void 0===a?void 0:a.coding,num:_.value}],baseCodeList:null===(t=W.specInfo)||void 0===t?void 0:t.groupCodeList.map(((e,a)=>{var l;return{baseCode:e,number:null===(l=W.specInfo)||void 0===l?void 0:l.groupValueList[a]}}))}],sumPrice:E.value.sumPrice},s={list:[{...P.value,price:E.value.price,specsInfo:`坐席数量：${_.value}个坐席；合作周期：${W.cycle}个月；最低消费：${W.minCharge}元起；坐席单价：${W.seatPrice}元/坐席/月；系统软件费：${W.callSoft}元/坐席/月；含分钟数：${S.value[1]}`,augmentedServiceList:null===(u=E.value)||void 0===u?void 0:u.subMarketList.map((e=>("1"===e.calculateType&&(e.specsInfo=`${W.cycle}个月`),e)))}],sumPrice:E.value.sumPrice};return{params:n,commodityInfo:s}}async function B(){const e=R().params;E.value=await(0,r.AV)(e),W.isOvertake=!1}function G(){W.scenariosList&&W.scenariosList.length?(0,r.$d)(R()):s.nk.warning("请选择业务场景!")}return(0,t.sV)((()=>{D()})),(e,l)=>{var s;const o=(0,t.g2)("el-input"),c=(0,t.g2)("el-form-item"),r=(0,t.g2)("el-option"),k=(0,t.g2)("el-select"),y=(0,t.g2)("el-input-number"),L=(0,t.g2)("el-date-picker"),F=(0,t.g2)("el-tooltip"),_=(0,t.g2)("el-form");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.Lk)("div",f,[(0,t.bF)(d.A,{serviceData:P.value},null,8,["serviceData"]),(0,t.Lk)("div",g,[(0,t.bF)(_,{"label-width":"160px"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{label:"业务场景"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{readonly:"",modelValue:W.scenariosLabel,"onUpdate:modelValue":l[0]||(l[0]=e=>W.scenariosLabel=e),onClick:O},null,8,["modelValue"])])),_:1}),(0,t.bF)(c,{label:"最低消费"},{default:(0,t.k6)((()=>[(0,t.bF)(m.A,{list:M.minCharge,"model-value":W.minCharge,"onUpdate:modelValue":l[1]||(l[1]=e=>x(e)),minWidth:"95px"},null,8,["list","model-value"])])),_:1}),(0,t.bF)(c,{label:"坐席单价"},{default:(0,t.k6)((()=>[(0,t.bF)(m.A,{list:M.seatPrice,"model-value":W.seatPrice,"onUpdate:modelValue":l[2]||(l[2]=e=>T(e)),minWidth:"95px"},null,8,["list","model-value"])])),_:1}),(0,t.bF)(c,{label:"系统软件费"},{default:(0,t.k6)((()=>[(0,t.bF)(m.A,{list:M.callSoft,"model-value":W.callSoft,"onUpdate:modelValue":l[3]||(l[3]=e=>T(e)),minWidth:"95px"},null,8,["list","model-value"])])),_:1}),(0,t.bF)(c,{label:"合作周期"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{modelValue:W.cycle,"onUpdate:modelValue":l[4]||(l[4]=e=>W.cycle=e),onChange:B},{default:(0,t.k6)((()=>[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(A,(e=>(0,t.bF)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"]),-1===W.cycle?((0,t.uX)(),(0,t.Wv)(y,{key:0,modelValue:W.customCycle,"onUpdate:modelValue":l[5]||(l[5]=e=>W.customCycle=e),onChange:B,min:1,max:180,step:1,"value-on-clear":1},null,8,["modelValue"])):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(c,{label:"坐席数量"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{modelValue:W.seatCount,"onUpdate:modelValue":l[6]||(l[6]=e=>W.seatCount=e),onChange:B},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,u.R1)(w),(e=>((0,t.uX)(),(0,t.Wv)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),-1===W.seatCount?((0,t.uX)(),(0,t.Wv)(y,{key:0,modelValue:W.customSeatCount,"onUpdate:modelValue":l[7]||(l[7]=e=>W.customSeatCount=e),onChange:B,min:$.value.minNum,max:$.value.maxNum,step:$.value.increaseNum,"value-on-clear":1},null,8,["modelValue","min","max","step"])):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(c,{label:"服务生效时间"},{default:(0,t.k6)((()=>[(0,t.bF)(L,{modelValue:W.effectiveTime,"onUpdate:modelValue":l[8]||(l[8]=e=>W.effectiveTime=e),type:"date",clearable:"",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","disabled-date":e=>e.getTime()<Date.now()||e.getTime()>Date.now()+432e6},null,8,["modelValue","disabled-date"])])),_:1}),(0,t.bF)(c,{label:"含分钟数"},{default:(0,t.k6)((()=>[(0,t.Lk)("p",b,[(0,t.eW)((0,i.v_)(S.value[0])+" ",1),parseFloat(W.giftMinute)<5e3?((0,t.uX)(),(0,t.Wv)(F,{key:0,placement:"top-start",trigger:"hover","popper-class":"custom-tooltip",content:"当分钟数超出后，会根据使用的资源不同，定价不相同。"},{default:(0,t.k6)((()=>l[9]||(l[9]=[(0,t.Lk)("img",{class:"question-icon",src:n,alt:""},null,-1)]))),_:1})):(0,t.Q3)("",!0)]),(0,t.Lk)("p",C,(0,i.v_)(N.value),1),(0,t.Lk)("p",h," 注意：金额需要超过最低消费金额"+(0,i.v_)(W.minCharge)+"元，才可购买或加购 ",1)])),_:1})])),_:1}),(0,t.bF)(p.A,{onEmitFunc:G,isOvertake:W.isOvertake,buyPrice:E.value.sumPrice,canBuy:null===(s=V.value)||void 0===s?void 0:s.canBuy,hasAgentPrice:E.value.hasAgentPrice},null,8,["isOvertake","buyPrice","canBuy","hasAgentPrice"])])]),(0,t.bF)(v.A,{ref_key:"scenariosRef",ref:a,onEmitFunc:X},null,512)],64)}}}),L=l(83936);const V=(0,L.A)(y,[["__scopeId","data-v-0df34958"]]);var P=V}}]);
//# sourceMappingURL=6320.2895c0aa.js.map