{"version":3,"file":"static/js/4877.bbe1bbda.js","mappings":"ySAKA,MAAMA,EAAa,CAAEC,MAAO,kBACtBC,EAAa,CAAED,MAAO,iBAwB5B,OAA4BE,EAAAA,EAAAA,IAAiB,CAC3CC,OAAQ,wBACRC,MAAO,CACLC,YAAa,CAAC,EACdC,cAAe,CAAC,GAElBC,KAAAA,CAAMC,GC8CR,MAAM,WAAEC,IAAeC,EAAAA,EAAAA,OACfC,YAAaC,GAAaC,EAAAA,GAAaC,aAAa,CAAC,gBAEvDV,EAAQI,EAiBRO,GAAWC,EAAAA,EAAAA,IAAuB,CACtCC,gBAAiB,GACjBC,iBAAkB,GAClBC,iBAAkB,GAClBC,UAAW,GACXC,SAAU,GACVC,YAAa,GACbC,WAAY,GACZC,WAAY,GACZC,UAAW,KAIPC,GAAYC,EAAAA,EAAAA,IAAW,CAC3BC,MAAO,OACPC,SAAU,OACVC,UAAW,OACXC,WAAY,OACZC,cAAe,GACfC,eAAe,IAIXC,GAAcC,EAAAA,EAAAA,KAAS,IACpB/B,EAAMC,cAIT+B,GAAcD,EAAAA,EAAAA,KAAS,IACpBD,EAAYG,MAAMD,cAIrBE,GAAmBH,EAAAA,EAAAA,KAAS,IACzBD,EAAYG,MAAME,mBAIrBC,GAAYL,EAAAA,EAAAA,KAAS,KAAK,IAAAM,EAC9B,OAAgC,QAAhCA,EAAOH,EAAiBD,MAAM,UAAE,IAAAI,GAAW,QAAXA,EAAzBA,EAA2BD,iBAAS,IAAAC,OAAA,EAApCA,EAAsCC,KAAKC,IACzC,IACFA,EACHC,SAAUD,EAAKE,WAAWC,MAAM,KAChCC,UAAWJ,EAAKK,WAAWF,MAAM,KACjCG,UAAWN,EAAKO,YAAYJ,MAAM,QAEpC,IAIEK,GAAchB,EAAAA,EAAAA,KAAS,KAAK,IAAAiB,EAChC,MAAM,UAAEhC,EAAS,YAAEE,EAAW,WAAEE,GAAeT,EAC/C,OAAsB,QAAtBqC,EAAOZ,EAAUH,aAAK,IAAAe,GAMpB,QANoBA,EAAfA,EAAiBC,MAAMV,GAE1BA,EAAKM,UAAU,KAAO7B,GACtBuB,EAAKM,UAAU,KAAO3B,GACtBqB,EAAKM,UAAU,KAAOzB,WAExB,IAAA4B,OAAA,EANKA,EAMHE,MAAM,IAINC,GAAoBpB,EAAAA,EAAAA,KAAS,IAC1B,CACL,CACEqB,SAAU,mBACVC,OAAQ1C,EAASK,WAEnB,CACEoC,SAAU,uBACVC,OAAQ1C,EAASO,aAEnB,CACEkC,SAAU,wBACVC,OAAQ1C,EAASS,eAMvB,SAASkC,IAAkB,IAAAC,EACzB5C,EAASE,gBAAwC,QAAzB0C,EAAGrB,EAAiBD,aAAK,IAAAsB,OAAA,EAAtBA,EAAwBjB,KAAKC,IAAS,CAC/DiB,MAAOjB,EAAKkB,iBACZxB,MAAOM,EAAKmB,qBAEd/C,EAASG,iBAAmBH,EAASE,gBAAgB,GAAGoB,MACxDtB,EAASI,iBAAmBJ,EAASE,gBAAgB,GAAG2C,MACxDG,GACF,CAGA,SAASA,IACPhD,EAASM,SAAW,IACf,IAAI2C,IACLxB,EAAUH,MAAMK,KAAKC,GAAc,CAACA,EAAKC,SAAS,GAAID,EAAKM,UAAU,QAEvEP,KAAI,EAAEkB,EAAOvB,MAAW,CAAGuB,QAAOvB,YACpCtB,EAASK,UAAYL,EAASM,SAAS,GAAGgB,MAC1C4B,GACF,CAGA,SAASA,IACPlD,EAASQ,WAAa,IACjB,IAAIyC,IACLxB,EAAUH,MAAMK,KAAKC,GAAc,CAACA,EAAKC,SAAS,GAAID,EAAKM,UAAU,QAEvEP,KAAI,EAAEkB,EAAOvB,MAAW,CAAGuB,QAAOvB,YACpCtB,EAASO,YAAcP,EAASQ,WAAW,GAAGc,MAC9C6B,GACF,CAGA,SAASA,IAAY,IAAAC,EACnB,MAAMC,EAA8B,GAC9B3C,EAA2B,QAAlB0C,EAAG3B,EAAUH,aAAK,IAAA8B,OAAA,EAAfA,EAAiBE,QAAQ1B,GAEvCA,EAAKM,UAAU,KAAOlC,EAASK,WAC/BuB,EAAKM,UAAU,KAAOlC,EAASO,cAGnCG,EAAUiB,KAAKC,IACb2B,EAAWF,EAAM,CACfR,MAAO,GAAGjB,EAAKC,SAAS,MAAMD,EAAKb,aACnCO,MAAOM,EAAKM,UAAU,IACtB,IAEJlC,EAASU,UAAY2C,EACrBrD,EAASS,WAAa4C,EAAK,GAAG/B,KAChC,CAGA,SAASiC,EAAWF,EAA6BG,GAC/C,MAAMC,EAASJ,EAAKf,MAAMV,GAASA,EAAKN,QAAUkC,EAAKlC,SACtDmC,GAAUJ,EAAKK,KAAKF,EACvB,CAGA,SAASG,EAAiBrC,EAAesC,GACvC,OAAQA,GACN,IAAK,mBACH5D,EAASG,iBAAmBmB,EAC5B,MACF,IAAK,YACH4B,IACA,MACF,IAAK,cACHC,IACA,MACF,IAAK,aACHnD,EAASS,WAAaa,EACtB,MAEJuC,GACF,CAGA,SAASC,IAAY,IAAAC,EACnB,MAAMC,EAAS,CACbC,UAAW,EACXC,QAASrE,EAASsE,UAClBC,UAAW1E,EAAW4B,MAAM8C,UAC5BD,UAAWzE,EAAW4B,MAAM6C,UAC5BE,QAAS,aACTC,YAAa,CACX,CACEJ,QAASrE,EAASsE,UAClBI,SAAS,EACTC,SAAU,EACVC,UAAWzE,EAASS,WACpBiE,WAAYhF,EAAW4B,MAAMqD,YAC7BC,WAAY5E,EAASK,UACrBkC,OAAQ,CACN,CACEsC,KAAM,qBACNC,IAAK9E,EAASK,UACdkC,OAAQH,EAAYd,QAGxByD,aAAcvC,EAAkBlB,QAGpCR,SAAUH,EAAUW,MAAMR,UAGtBkE,EAAgB,CACpB3B,KAAM,CACJ,IACKhC,EAAYC,MACfT,MAAOF,EAAUW,MAAMT,MACvBoE,UAAW,QAAQjF,EAASI,yBAAyBJ,EAASK,mBAAmBL,EAASO,qBAAqBP,EAASS,eACxHyE,qBAAqC,QAAjBnB,EAAEpD,EAAUW,aAAK,IAAAyC,OAAA,EAAfA,EAAiB9C,cAAcU,KAClDC,IAC4B,OAAvBA,EAAKuD,gBACPvD,EAAKqD,UAAY,GAAG,IAAIG,UACtBpF,EAASS,YACT4E,aAAa,SAEVzD,OAKfd,SAAUH,EAAUW,MAAMR,UAE5B,MAAO,CACLkD,SACAgB,gBAEJ,CAGAM,eAAezB,IACb,MAAMG,EAASF,IAAeE,OAC9BrD,EAAUW,YAAciE,EAAAA,EAAAA,IAAYvB,EACtC,CAGA,SAASwB,KACPC,EAAAA,EAAAA,IAAa3B,IACf,CAGA,SAAS4B,IACP/C,IACAkB,GACF,CDrDA,OCuDA8B,EAAAA,EAAAA,KAAU,KACRD,GAAM,IDxDD,CAACE,EAAUC,KAAe,IAAAC,EAC/B,MAAMC,GAA0BC,EAAAA,EAAAA,IAAkB,gBAC5CC,GAAuBD,EAAAA,EAAAA,IAAkB,aACzCE,GAAuBF,EAAAA,EAAAA,IAAkB,aACzCG,GAAwBH,EAAAA,EAAAA,IAAkB,cAC1CI,GAAqBJ,EAAAA,EAAAA,IAAkB,WAE7C,OAAQK,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAOtH,EAAY,EAC3DuH,EAAAA,EAAAA,IAAaC,EAAAA,EAAiB,CAAEC,YAAapF,EAAYC,OAAS,KAAM,EAAG,CAAC,iBAC5EoF,EAAAA,EAAAA,IAAoB,MAAOxH,EAAY,EACrCqH,EAAAA,EAAAA,IAAaH,EAAoB,CAAE,cAAe,SAAW,CAC3DO,SAASC,EAAAA,EAAAA,KAAS,IAAM,EACtBL,EAAAA,EAAAA,IAAaR,EAAyB,CAAElD,MAAO,QAAU,CACvD8D,SAASC,EAAAA,EAAAA,KAAS,IAAM,EACtBL,EAAAA,EAAAA,IAAaM,EAAAA,EAAwB,CACnCxD,KAAMrD,EAASE,gBACf4G,WAAY9G,EAASG,iBACrB4G,SAAU,OACV,sBAAuBlB,EAAO,KAAOA,EAAO,GAAMmB,GAAiBrD,EAAiBqD,EAAQ,sBAC3F,KAAM,EAAG,CAAC,OAAQ,kBAEvBC,EAAG,KAELV,EAAAA,EAAAA,IAAaR,EAAyB,CAAElD,MAAO,OAAS,CACtD8D,SAASC,EAAAA,EAAAA,KAAS,IAAM,EACtBL,EAAAA,EAAAA,IAAaL,EAAsB,CACjCY,WAAY9G,EAASK,UACrB,sBAAuB,CACrBwF,EAAO,KAAOA,EAAO,GAAMmB,GAAkBhH,EAASK,UAAa2G,GACnEnB,EAAO,KAAOA,EAAO,GAAMmB,GAAiBrD,EAAiBqD,EAAQ,eAEvEE,SAAU,IACT,CACDP,SAASC,EAAAA,EAAAA,KAAS,IAAM,GACrBP,EAAAA,EAAAA,KAAW,IAAOC,EAAAA,EAAAA,IAAoBa,EAAAA,GAAW,MAAMC,EAAAA,EAAAA,IAAYpH,EAASM,UAAWsB,KAC9EyE,EAAAA,EAAAA,OAAcgB,EAAAA,EAAAA,IAAapB,EAAsB,CACvDqB,IAAK1F,EAAKN,MACVuB,MAAOjB,EAAKiB,MACZvB,MAAOM,EAAKN,OACX,KAAM,EAAG,CAAC,QAAS,aACpB,SAEN2F,EAAG,GACF,EAAG,CAAC,eACyC,uBAA/C1F,EAAiBD,MAAM,GAAGyB,mBACtBsD,EAAAA,EAAAA,OAAcgB,EAAAA,EAAAA,IAAalB,EAAuB,CACjDmB,IAAK,EACLC,UAAW,YACXC,QAAS,QACT,eAAgB,iBAChBC,QAAS,kBACR,CACDd,SAASC,EAAAA,EAAAA,KAAS,IAAMf,EAAO,KAAOA,EAAO,GAAK,EAChDa,EAAAA,EAAAA,IAAoB,MAAO,CACzBzH,MAAO,gBACPyI,IAAKC,EACLC,IAAK,IACJ,MAAO,OAEZX,EAAG,MAELY,EAAAA,EAAAA,IAAoB,IAAI,MAE9BZ,EAAG,KAELV,EAAAA,EAAAA,IAAaR,EAAyB,CAAElD,MAAO,QAAU,CACvD8D,SAASC,EAAAA,EAAAA,KAAS,IAAM,EACtBL,EAAAA,EAAAA,IAAaL,EAAsB,CACjCY,WAAY9G,EAASO,YACrB,sBAAuB,CACrBsF,EAAO,KAAOA,EAAO,GAAMmB,GAAkBhH,EAASO,YAAeyG,GACrEnB,EAAO,KAAOA,EAAO,GAAMmB,GAAiBrD,EAAiBqD,EAAQ,kBAEtE,CACDL,SAASC,EAAAA,EAAAA,KAAS,IAAM,GACrBP,EAAAA,EAAAA,KAAW,IAAOC,EAAAA,EAAAA,IAAoBa,EAAAA,GAAW,MAAMC,EAAAA,EAAAA,IAAYpH,EAASQ,YAAaoB,KAChFyE,EAAAA,EAAAA,OAAcgB,EAAAA,EAAAA,IAAapB,EAAsB,CACvDqB,IAAK1F,EAAKN,MACVuB,MAAOjB,EAAKiB,MACZvB,MAAOM,EAAKN,OACX,KAAM,EAAG,CAAC,QAAS,aACpB,SAEN2F,EAAG,GACF,EAAG,CAAC,kBAETA,EAAG,KAELV,EAAAA,EAAAA,IAAaR,EAAyB,CAAElD,MAAO,QAAU,CACvD8D,SAASC,EAAAA,EAAAA,KAAS,IAAM,EACtBL,EAAAA,EAAAA,IAAaM,EAAAA,EAAwB,CACnCxD,KAAMrD,EAASU,UACfoG,WAAY9G,EAASS,WACrBsG,SAAU,OACV,sBAAuBlB,EAAO,KAAOA,EAAO,GAAMmB,GAAiBrD,EAAiBqD,EAAQ,gBAC3F,KAAM,EAAG,CAAC,OAAQ,kBAEvBC,EAAG,OAGPA,EAAG,KAELV,EAAAA,EAAAA,IAAauB,EAAAA,EAAc,CACzBC,WAAYvC,EACZ,YAAa7E,EAAUW,MAAMR,SAC7B,UAA4B,QAAnBgF,EAAE3E,EAAYG,aAAK,IAAAwE,OAAA,EAAjBA,EAAmBkC,OAC9B9G,cAAeP,EAAUW,MAAMJ,eAC9B,KAAM,EAAG,CAAC,YAAa,UAAW,qBAEvC,CAEJ,I,WE5XA,MAAM+G,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://daili/./src/components/order-management/create-order/product-detail/im21-yunChaKe-package.vue?9283","webpack://daili/./src/components/order-management/create-order/product-detail/im21-yunChaKe-package.vue","webpack://daili/./src/components/order-management/create-order/product-detail/im21-yunChaKe-package.vue?1e43"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode } from \"vue\"\nimport _imports_0 from '@/assets/images/icon-question.png'\n\n\nconst _hoisted_1 = { class: \"product-detail\" }\nconst _hoisted_2 = { class: \"service-specs\" }\n\nimport { computed, reactive, onMounted, shallowRef } from \"vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\n\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomRadioButtonGroup from \"@components/common/custom-radio-button-group.vue\";\r\nimport BaseSumPrice from \"@components/order-management/create-order/product-detail/base-sum-price.vue\";\r\n\r\ninterface InitDataType {\r\n  packageNameList: any[];\r\n  packageNameValue: string;\r\n  packageNameLabel: string;\r\n  seatValue: string;\r\n  seatList: any[];\r\n  unlockValue: string;\r\n  unlockList: any[];\r\n  cycleValue: string;\r\n  cycleList: any[];\r\n}\r\n\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'im21-yunChaKe-package',\n  props: {\n    productData: {},\n    purchasedData: {}\n  },\n  setup(__props: any) {\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = __props;\r\n\r\nconst initData = reactive<InitDataType>({\r\n  packageNameList: [],\r\n  packageNameValue: \"\",\r\n  packageNameLabel: \"\",\r\n  seatValue: \"\",\r\n  seatList: [],\r\n  unlockValue: \"\",\r\n  unlockList: [],\r\n  cycleValue: \"\",\r\n  cycleList: [],\r\n});\r\n\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\n\r\n// 所有信息\r\nconst productInfo = computed(() => {\r\n  return props.productData;\r\n});\r\n\r\n// 服务基本信息\r\nconst serviceInfo = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n\r\n// 增值服务\r\nconst addedServiceInfo = computed(() => {\r\n  return productInfo.value.addedServiceList;\r\n});\r\n\r\n// 规格数据\r\nconst specsList = computed(() => {\r\n  return addedServiceInfo.value[0]?.specsList?.map((item: any) => {\r\n    return {\r\n      ...item,\r\n      nameList: item.groupNames.split(\",\"),\r\n      codesList: item.groupCodes.split(\",\"),\r\n      valueList: item.groupValues.split(\",\"),\r\n    };\r\n  });\r\n});\r\n\r\n// 当前规格coding\r\nconst specsCoding = computed(() => {\r\n  const { seatValue, unlockValue, cycleValue } = initData;\r\n  return specsList.value?.find((item: any) => {\r\n    return (\r\n      item.valueList[0] === seatValue &&\r\n      item.valueList[1] === unlockValue &&\r\n      item.valueList[2] === cycleValue\r\n    );\r\n  })?.coding;\r\n});\r\n\r\n// 产品规格codeList列表\r\nconst specsBaseCodeList = computed(() => {\r\n  return [\r\n    {\r\n      baseCode: \"PRO_CUS_SEAT_NUM\",\r\n      number: initData.seatValue,\r\n    },\r\n    {\r\n      baseCode: \"PRO_CUS_UNLOCHED_NUM\",\r\n      number: initData.unlockValue,\r\n    },\r\n    {\r\n      baseCode: \"PRO_CUS_SERVICE_CYCLE\",\r\n      number: initData.cycleValue,\r\n    },\r\n  ];\r\n});\r\n\r\n// 获取套餐名称列表\r\nfunction getPackageNameList() {\r\n  initData.packageNameList = addedServiceInfo.value?.map((item: any) => ({\r\n    label: item.addedServiceName,\r\n    value: item.addedServiceCode,\r\n  }));\r\n  initData.packageNameValue = initData.packageNameList[0].value;\r\n  initData.packageNameLabel = initData.packageNameList[0].label;\r\n  getSeatList();\r\n}\r\n\r\n// 获取坐席列表\r\nfunction getSeatList() {\r\n  initData.seatList = [\r\n    ...new Map(\r\n      specsList.value.map((item: any) => [item.nameList[0], item.valueList[0]])\r\n    ),\r\n  ].map(([label, value]) => ({ label, value }));\r\n  initData.seatValue = initData.seatList[0].value;\r\n  getUnlockList();\r\n}\r\n\r\n// 获取解锁量列表\r\nfunction getUnlockList() {\r\n  initData.unlockList = [\r\n    ...new Map(\r\n      specsList.value.map((item: any) => [item.nameList[1], item.valueList[1]])\r\n    ),\r\n  ].map(([label, value]) => ({ label, value }));\r\n  initData.unlockValue = initData.unlockList[0].value;\r\n  getCycleList();\r\n}\r\n\r\n// 获取服务周期列表\r\nfunction getCycleList() {\r\n  const list: Record<string, any>[] = [];\r\n  const cycleList = specsList.value?.filter((item: Record<string, any>) => {\r\n    return (\r\n      item.valueList[0] === initData.seatValue &&\r\n      item.valueList[1] === initData.unlockValue\r\n    );\r\n  });\r\n  cycleList.map((item: Record<string, any>) => {\r\n    recastList(list, {\r\n      label: `${item.nameList[2]}/${item.unitPrice}元`,\r\n      value: item.valueList[2],\r\n    });\r\n  });\r\n  initData.cycleList = list;\r\n  initData.cycleValue = list[0].value;\r\n}\r\n\r\n// 重组数组\r\nfunction recastList(list: Record<string, any>[], info: Record<string, any>) {\r\n  const result = list.find((item) => item.value === info.value);\r\n  !result && list.push(info);\r\n}\r\n\r\n// 切换不同规格\r\nfunction handleModelValue(value: string, type: string) {\r\n  switch (type) {\r\n    case \"packageNameValue\":\r\n      initData.packageNameValue = value;\r\n      break;\r\n    case \"seatValue\":\r\n      getUnlockList();\r\n      break;\r\n    case \"unlockValue\":\r\n      getCycleList();\r\n      break;\r\n    case \"cycleValue\":\r\n      initData.cycleValue = value;\r\n      break;\r\n  }\r\n  getPrice();\r\n}\r\n\r\n// 参数处理\r\nfunction handleParams() {\r\n  const params = {\r\n    helpOrder: 1,\r\n    agentId: userInfo.profileId,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\",\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: initData.cycleValue, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: initData.seatValue, // 坐席数\r\n        coding: [\r\n          {\r\n            code: \"EXPAND_CUS_ADD_PRO\",\r\n            num: initData.seatValue,\r\n            coding: specsCoding.value,\r\n          },\r\n        ],\r\n        baseCodeList: specsBaseCodeList.value,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `套餐名称：${initData.packageNameLabel}；坐席数量：${initData.seatValue}个；含解锁量：${initData.unlockValue}条；服务周期：${initData.cycleValue}年；`,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"22\") {\r\n              item.specsInfo = `${new BigNumber(\r\n                initData.cycleValue\r\n              ).multipliedBy(12)}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\r\n// 初始化\r\nfunction init() {\r\n  getPackageNameList();\r\n  getPrice();\r\n}\r\n\r\nonMounted(() => {\r\n  init();\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_tooltip = _resolveComponent(\"el-tooltip\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(BaseServiceInfo, { serviceData: serviceInfo.value }, null, 8, [\"serviceData\"]),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createVNode(_component_el_form, { \"label-width\": \"150px\" }, {\n        default: _withCtx(() => [\n          _createVNode(_component_el_form_item, { label: \"套餐名称\" }, {\n            default: _withCtx(() => [\n              _createVNode(CustomRadioButtonGroup, {\n                list: initData.packageNameList,\n                modelValue: initData.packageNameValue,\n                minWidth: \"95px\",\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => (handleModelValue($event, 'packageNameValue')))\n              }, null, 8, [\"list\", \"modelValue\"])\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, { label: \"坐席数\" }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: initData.seatValue,\n                \"onUpdate:modelValue\": [\n                  _cache[1] || (_cache[1] = ($event: any) => ((initData.seatValue) = $event)),\n                  _cache[2] || (_cache[2] = ($event: any) => (handleModelValue($event, 'seatValue')))\n                ],\n                disabled: \"\"\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(initData.seatList, (item) => {\n                    return (_openBlock(), _createBlock(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"]))\n                  }), 128))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"]),\n              (addedServiceInfo.value[0].addedServiceCode === 'EXPAND_CUS_ADD_PRO')\n                ? (_openBlock(), _createBlock(_component_el_tooltip, {\n                    key: 0,\n                    placement: \"top-start\",\n                    trigger: \"hover\",\n                    \"popper-class\": \"custom-tooltip\",\n                    content: \"购买后，可自由分配使用人员。\"\n                  }, {\n                    default: _withCtx(() => _cache[6] || (_cache[6] = [\n                      _createElementVNode(\"img\", {\n                        class: \"question-icon\",\n                        src: _imports_0,\n                        alt: \"\"\n                      }, null, -1)\n                    ])),\n                    _: 1\n                  }))\n                : _createCommentVNode(\"\", true)\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, { label: \"含解锁量\" }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: initData.unlockValue,\n                \"onUpdate:modelValue\": [\n                  _cache[3] || (_cache[3] = ($event: any) => ((initData.unlockValue) = $event)),\n                  _cache[4] || (_cache[4] = ($event: any) => (handleModelValue($event, 'unlockValue')))\n                ]\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(initData.unlockList, (item) => {\n                    return (_openBlock(), _createBlock(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"]))\n                  }), 128))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"])\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, { label: \"服务周期\" }, {\n            default: _withCtx(() => [\n              _createVNode(CustomRadioButtonGroup, {\n                list: initData.cycleList,\n                modelValue: initData.cycleValue,\n                minWidth: \"95px\",\n                \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event: any) => (handleModelValue($event, 'cycleValue')))\n              }, null, 8, [\"list\", \"modelValue\"])\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(BaseSumPrice, {\n        onEmitFunc: handleBuy,\n        \"buy-price\": agentInfo.value.sumPrice,\n        \"can-buy\": productInfo.value?.canBuy,\n        hasAgentPrice: agentInfo.value.hasAgentPrice\n      }, null, 8, [\"buy-price\", \"can-buy\", \"hasAgentPrice\"])\n    ])\n  ]))\n}\n}\n\n})","<template>\r\n  <div class=\"product-detail\">\r\n    <BaseServiceInfo :serviceData=\"serviceInfo\"></BaseServiceInfo>\r\n    <div class=\"service-specs\">\r\n      <el-form label-width=\"150px\">\r\n        <el-form-item label=\"套餐名称\">\r\n          <CustomRadioButtonGroup\r\n            :list=\"initData.packageNameList\"\r\n            :modelValue=\"initData.packageNameValue\"\r\n            minWidth=\"95px\"\r\n            @update:modelValue=\"handleModelValue($event, 'packageNameValue')\"\r\n          ></CustomRadioButtonGroup>\r\n        </el-form-item>\r\n        <el-form-item label=\"坐席数\">\r\n          <el-select\r\n            v-model=\"initData.seatValue\"\r\n            disabled\r\n            @update:modelValue=\"handleModelValue($event, 'seatValue')\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in initData.seatList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            ></el-option>\r\n          </el-select>\r\n          <el-tooltip\r\n            v-if=\"addedServiceInfo[0].addedServiceCode === 'EXPAND_CUS_ADD_PRO'\"\r\n            placement=\"top-start\"\r\n            trigger=\"hover\"\r\n            popper-class=\"custom-tooltip\"\r\n            content=\"购买后，可自由分配使用人员。\"\r\n          >\r\n            <img\r\n              class=\"question-icon\"\r\n              src=\"@/assets/images/icon-question.png\"\r\n              alt=\"\"\r\n            />\r\n          </el-tooltip>\r\n        </el-form-item>\r\n        <el-form-item label=\"含解锁量\">\r\n          <el-select\r\n            v-model=\"initData.unlockValue\"\r\n            @update:modelValue=\"handleModelValue($event, 'unlockValue')\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in initData.unlockList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            ></el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"服务周期\">\r\n          <CustomRadioButtonGroup\r\n            :list=\"initData.cycleList\"\r\n            :modelValue=\"initData.cycleValue\"\r\n            minWidth=\"95px\"\r\n            @update:modelValue=\"handleModelValue($event, 'cycleValue')\"\r\n          ></CustomRadioButtonGroup>\r\n        </el-form-item>\r\n      </el-form>\r\n      <BaseSumPrice\r\n        @emitFunc=\"handleBuy\"\r\n        :buy-price=\"agentInfo.sumPrice\"\r\n        :can-buy=\"productInfo?.canBuy\"\r\n        :hasAgentPrice=\"agentInfo.hasAgentPrice\"\r\n      ></BaseSumPrice>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, reactive, onMounted, shallowRef } from \"vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\n\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomRadioButtonGroup from \"@components/common/custom-radio-button-group.vue\";\r\nimport BaseSumPrice from \"@components/order-management/create-order/product-detail/base-sum-price.vue\";\r\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = defineProps<{\r\n  productData: Record<string, any>;\r\n  purchasedData: Record<string, any>[];\r\n}>();\r\n\r\ninterface InitDataType {\r\n  packageNameList: any[];\r\n  packageNameValue: string;\r\n  packageNameLabel: string;\r\n  seatValue: string;\r\n  seatList: any[];\r\n  unlockValue: string;\r\n  unlockList: any[];\r\n  cycleValue: string;\r\n  cycleList: any[];\r\n}\r\n\r\nconst initData = reactive<InitDataType>({\r\n  packageNameList: [],\r\n  packageNameValue: \"\",\r\n  packageNameLabel: \"\",\r\n  seatValue: \"\",\r\n  seatList: [],\r\n  unlockValue: \"\",\r\n  unlockList: [],\r\n  cycleValue: \"\",\r\n  cycleList: [],\r\n});\r\n\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\n\r\n// 所有信息\r\nconst productInfo = computed(() => {\r\n  return props.productData;\r\n});\r\n\r\n// 服务基本信息\r\nconst serviceInfo = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n\r\n// 增值服务\r\nconst addedServiceInfo = computed(() => {\r\n  return productInfo.value.addedServiceList;\r\n});\r\n\r\n// 规格数据\r\nconst specsList = computed(() => {\r\n  return addedServiceInfo.value[0]?.specsList?.map((item: any) => {\r\n    return {\r\n      ...item,\r\n      nameList: item.groupNames.split(\",\"),\r\n      codesList: item.groupCodes.split(\",\"),\r\n      valueList: item.groupValues.split(\",\"),\r\n    };\r\n  });\r\n});\r\n\r\n// 当前规格coding\r\nconst specsCoding = computed(() => {\r\n  const { seatValue, unlockValue, cycleValue } = initData;\r\n  return specsList.value?.find((item: any) => {\r\n    return (\r\n      item.valueList[0] === seatValue &&\r\n      item.valueList[1] === unlockValue &&\r\n      item.valueList[2] === cycleValue\r\n    );\r\n  })?.coding;\r\n});\r\n\r\n// 产品规格codeList列表\r\nconst specsBaseCodeList = computed(() => {\r\n  return [\r\n    {\r\n      baseCode: \"PRO_CUS_SEAT_NUM\",\r\n      number: initData.seatValue,\r\n    },\r\n    {\r\n      baseCode: \"PRO_CUS_UNLOCHED_NUM\",\r\n      number: initData.unlockValue,\r\n    },\r\n    {\r\n      baseCode: \"PRO_CUS_SERVICE_CYCLE\",\r\n      number: initData.cycleValue,\r\n    },\r\n  ];\r\n});\r\n\r\n// 获取套餐名称列表\r\nfunction getPackageNameList() {\r\n  initData.packageNameList = addedServiceInfo.value?.map((item: any) => ({\r\n    label: item.addedServiceName,\r\n    value: item.addedServiceCode,\r\n  }));\r\n  initData.packageNameValue = initData.packageNameList[0].value;\r\n  initData.packageNameLabel = initData.packageNameList[0].label;\r\n  getSeatList();\r\n}\r\n\r\n// 获取坐席列表\r\nfunction getSeatList() {\r\n  initData.seatList = [\r\n    ...new Map(\r\n      specsList.value.map((item: any) => [item.nameList[0], item.valueList[0]])\r\n    ),\r\n  ].map(([label, value]) => ({ label, value }));\r\n  initData.seatValue = initData.seatList[0].value;\r\n  getUnlockList();\r\n}\r\n\r\n// 获取解锁量列表\r\nfunction getUnlockList() {\r\n  initData.unlockList = [\r\n    ...new Map(\r\n      specsList.value.map((item: any) => [item.nameList[1], item.valueList[1]])\r\n    ),\r\n  ].map(([label, value]) => ({ label, value }));\r\n  initData.unlockValue = initData.unlockList[0].value;\r\n  getCycleList();\r\n}\r\n\r\n// 获取服务周期列表\r\nfunction getCycleList() {\r\n  const list: Record<string, any>[] = [];\r\n  const cycleList = specsList.value?.filter((item: Record<string, any>) => {\r\n    return (\r\n      item.valueList[0] === initData.seatValue &&\r\n      item.valueList[1] === initData.unlockValue\r\n    );\r\n  });\r\n  cycleList.map((item: Record<string, any>) => {\r\n    recastList(list, {\r\n      label: `${item.nameList[2]}/${item.unitPrice}元`,\r\n      value: item.valueList[2],\r\n    });\r\n  });\r\n  initData.cycleList = list;\r\n  initData.cycleValue = list[0].value;\r\n}\r\n\r\n// 重组数组\r\nfunction recastList(list: Record<string, any>[], info: Record<string, any>) {\r\n  const result = list.find((item) => item.value === info.value);\r\n  !result && list.push(info);\r\n}\r\n\r\n// 切换不同规格\r\nfunction handleModelValue(value: string, type: string) {\r\n  switch (type) {\r\n    case \"packageNameValue\":\r\n      initData.packageNameValue = value;\r\n      break;\r\n    case \"seatValue\":\r\n      getUnlockList();\r\n      break;\r\n    case \"unlockValue\":\r\n      getCycleList();\r\n      break;\r\n    case \"cycleValue\":\r\n      initData.cycleValue = value;\r\n      break;\r\n  }\r\n  getPrice();\r\n}\r\n\r\n// 参数处理\r\nfunction handleParams() {\r\n  const params = {\r\n    helpOrder: 1,\r\n    agentId: userInfo.profileId,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\",\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: initData.cycleValue, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: initData.seatValue, // 坐席数\r\n        coding: [\r\n          {\r\n            code: \"EXPAND_CUS_ADD_PRO\",\r\n            num: initData.seatValue,\r\n            coding: specsCoding.value,\r\n          },\r\n        ],\r\n        baseCodeList: specsBaseCodeList.value,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `套餐名称：${initData.packageNameLabel}；坐席数量：${initData.seatValue}个；含解锁量：${initData.unlockValue}条；服务周期：${initData.cycleValue}年；`,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"22\") {\r\n              item.specsInfo = `${new BigNumber(\r\n                initData.cycleValue\r\n              ).multipliedBy(12)}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\r\n// 初始化\r\nfunction init() {\r\n  getPackageNameList();\r\n  getPrice();\r\n}\r\n\r\nonMounted(() => {\r\n  init();\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n@use \"./common.scss\" as *;\r\n.question-icon {\r\n  margin-left: 10px;\r\n}\r\n</style>\r\n","import script from \"./im21-yunChaKe-package.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./im21-yunChaKe-package.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./im21-yunChaKe-package.vue?vue&type=style&index=0&id=346341cc&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_typescript@5.7.2__webpack@5.97.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-346341cc\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_defineComponent","__name","props","productData","purchasedData","setup","__props","routeQuery","useVueRouter","bd_userInfo","userInfo","LocalStorage","batchGetItem","initData","reactive","packageNameList","packageNameValue","packageNameLabel","seatValue","seatList","unlockValue","unlockList","cycleValue","cycleList","agentInfo","shallowRef","price","sumPrice","unitPrice","addedPrice","subMarketList","hasAgentPrice","productInfo","computed","serviceInfo","value","addedServiceInfo","addedServiceList","specsList","_addedServiceInfo$val","map","item","nameList","groupNames","split","codesList","groupCodes","valueList","groupValues","specsCoding","_specsList$value","find","coding","specsBaseCodeList","baseCode","number","getPackageNameList","_addedServiceInfo$val2","label","addedServiceName","addedServiceCode","getSeatList","Map","getUnlockList","getCycleList","_specsList$value2","list","filter","recastList","info","result","push","handleModelValue","type","getPrice","handleParams","_agentInfo$value","params","helpOrder","agentId","profileId","companyId","buyType","shopBuyList","isisTry","dateType","dateValue","marketCode","serviceCode","userNumber","code","num","baseCodeList","commodityInfo","specsInfo","augmentedServiceList","calculateType","BigNumber","multipliedBy","async","handlePrice","handleBuy","createdOrder","init","onMounted","_ctx","_cache","_productInfo$value","_component_el_form_item","_resolveComponent","_component_el_option","_component_el_select","_component_el_tooltip","_component_el_form","_openBlock","_createElementBlock","_createVNode","BaseServiceInfo","serviceData","_createElementVNode","default","_withCtx","CustomRadioButtonGroup","modelValue","minWidth","$event","_","disabled","_Fragment","_renderList","_createBlock","key","placement","trigger","content","src","_imports_0","alt","_createCommentVNode","BaseSumPrice","onEmitFunc","canBuy","__exports__"],"sourceRoot":""}