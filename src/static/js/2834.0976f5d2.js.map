{"version":3,"file":"static/js/2834.0976f5d2.js","mappings":"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","sources":["webpack://daili/./src/components/business-management/ospreyCloudCall/sub-customer/details/call-record/list.vue?2e98","webpack://daili/./src/components/business-management/ospreyCloudCall/sub-customer/details/call-record/list.vue","webpack://daili/./src/components/business-management/ospreyCloudCall/sub-customer/details/call-record/list.vue?95fd"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createElementVNode as _createElementVNode, unref as _unref, createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createTextVNode as _createTextVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"call-record\" }\nconst _hoisted_2 = { class: \"form-container\" }\nconst _hoisted_3 = { class: \"table-container\" }\n\nimport { defineAsyncComponent, reactive } from \"vue\";\r\nimport { Search } from \"@element-plus/icons-vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { DisabledDate } from \"@assets/instanceCollection\";\r\nimport { serviceName, dateStartOf, dateEndOf } from \"@/assets/common\";\r\nimport \"aplayer/dist/APlayer.min.css\";\r\nimport APlayer from \"aplayer\";\r\n\r\nimport { downloadFile, ossDownLoad } from \"@/api/download-api\";\r\nimport {\r\n  directCallRecordListApi,\r\n  interfaceCallRecordListApi,\r\n} from \"@api/business-management-api\";\r\n\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'list',\n  setup(__props) {\n\r\nconst AdvancedFilterDrawer = defineAsyncComponent(\r\n  () => import(\"./advanced-filter-drawer.vue\")\r\n);\r\nconst { routeQuery } = useVueRouter();\r\nconst virCompanyId = LocalStorage.getItem(\"bd_virCompanyId\");\r\nconst initData = reactive({\r\n  advancedFilterVisible: false,\r\n  aPlayer: null,\r\n});\r\nconst pageData = reactive({\r\n  list: [],\r\n  pageTotal: 0,\r\n  pageSize: 10,\r\n  pageNumber: 1,\r\n  recordFileUrl: \"\",\r\n});\r\nconst paramsData = reactive({\r\n  callNum: \"\",\r\n  calleeNum: \"\",\r\n  callerNum: \"\",\r\n  bindNum: \"\",\r\n  status: \"\",\r\n  dateList: [dateStartOf(), dateEndOf()],\r\n});\r\nconst disabledDateInstance = new DisabledDate(7);\r\ngetList();\r\nasync function getList() {\r\n  let api;\r\n  const params = {\r\n    pageNo: pageData.pageNumber,\r\n    pageSize: pageData.pageSize,\r\n    status: paramsData.status,\r\n    callNum: paramsData.callNum,\r\n    calleeNum: paramsData.calleeNum,\r\n    callerNum: paramsData.callerNum,\r\n    bindNum: paramsData.bindNum,\r\n    companyId: routeQuery.value.companyId,\r\n\r\n  };\r\n  const startTime = paramsData.dateList[0];\r\n  const endTime = paramsData.dateList[1];\r\n  if (routeQuery.value.businessType === \"1\") {\r\n    Reflect.set(params, \"code\", routeQuery.value.code ?? \"1\");\r\n    Reflect.set(params, \"startTime\", startTime);\r\n    Reflect.set(params, \"endTime\", endTime);\r\n    api = interfaceCallRecordListApi;\r\n  } else {\r\n    Reflect.set(params, \"startAt\", startTime);\r\n    Reflect.set(params, \"endAt\", endTime);\r\n    Reflect.set(params, \"agentSwitch\", 1);\r\n    api = directCallRecordListApi\r\n  }\r\n  if (!api) return;\r\n  const { data } = await api.getData(params);\r\n  const result = api.handleData(data);\r\n  pageData.list = result.list;\r\n  pageData.pageTotal = result.total;\r\n}\r\nfunction pageSizeChange(value) {\r\n  pageData.pageSize = value;\r\n  getList();\r\n}\r\nfunction pageNumberChange(value) {\r\n  pageData.pageNumber = value;\r\n  getList();\r\n}\r\n// 高级筛选回调\r\nconst handleFilter = (value) => {\r\n  const { calleeNum, callerNum, bindNum, status, dateList } = value;\r\n  paramsData.status = status;\r\n  paramsData.dateList = dateList;\r\n  paramsData.calleeNum = calleeNum;\r\n  paramsData.callerNum = callerNum;\r\n  paramsData.bindNum = bindNum;\r\n  if (calleeNum || callerNum) paramsData.callNum = \"\";\r\n  getList();\r\n};\r\n\r\n// 时间转换\r\nconst changeDate = (value: any[]) => {\r\n  if (value) {\r\n    paramsData.dateList = [dateStartOf(value[0]), dateEndOf(value[1])];\r\n  } else {\r\n    paramsData.dateList = [dateStartOf(), dateEndOf()];\r\n  }\r\n  getList();\r\n};\r\n\r\n// 打开高级筛选抽屉\r\nconst openAdvancedFilter = () => {\r\n  initData.advancedFilterVisible = true;\r\n};\r\n\r\n// 下载录音\r\nfunction download(fileId: string) {\r\n  const params = {\r\n    companyId: virCompanyId,\r\n    fileId,\r\n  };\r\n  ossDownLoad(params);\r\n}\r\n// 播放录音\r\nfunction handlePlayAudio(row) {\r\n  initData.aPlayer = new APlayer({\r\n    container: document.getElementById(\"player\"),\r\n    autoplay: true,\r\n    loop: \"none\",\r\n    audio: [\r\n      {\r\n        name: \"被叫：\" + row.calleeNum,\r\n        artist: \"录音\",\r\n        url: row.recordFileUrl,\r\n        cover: \"favicon.ico\",\r\n      },\r\n    ],\r\n  });\r\n  (initData.aPlayer as any).on(\"ended\", function () {\r\n    (initData.aPlayer as any).destroy();\r\n  });\r\n}\r\n//导出数据\r\nconst handleExport = async () => {\r\n  const filterData = {\r\n    pageNo: pageData.pageNumber,\r\n    pageSize: pageData.pageSize,\r\n    status: paramsData.status,\r\n    callNum: paramsData.callNum,\r\n    bindNum: paramsData.bindNum,\r\n    calleeNum: paramsData.calleeNum,\r\n    callerNum: paramsData.callerNum,\r\n  };\r\n  if (String(routeQuery.value.businessType) === '1') {\r\n    const params = {\r\n      api: `${serviceName.bdConsole}/agent-call-phone-record-statistics/exportAgentCdr`,\r\n      method: \"post\",\r\n      formData: Object.assign(\r\n        {\r\n          code: routeQuery.value.code,\r\n          startTime: paramsData.dateList[0],\r\n          endTime: paramsData.dateList[1],\r\n          companyId: Number(routeQuery.value.companyId),\r\n        },\r\n        filterData\r\n      ),\r\n    };\r\n    await downloadFile(params);\r\n  } else {\r\n    const params = {\r\n      api: `${serviceName.callRest}/call-record/exportAgentCdr`,\r\n      method: \"post\",\r\n      headers: {\r\n        \"content-type\": \"application/json\",\r\n      },\r\n      formData: Object.assign(\r\n        {\r\n          companyId: Number(routeQuery.value.companyId),\r\n          startAt: paramsData.dateList[0],\r\n          endAt: paramsData.dateList[1],\r\n        },\r\n        filterData\r\n      ),\r\n    };\r\n    await downloadFile(params);\r\n  }\r\n};\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_icon = _resolveComponent(\"el-icon\")!\n  const _component_el_input = _resolveComponent(\"el-input\")!\n  const _component_el_date_picker = _resolveComponent(\"el-date-picker\")!\n  const _component_el_button = _resolveComponent(\"el-button\")!\n  const _component_el_table_column = _resolveComponent(\"el-table-column\")!\n  const _component_el_link = _resolveComponent(\"el-link\")!\n  const _component_el_tag = _resolveComponent(\"el-tag\")!\n  const _component_TableEmpty = _resolveComponent(\"TableEmpty\")!\n  const _component_el_table = _resolveComponent(\"el-table\")!\n  const _component_PagePagination = _resolveComponent(\"PagePagination\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _cache[8] || (_cache[8] = _createElementVNode(\"div\", { id: \"player\" }, null, -1)),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createVNode(_component_el_input, {\n        modelValue: paramsData.callNum,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((paramsData.callNum) = $event)),\n        placeholder: \"主叫号码/被叫号码\",\n        clearable: \"\"\n      }, {\n        suffix: _withCtx(() => [\n          _createVNode(_component_el_icon, {\n            class: \"el-input__icon\",\n            onClick: getList\n          }, {\n            default: _withCtx(() => [\n              _createVNode(_unref(Search))\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }, 8, [\"modelValue\"]),\n      _createVNode(_component_el_date_picker, {\n        modelValue: paramsData.dateList,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => ((paramsData.dateList) = $event)),\n        type: \"daterange\",\n        \"range-separator\": \"~\",\n        clearable: false,\n        format: \"YYYY-MM-DD\",\n        onChange: changeDate,\n        onCalendarChange: _cache[2] || (_cache[2] = \r\n          (dateList) => {\r\n            _unref(disabledDateInstance).handleCalendar(dateList);\r\n          }\r\n        ),\n        \"disabled-date\": \r\n          (time) => {\r\n            return _unref(disabledDateInstance).handleDisabled(time);\r\n          }\r\n        \n      }, null, 8, [\"modelValue\", \"disabled-date\"]),\n      _createVNode(_component_el_button, { onClick: openAdvancedFilter }, {\n        default: _withCtx(() => _cache[4] || (_cache[4] = [\n          _createTextVNode(\"高级筛选\")\n        ])),\n        _: 1\n      }),\n      _createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: handleExport\n      }, {\n        default: _withCtx(() => _cache[5] || (_cache[5] = [\n          _createTextVNode(\"导出数据\")\n        ])),\n        _: 1\n      })\n    ]),\n    _createElementVNode(\"div\", _hoisted_3, [\n      _createVNode(_component_el_table, {\n        data: pageData.list,\n        height: \"calc(100vh - 308px)\"\n      }, {\n        empty: _withCtx(() => [\n          _createVNode(_component_TableEmpty, { \"empty-text\": \"暂无数据\" })\n        ]),\n        default: _withCtx(() => [\n          _createVNode(_component_el_table_column, {\n            prop: \"calleeNum\",\n            label: \"被叫号码\",\n            \"min-width\": \"200px\",\n            align: \"center\"\n          }),\n          _createVNode(_component_el_table_column, {\n            prop: \"callerNum\",\n            label: \"主叫号码\",\n            \"min-width\": \"200px\",\n            align: \"center\"\n          }),\n          _createVNode(_component_el_table_column, {\n            prop: \"callFlags\",\n            label: \"类型\",\n            \"min-width\": \"200px\",\n            align: \"center\"\n          }),\n          _createVNode(_component_el_table_column, {\n            prop: \"timeConsume\",\n            label: \"通话时长 (秒)\",\n            \"min-width\": \"200px\",\n            align: \"center\"\n          }),\n          _createVNode(_component_el_table_column, {\n            prop: \"fee\",\n            label: \"费用（元）\",\n            \"min-width\": \"150px\",\n            align: \"center\"\n          }),\n          _createVNode(_component_el_table_column, {\n            prop: \"recordFlag\",\n            label: \"是否录音\",\n            \"min-width\": \"200px\",\n            align: \"center\",\n            \"class-name\": \"operation-group\"\n          }, {\n            default: _withCtx(({ row }) => [\n              _createVNode(_component_el_link, {\n                type: \"primary\",\n                underline: false,\n                disabled: !row.recordFileId,\n                onClick: ($event: any) => (handlePlayAudio(row))\n              }, {\n                default: _withCtx(() => _cache[6] || (_cache[6] = [\n                  _createTextVNode(\"播放\")\n                ])),\n                _: 2\n              }, 1032, [\"disabled\", \"onClick\"]),\n              _createVNode(_component_el_link, {\n                type: \"primary\",\n                underline: false,\n                disabled: !row.recordFileId,\n                onClick: ($event: any) => (download(row.recordFileId))\n              }, {\n                default: _withCtx(() => _cache[7] || (_cache[7] = [\n                  _createTextVNode(\"下载\")\n                ])),\n                _: 2\n              }, 1032, [\"disabled\", \"onClick\"])\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_table_column, {\n            prop: \"status\",\n            label: \"状态\",\n            align: \"center\",\n            \"min-width\": \"200px\"\n          }, {\n            default: _withCtx(({ row }) => [\n              _createVNode(_component_el_tag, {\n                type: row.callDetailsStyleType\n              }, {\n                default: _withCtx(() => [\n                  _createTextVNode(_toDisplayString(row.callDetailsName), 1)\n                ]),\n                _: 2\n              }, 1032, [\"type\"])\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_table_column, {\n            prop: \"disconnectTime\",\n            label: \"通话结束时间\",\n            align: \"center\",\n            \"min-width\": \"200px\"\n          })\n        ]),\n        _: 1\n      }, 8, [\"data\"]),\n      _createVNode(_component_PagePagination, {\n        pageTotal: pageData.pageTotal,\n        pageSize: pageData.pageSize,\n        pageNumber: pageData.pageNumber,\n        onEmitPageSizeChange: pageSizeChange,\n        onEmitPageNumberChange: pageNumberChange\n      }, null, 8, [\"pageTotal\", \"pageSize\", \"pageNumber\"])\n    ]),\n    _createVNode(_unref(AdvancedFilterDrawer), {\n      visible: initData.advancedFilterVisible,\n      \"onUpdate:visible\": _cache[3] || (_cache[3] = ($event: any) => ((initData.advancedFilterVisible) = $event)),\n      onEmitFunc: handleFilter\n    }, null, 8, [\"visible\"])\n  ]))\n}\n}\n\n})","<template>\r\n  <!--  通话详情-->\r\n  <div class=\"call-record\">\r\n    <div id=\"player\"></div>\r\n    <div class=\"form-container\">\r\n      <el-input\r\n        v-model=\"paramsData.callNum\"\r\n        placeholder=\"主叫号码/被叫号码\"\r\n        clearable\r\n      >\r\n        <template #suffix>\r\n          <el-icon class=\"el-input__icon\" @click=\"getList\"><search /></el-icon>\r\n        </template>\r\n      </el-input>\r\n      <el-date-picker\r\n        v-model=\"paramsData.dateList\"\r\n        type=\"daterange\"\r\n        range-separator=\"~\"\r\n        :clearable=\"false\"\r\n        format=\"YYYY-MM-DD\"\r\n        @change=\"changeDate\"\r\n        @calendar-change=\"\r\n          (dateList) => {\r\n            disabledDateInstance.handleCalendar(dateList);\r\n          }\r\n        \"\r\n        :disabled-date=\"\r\n          (time) => {\r\n            return disabledDateInstance.handleDisabled(time);\r\n          }\r\n        \"\r\n      />\r\n      <el-button @click=\"openAdvancedFilter\">高级筛选</el-button>\r\n      <el-button type=\"primary\" @click=\"handleExport\">导出数据</el-button>\r\n    </div>\r\n    <div class=\"table-container\">\r\n      <!--   列表   -->\r\n      <el-table :data=\"pageData.list\" height=\"calc(100vh - 308px)\">\r\n        <el-table-column\r\n          prop=\"calleeNum\"\r\n          label=\"被叫号码\"\r\n          min-width=\"200px\"\r\n          align=\"center\"\r\n        ></el-table-column>\r\n        <el-table-column\r\n          prop=\"callerNum\"\r\n          label=\"主叫号码\"\r\n          min-width=\"200px\"\r\n          align=\"center\"\r\n        ></el-table-column>\r\n        <el-table-column\r\n          prop=\"callFlags\"\r\n          label=\"类型\"\r\n          min-width=\"200px\"\r\n          align=\"center\"\r\n        ></el-table-column>\r\n        <el-table-column\r\n          prop=\"timeConsume\"\r\n          label=\"通话时长 (秒)\"\r\n          min-width=\"200px\"\r\n          align=\"center\"\r\n        ></el-table-column>\r\n        <el-table-column\r\n          prop=\"fee\"\r\n          label=\"费用（元）\"\r\n          min-width=\"150px\"\r\n          align=\"center\"\r\n        ></el-table-column>\r\n        <el-table-column\r\n          prop=\"recordFlag\"\r\n          label=\"是否录音\"\r\n          min-width=\"200px\"\r\n          align=\"center\"\r\n          class-name=\"operation-group\"\r\n        >\r\n          <template #default=\"{ row }\">\r\n            <el-link\r\n              type=\"primary\"\r\n              :underline=\"false\"\r\n              :disabled=\"!row.recordFileId\"\r\n              @click=\"handlePlayAudio(row)\"\r\n              >播放</el-link\r\n            >\r\n            <el-link\r\n              type=\"primary\"\r\n              :underline=\"false\"\r\n              :disabled=\"!row.recordFileId\"\r\n              @click=\"download(row.recordFileId)\"\r\n              >下载</el-link\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"status\"\r\n          label=\"状态\"\r\n          align=\"center\"\r\n          min-width=\"200px\"\r\n        >\r\n          <template #default=\"{ row }\">\r\n            <el-tag :type=\"row.callDetailsStyleType\">{{\r\n              row.callDetailsName\r\n            }}</el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column\r\n          prop=\"disconnectTime\"\r\n          label=\"通话结束时间\"\r\n          align=\"center\"\r\n          min-width=\"200px\"\r\n        >\r\n        </el-table-column>\r\n        <template #empty>\r\n          <TableEmpty empty-text=\"暂无数据\"></TableEmpty>\r\n        </template>\r\n      </el-table>\r\n      <!--   分页   -->\r\n      <PagePagination\r\n        :pageTotal=\"pageData.pageTotal\"\r\n        :pageSize=\"pageData.pageSize\"\r\n        :pageNumber=\"pageData.pageNumber\"\r\n        @emitPageSizeChange=\"pageSizeChange\"\r\n        @emitPageNumberChange=\"pageNumberChange\"\r\n      >\r\n      </PagePagination>\r\n    </div>\r\n    <!-- 高级筛选 -->\r\n    <AdvancedFilterDrawer\r\n      v-model:visible=\"initData.advancedFilterVisible\"\r\n      @emitFunc=\"handleFilter\"\r\n    ></AdvancedFilterDrawer>\r\n  </div>\r\n</template>\r\n<script lang=\"ts\" setup>\r\nimport { defineAsyncComponent, reactive } from \"vue\";\r\nimport { Search } from \"@element-plus/icons-vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { DisabledDate } from \"@assets/instanceCollection\";\r\nimport { serviceName, dateStartOf, dateEndOf } from \"@/assets/common\";\r\nimport \"aplayer/dist/APlayer.min.css\";\r\nimport APlayer from \"aplayer\";\r\n\r\nimport { downloadFile, ossDownLoad } from \"@/api/download-api\";\r\nimport {\r\n  directCallRecordListApi,\r\n  interfaceCallRecordListApi,\r\n} from \"@api/business-management-api\";\r\n\r\nconst AdvancedFilterDrawer = defineAsyncComponent(\r\n  () => import(\"./advanced-filter-drawer.vue\")\r\n);\r\nconst { routeQuery } = useVueRouter();\r\nconst virCompanyId = LocalStorage.getItem(\"bd_virCompanyId\");\r\nconst initData = reactive({\r\n  advancedFilterVisible: false,\r\n  aPlayer: null,\r\n});\r\nconst pageData = reactive({\r\n  list: [],\r\n  pageTotal: 0,\r\n  pageSize: 10,\r\n  pageNumber: 1,\r\n  recordFileUrl: \"\",\r\n});\r\nconst paramsData = reactive({\r\n  callNum: \"\",\r\n  calleeNum: \"\",\r\n  callerNum: \"\",\r\n  bindNum: \"\",\r\n  status: \"\",\r\n  dateList: [dateStartOf(), dateEndOf()],\r\n});\r\nconst disabledDateInstance = new DisabledDate(7);\r\ngetList();\r\nasync function getList() {\r\n  let api;\r\n  const params = {\r\n    pageNo: pageData.pageNumber,\r\n    pageSize: pageData.pageSize,\r\n    status: paramsData.status,\r\n    callNum: paramsData.callNum,\r\n    calleeNum: paramsData.calleeNum,\r\n    callerNum: paramsData.callerNum,\r\n    bindNum: paramsData.bindNum,\r\n    companyId: routeQuery.value.companyId,\r\n\r\n  };\r\n  const startTime = paramsData.dateList[0];\r\n  const endTime = paramsData.dateList[1];\r\n  if (routeQuery.value.businessType === \"1\") {\r\n    Reflect.set(params, \"code\", routeQuery.value.code ?? \"1\");\r\n    Reflect.set(params, \"startTime\", startTime);\r\n    Reflect.set(params, \"endTime\", endTime);\r\n    api = interfaceCallRecordListApi;\r\n  } else {\r\n    Reflect.set(params, \"startAt\", startTime);\r\n    Reflect.set(params, \"endAt\", endTime);\r\n    Reflect.set(params, \"agentSwitch\", 1);\r\n    api = directCallRecordListApi\r\n  }\r\n  if (!api) return;\r\n  const { data } = await api.getData(params);\r\n  const result = api.handleData(data);\r\n  pageData.list = result.list;\r\n  pageData.pageTotal = result.total;\r\n}\r\nfunction pageSizeChange(value) {\r\n  pageData.pageSize = value;\r\n  getList();\r\n}\r\nfunction pageNumberChange(value) {\r\n  pageData.pageNumber = value;\r\n  getList();\r\n}\r\n// 高级筛选回调\r\nconst handleFilter = (value) => {\r\n  const { calleeNum, callerNum, bindNum, status, dateList } = value;\r\n  paramsData.status = status;\r\n  paramsData.dateList = dateList;\r\n  paramsData.calleeNum = calleeNum;\r\n  paramsData.callerNum = callerNum;\r\n  paramsData.bindNum = bindNum;\r\n  if (calleeNum || callerNum) paramsData.callNum = \"\";\r\n  getList();\r\n};\r\n\r\n// 时间转换\r\nconst changeDate = (value: any[]) => {\r\n  if (value) {\r\n    paramsData.dateList = [dateStartOf(value[0]), dateEndOf(value[1])];\r\n  } else {\r\n    paramsData.dateList = [dateStartOf(), dateEndOf()];\r\n  }\r\n  getList();\r\n};\r\n\r\n// 打开高级筛选抽屉\r\nconst openAdvancedFilter = () => {\r\n  initData.advancedFilterVisible = true;\r\n};\r\n\r\n// 下载录音\r\nfunction download(fileId: string) {\r\n  const params = {\r\n    companyId: virCompanyId,\r\n    fileId,\r\n  };\r\n  ossDownLoad(params);\r\n}\r\n// 播放录音\r\nfunction handlePlayAudio(row) {\r\n  initData.aPlayer = new APlayer({\r\n    container: document.getElementById(\"player\"),\r\n    autoplay: true,\r\n    loop: \"none\",\r\n    audio: [\r\n      {\r\n        name: \"被叫：\" + row.calleeNum,\r\n        artist: \"录音\",\r\n        url: row.recordFileUrl,\r\n        cover: \"favicon.ico\",\r\n      },\r\n    ],\r\n  });\r\n  (initData.aPlayer as any).on(\"ended\", function () {\r\n    (initData.aPlayer as any).destroy();\r\n  });\r\n}\r\n//导出数据\r\nconst handleExport = async () => {\r\n  const filterData = {\r\n    pageNo: pageData.pageNumber,\r\n    pageSize: pageData.pageSize,\r\n    status: paramsData.status,\r\n    callNum: paramsData.callNum,\r\n    bindNum: paramsData.bindNum,\r\n    calleeNum: paramsData.calleeNum,\r\n    callerNum: paramsData.callerNum,\r\n  };\r\n  if (String(routeQuery.value.businessType) === '1') {\r\n    const params = {\r\n      api: `${serviceName.bdConsole}/agent-call-phone-record-statistics/exportAgentCdr`,\r\n      method: \"post\",\r\n      formData: Object.assign(\r\n        {\r\n          code: routeQuery.value.code,\r\n          startTime: paramsData.dateList[0],\r\n          endTime: paramsData.dateList[1],\r\n          companyId: Number(routeQuery.value.companyId),\r\n        },\r\n        filterData\r\n      ),\r\n    };\r\n    await downloadFile(params);\r\n  } else {\r\n    const params = {\r\n      api: `${serviceName.callRest}/call-record/exportAgentCdr`,\r\n      method: \"post\",\r\n      headers: {\r\n        \"content-type\": \"application/json\",\r\n      },\r\n      formData: Object.assign(\r\n        {\r\n          companyId: Number(routeQuery.value.companyId),\r\n          startAt: paramsData.dateList[0],\r\n          endAt: paramsData.dateList[1],\r\n        },\r\n        filterData\r\n      ),\r\n    };\r\n    await downloadFile(params);\r\n  }\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.form-container {\r\n  justify-content: flex-end;\r\n  .el-input {\r\n    width: 220px;\r\n    margin-right: 10px;\r\n  }\r\n  :deep(.el-date-editor.el-input__wrapper) {\r\n    width: 260px;\r\n    flex-grow: inherit;\r\n    margin-right: 10px;\r\n  }\r\n}\r\n#player {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  z-index: 2000;\r\n}\r\n</style>\r\n","import script from \"./list.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./list.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./list.vue?vue&type=style&index=0&id=1529a367&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../../../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_typescript@5.7.2__webpack@5.97.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1529a367\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_defineComponent","__name","setup","__props","AdvancedFilterDrawer","defineAsyncComponent","routeQuery","useVueRouter","virCompanyId","LocalStorage","getItem","initData","reactive","advancedFilterVisible","aPlayer","pageData","list","pageTotal","pageSize","pageNumber","recordFileUrl","paramsData","callNum","calleeNum","callerNum","bindNum","status","dateList","dateStartOf","dateEndOf","disabledDateInstance","DisabledDate","async","getList","api","params","pageNo","companyId","value","startTime","endTime","businessType","Reflect","set","code","interfaceCallRecordListApi","directCallRecordListApi","data","getData","result","handleData","total","pageSizeChange","pageNumberChange","handleFilter","changeDate","openAdvancedFilter","download","fileId","ossDownLoad","handlePlayAudio","row","APlayer","container","document","getElementById","autoplay","loop","audio","name","artist","url","cover","on","destroy","handleExport","filterData","String","serviceName","bdConsole","method","formData","Object","assign","Number","downloadFile","callRest","headers","startAt","endAt","_ctx","_cache","_component_el_icon","_resolveComponent","_component_el_input","_component_el_date_picker","_component_el_button","_component_el_table_column","_component_el_link","_component_el_tag","_component_TableEmpty","_component_el_table","_component_PagePagination","_openBlock","_createElementBlock","_createElementVNode","id","_createVNode","modelValue","$event","placeholder","clearable","suffix","_withCtx","onClick","default","_unref","Search","_","type","format","onChange","onCalendarChange","handleCalendar","time","handleDisabled","_createTextVNode","height","empty","prop","label","align","underline","disabled","recordFileId","callDetailsStyleType","_toDisplayString","callDetailsName","onEmitPageSizeChange","onEmitPageNumberChange","visible","onEmitFunc","__exports__"],"sourceRoot":""}