{"version":3,"file":"static/js/2487.3efe81af.js","mappings":"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","sources":["webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-package-seat-big.vue?4ca0","webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-package-seat-big.vue","webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-package-seat-big.vue?3757"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, unref as _unref, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"product-detail\" }\nconst _hoisted_2 = { class: \"service-specs\" }\nconst _hoisted_3 = { class: \"purchased-info\" }\nconst _hoisted_4 = { class: \"word\" }\n\nimport { computed, shallowRef, shallowReactive } from \"vue\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\n\r\nconst addedServiceCode = \"CALL_PACKAGE_BIG_ADDED\";\r\n// 购买信息\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'cloud-call-package-seat-big',\n  props: {\n    productData: {},\n    purchasedData: {}\n  },\n  setup(__props: any) {\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { serviceCode, companyId, profileId, buyType } = routeQuery.value;\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = __props;\r\n\r\nconst initData = shallowReactive<{\r\n  customCount: number;\r\n  count: string | number;\r\n  sumPrice: string | number;\r\n}>({\r\n  count: 0,\r\n  customCount: 1,\r\n  sumPrice: \"0.00\",\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\n// 增值服务编码\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\nconsole.log(serviceInfo.value);\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList.find(\r\n    (item: any) => item.addedServiceCode === addedServiceCode\r\n  );\r\n});\r\n// 购买规格\r\nconst specsInfo = computed(() => {\r\n  const defaultSpecsInfo: Record<string, any> = {\r\n    minNum: 1,\r\n    maxNum: 100000,\r\n    coding: \"\",\r\n    unitPrice: \"0.00\",\r\n    serviceCode: \"\",\r\n    groupNameList: [],\r\n    groupCodeList: [],\r\n    groupValueList: [],\r\n  };\r\n  if (!addedServiceInfo.value.specsList.length) return defaultSpecsInfo;\r\n  const getSpecsInfo = (specsValues: string) => {\r\n    const findInfo = addedServiceInfo.value.specsList.find(\r\n      (item: any) => item.groupValues === specsValues\r\n    );\r\n    if (findInfo) {\r\n      return {\r\n        minNum: findInfo?.minNum,\r\n        maxNum: findInfo?.maxNum,\r\n        coding: findInfo?.coding,\r\n        unitPrice: findInfo?.unitPrice,\r\n        serviceCode: findInfo?.serviceCode,\r\n        groupNameList: findInfo?.groupNames?.split(\",\") || [],\r\n        groupCodeList: findInfo?.groupCodes?.split(\",\") || [],\r\n        groupValueList: findInfo?.groupValues?.split(\",\") || [],\r\n      };\r\n    }\r\n    return defaultSpecsInfo;\r\n  };\r\n  const { minimunCharge, chooseMinFee, chooseMinute } = purchasedInfo.value;\r\n  const specsValues = `${minimunCharge},${chooseMinFee},${chooseMinute}`;\r\n  return getSpecsInfo(specsValues);\r\n});\r\n// 坐席列表\r\nconst seatList = computed(() => {\r\n  const baseList: Record<string, any>[] = [\r\n    { label: \"10个\", value: 10 },\r\n    { label: \"30个\", value: 30 },\r\n    { label: \"50个\", value: 50 },\r\n  ];\r\n  if (productInfo.value?.canBuy) {\r\n    baseList.unshift({\r\n      label: `${specsInfo.value?.minNum}个`,\r\n      value: Number(specsInfo.value?.minNum),\r\n    });\r\n  }\r\n  if (addedServiceInfo.value?.isDiy) {\r\n    baseList.push({ label: \"自定义\", value: \"custom\" });\r\n  }\r\n  return baseList;\r\n});\r\n// 坐席数量\r\nconst seatCount = computed(() => {\r\n  return initData.count === \"custom\" ? initData.customCount : initData.count;\r\n});\r\n// 剩余天数\r\nconst surplusTime = computed(() => {\r\n  const startDate = dayjs().startOf(\"month\");\r\n  const endDate = dayjs(purchasedInfo.value?.endTime).endOf(\"month\");\r\n  return endDate.diff(startDate, \"month\") || 0;\r\n});\r\n// 总计描述\r\nconst sumDescribe = computed(() => {\r\n  return `合计： 坐席单价${agentInfo.value.unitPrice}元/坐席/月 x ${seatCount.value}个坐席 x 剩余${surplusTime.value}个月  = ${agentInfo.value.sumPrice}元`; // 大客户套餐\r\n});\r\n\r\nhandleDefault();\r\n\r\n// 初始化数据\r\nfunction handleDefault() {\r\n  initData.count = seatList.value[0]?.value;\r\n  initData.customCount = specsInfo.value?.minNum;\r\n  getPrice();\r\n}\r\n\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const params = {\r\n    agentId: userInfo.profileId, // 代理商id\r\n    buyCar: false, // 是否为购物车下单\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    buyType: buyType ?? \"BUY_SERVER\", // 购买：BUY_SERVER,升级：UPGRADE,续费：RENEW\r\n    companyId: companyId, // 代理商子公司id\r\n    profileId: profileId, // 代理商子公司操作人id\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"2\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 时长\r\n        marketCode: serviceCode,\r\n        userNumber: seatCount.value,\r\n        coding: [\r\n          {\r\n            code: specsInfo.value.serviceCode,\r\n            coding: specsInfo.value.coding,\r\n            num: seatCount.value,\r\n          },\r\n        ],\r\n        baseCodeList: specsInfo.value.groupCodeList.map((item, index) => {\r\n          return {\r\n            baseCode: item,\r\n            number: specsInfo.value.groupValueList[index],\r\n          };\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `坐席数量：${seatCount.value}个坐席；`,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_input_number = _resolveComponent(\"el-input-number\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(BaseServiceInfo, { serviceData: serviceInfo.value }, null, 8, [\"serviceData\"]),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createVNode(_component_el_form, { \"label-width\": \"150px\" }, {\n        default: _withCtx(() => [\n          (productInfo.value?.canBuy)\n            ? (_openBlock(), _createBlock(_component_el_form_item, {\n                key: 0,\n                label: \"已购详情\"\n              }, {\n                default: _withCtx(() => [\n                  _createElementVNode(\"div\", _hoisted_3, [\n                    _createElementVNode(\"span\", null, \" 已购坐席数：\" + _toDisplayString(purchasedInfo.value.seatSize) + _toDisplayString(serviceInfo.value.unit), 1),\n                    _createElementVNode(\"span\", null, \"服务到期时间：\" + _toDisplayString(purchasedInfo.value.endTime), 1)\n                  ])\n                ]),\n                _: 1\n              }))\n            : _createCommentVNode(\"\", true),\n          _createVNode(_component_el_form_item, {\n            label: \"购买数量\",\n            class: \"amount-form-item\"\n          }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: _unref(initData).count,\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((_unref(initData).count) = $event)),\n                onChange: getPrice\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(seatList.value, (item) => {\n                    return (_openBlock(), _createBlock(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"]))\n                  }), 128))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"]),\n              (_unref(initData).count === 'custom')\n                ? (_openBlock(), _createBlock(_component_el_input_number, {\n                    key: 0,\n                    modelValue: _unref(initData).customCount,\n                    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => ((_unref(initData).customCount) = $event)),\n                    min: specsInfo.value.minNum,\n                    max: specsInfo.value.maxNum,\n                    step: addedServiceInfo.value.miniNum,\n                    onChange: getPrice\n                  }, null, 8, [\"modelValue\", \"min\", \"max\", \"step\"]))\n                : _createCommentVNode(\"\", true)\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, null, {\n            default: _withCtx(() => [\n              _createElementVNode(\"p\", _hoisted_4, _toDisplayString(sumDescribe.value), 1)\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(BaseSumPrice, {\n        onEmitFunc: handleBuy,\n        \"buy-price\": agentInfo.value.price,\n        \"can-buy\": productInfo.value?.canBuy,\n        hasAgentPrice: agentInfo.value.hasAgentPrice,\n        tip: \"购买此产品前，需要先购买鱼鹰呼叫大客户套餐\"\n      }, null, 8, [\"buy-price\", \"can-buy\", \"hasAgentPrice\"])\n    ])\n  ]))\n}\n}\n\n})","<template>\r\n  <div class=\"product-detail\">\r\n    <BaseServiceInfo :serviceData=\"serviceInfo\"></BaseServiceInfo>\r\n    <div class=\"service-specs\">\r\n      <el-form label-width=\"150px\">\r\n        <template v-if=\"productInfo?.canBuy\">\r\n          <el-form-item label=\"已购详情\">\r\n            <div class=\"purchased-info\">\r\n              <span>\r\n                已购坐席数：{{ purchasedInfo.seatSize }}{{ serviceInfo.unit }}\r\n              </span>\r\n              <span>服务到期时间：{{ purchasedInfo.endTime }}</span>\r\n            </div>\r\n          </el-form-item>\r\n        </template>\r\n        <el-form-item label=\"购买数量\" class=\"amount-form-item\">\r\n          <el-select v-model=\"initData.count\" @change=\"getPrice\">\r\n            <el-option\r\n              v-for=\"item in seatList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            />\r\n          </el-select>\r\n          <el-input-number\r\n            v-if=\"initData.count === 'custom'\"\r\n            v-model=\"initData.customCount\"\r\n            :min=\"specsInfo.minNum\"\r\n            :max=\"specsInfo.maxNum\"\r\n            :step=\"addedServiceInfo.miniNum\"\r\n            @change=\"getPrice\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p class=\"word\">{{ sumDescribe }}</p>\r\n        </el-form-item>\r\n      </el-form>\r\n      <BaseSumPrice\r\n        @emitFunc=\"handleBuy\"\r\n        :buy-price=\"agentInfo.price\"\r\n        :can-buy=\"productInfo?.canBuy\"\r\n        :hasAgentPrice=\"agentInfo.hasAgentPrice\"\r\n        tip=\"购买此产品前，需要先购买鱼鹰呼叫大客户套餐\"\r\n      ></BaseSumPrice>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, shallowRef, shallowReactive } from \"vue\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { serviceCode, companyId, profileId, buyType } = routeQuery.value;\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = defineProps<{\r\n  productData: Record<string, any>;\r\n  purchasedData: Record<string, any>[];\r\n}>();\r\n\r\nconst initData = shallowReactive<{\r\n  customCount: number;\r\n  count: string | number;\r\n  sumPrice: string | number;\r\n}>({\r\n  count: 0,\r\n  customCount: 1,\r\n  sumPrice: \"0.00\",\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\n// 增值服务编码\r\nconst addedServiceCode = \"CALL_PACKAGE_BIG_ADDED\";\r\n// 购买信息\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\nconsole.log(serviceInfo.value);\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList.find(\r\n    (item: any) => item.addedServiceCode === addedServiceCode\r\n  );\r\n});\r\n// 购买规格\r\nconst specsInfo = computed(() => {\r\n  const defaultSpecsInfo: Record<string, any> = {\r\n    minNum: 1,\r\n    maxNum: 100000,\r\n    coding: \"\",\r\n    unitPrice: \"0.00\",\r\n    serviceCode: \"\",\r\n    groupNameList: [],\r\n    groupCodeList: [],\r\n    groupValueList: [],\r\n  };\r\n  if (!addedServiceInfo.value.specsList.length) return defaultSpecsInfo;\r\n  const getSpecsInfo = (specsValues: string) => {\r\n    const findInfo = addedServiceInfo.value.specsList.find(\r\n      (item: any) => item.groupValues === specsValues\r\n    );\r\n    if (findInfo) {\r\n      return {\r\n        minNum: findInfo?.minNum,\r\n        maxNum: findInfo?.maxNum,\r\n        coding: findInfo?.coding,\r\n        unitPrice: findInfo?.unitPrice,\r\n        serviceCode: findInfo?.serviceCode,\r\n        groupNameList: findInfo?.groupNames?.split(\",\") || [],\r\n        groupCodeList: findInfo?.groupCodes?.split(\",\") || [],\r\n        groupValueList: findInfo?.groupValues?.split(\",\") || [],\r\n      };\r\n    }\r\n    return defaultSpecsInfo;\r\n  };\r\n  const { minimunCharge, chooseMinFee, chooseMinute } = purchasedInfo.value;\r\n  const specsValues = `${minimunCharge},${chooseMinFee},${chooseMinute}`;\r\n  return getSpecsInfo(specsValues);\r\n});\r\n// 坐席列表\r\nconst seatList = computed(() => {\r\n  const baseList: Record<string, any>[] = [\r\n    { label: \"10个\", value: 10 },\r\n    { label: \"30个\", value: 30 },\r\n    { label: \"50个\", value: 50 },\r\n  ];\r\n  if (productInfo.value?.canBuy) {\r\n    baseList.unshift({\r\n      label: `${specsInfo.value?.minNum}个`,\r\n      value: Number(specsInfo.value?.minNum),\r\n    });\r\n  }\r\n  if (addedServiceInfo.value?.isDiy) {\r\n    baseList.push({ label: \"自定义\", value: \"custom\" });\r\n  }\r\n  return baseList;\r\n});\r\n// 坐席数量\r\nconst seatCount = computed(() => {\r\n  return initData.count === \"custom\" ? initData.customCount : initData.count;\r\n});\r\n// 剩余天数\r\nconst surplusTime = computed(() => {\r\n  const startDate = dayjs().startOf(\"month\");\r\n  const endDate = dayjs(purchasedInfo.value?.endTime).endOf(\"month\");\r\n  return endDate.diff(startDate, \"month\") || 0;\r\n});\r\n// 总计描述\r\nconst sumDescribe = computed(() => {\r\n  return `合计： 坐席单价${agentInfo.value.unitPrice}元/坐席/月 x ${seatCount.value}个坐席 x 剩余${surplusTime.value}个月  = ${agentInfo.value.sumPrice}元`; // 大客户套餐\r\n});\r\n\r\nhandleDefault();\r\n\r\n// 初始化数据\r\nfunction handleDefault() {\r\n  initData.count = seatList.value[0]?.value;\r\n  initData.customCount = specsInfo.value?.minNum;\r\n  getPrice();\r\n}\r\n\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const params = {\r\n    agentId: userInfo.profileId, // 代理商id\r\n    buyCar: false, // 是否为购物车下单\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    buyType: buyType ?? \"BUY_SERVER\", // 购买：BUY_SERVER,升级：UPGRADE,续费：RENEW\r\n    companyId: companyId, // 代理商子公司id\r\n    profileId: profileId, // 代理商子公司操作人id\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"2\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 时长\r\n        marketCode: serviceCode,\r\n        userNumber: seatCount.value,\r\n        coding: [\r\n          {\r\n            code: specsInfo.value.serviceCode,\r\n            coding: specsInfo.value.coding,\r\n            num: seatCount.value,\r\n          },\r\n        ],\r\n        baseCodeList: specsInfo.value.groupCodeList.map((item, index) => {\r\n          return {\r\n            baseCode: item,\r\n            number: specsInfo.value.groupValueList[index],\r\n          };\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `坐席数量：${seatCount.value}个坐席；`,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n</script>\r\n","import script from \"./cloud-call-package-seat-big.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./cloud-call-package-seat-big.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","addedServiceCode","_defineComponent","__name","props","productData","purchasedData","setup","__props","routeQuery","useVueRouter","serviceCode","companyId","profileId","buyType","value","bd_userInfo","userInfo","LocalStorage","batchGetItem","initData","shallowReactive","count","customCount","sumPrice","agentInfo","shallowRef","price","unitPrice","addedPrice","subMarketList","hasAgentPrice","purchasedInfo","computed","productInfo","serviceInfo","console","log","addedServiceInfo","_productInfo$value","addedServiceList","find","item","specsInfo","defaultSpecsInfo","minNum","maxNum","coding","groupNameList","groupCodeList","groupValueList","specsList","length","getSpecsInfo","specsValues","findInfo","groupValues","_findInfo$groupNames","_findInfo$groupCodes","_findInfo$groupValues","groupNames","split","groupCodes","minimunCharge","chooseMinFee","chooseMinute","seatList","_productInfo$value2","_addedServiceInfo$val","baseList","label","_specsInfo$value","_specsInfo$value2","canBuy","unshift","Number","isDiy","push","seatCount","surplusTime","_purchasedInfo$value","startDate","dayjs","startOf","endDate","endTime","endOf","diff","sumDescribe","handleDefault","_seatList$value$","_specsInfo$value3","getPrice","handleParams","params","agentId","buyCar","helpOrder","shopBuyList","isisTry","dateType","dateValue","marketCode","userNumber","code","num","baseCodeList","map","index","baseCode","number","commodityInfo","list","async","handlePrice","handleBuy","createdOrder","_ctx","_cache","_productInfo$value4","_component_el_form_item","_resolveComponent","_component_el_option","_component_el_select","_component_el_input_number","_component_el_form","_openBlock","_createElementBlock","_createVNode","BaseServiceInfo","serviceData","_createElementVNode","default","_withCtx","_productInfo$value3","_createBlock","key","_toDisplayString","seatSize","unit","_","_createCommentVNode","modelValue","_unref","$event","onChange","_Fragment","_renderList","min","max","step","miniNum","BaseSumPrice","onEmitFunc","tip","__exports__"],"sourceRoot":""}