"use strict";(self["webpackChunkdaili"]=self["webpackChunkdaili"]||[]).push([[1992],{71992:function(e,l,a){a.r(l),a.d(l,{default:function(){return R}});var o=a(6254),t=a(25598),n=a(91373),u=a(88365),d=a(65802),r=a(59259);const p={class:"form-item-inner"},m={class:"form-item-inner"},i={class:"form-item-inner"};var c=(0,o.pM)({__name:"AddFundVoucherDrawer",props:{refresh:{type:Function}},setup(e,{expose:l}){const a=e,c=(0,t.KR)(!1),s=(0,t.Kh)({companyId:"",couponAmount:"",productIds:["1"],expTime:""}),b=(0,t.KR)(),f=(e,l,a)=>{if(!(0,u.Bl)(l))return a(new Error("请输入正确金额"));a()},g={companyId:[{required:!0,message:"输入公司名称",trigger:"blur"}],couponAmount:[{required:!0,validator:f,trigger:"blur"}],productIds:[{required:!0,message:"请选择使用范围",trigger:"blur"}],expTime:[{required:!0,message:"请选择到期时间",trigger:"blur"}]},k=(0,t.KR)([]),v=(0,t.KR)([]),F=(0,t.KR)(!1),y=u.DT.getItem("bd_agentId"),_=u.DT.getItem("bd_userInfo"),h=e=>{e?(F.value=!0,N(e)):k.value=[]};function I(){c.value=!1}function C(){s.productIds.includes("1")&&(s.productIds=[])}function w(){b.value.validate((e=>{e&&(console.log(e,"valid"),C(),(0,d.Vr)({agencyId:y,couponAmount:s.couponAmount,productIds:s.productIds,expTime:s.expTime,companyId:s.companyId,createdBy:_.profileId,createdName:_.realName}).then((e=>{var l,o;console.log(e,"line 178"),r.nk.success(e.msg||"操作成功"),null===(l=a.refresh)||void 0===l||l.call(a),null===(o=b.value)||void 0===o||o.resetFields(),R(!1)})))}))}function R(e=!0){c.value=e,e&&V()}function N(e){(0,d.T3)({companyName:e,parentId:_.profileId,page:1,pageSize:50}).then((e=>{var l;console.log(e,"line 170"),F.value=!1,k.value=(null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.records)||[]}))}function V(){(0,d.Ws)({agencyId:y}).then((e=>{console.log(e,"line 41"),v.value=(null===e||void 0===e?void 0:e.data)||[]}))}return(0,o.wB)(c,(e=>{var l;e||(null===(l=b.value)||void 0===l||l.resetFields())})),l({toggle:R}),(e,l)=>{const a=(0,o.g2)("el-option"),u=(0,o.g2)("el-select"),d=(0,o.g2)("el-form-item"),r=(0,o.g2)("el-input"),f=(0,o.g2)("el-icon"),y=(0,o.g2)("el-tooltip"),_=(0,o.g2)("el-date-picker"),C=(0,o.g2)("el-form"),N=(0,o.g2)("el-button"),V=(0,o.g2)("el-drawer");return(0,o.uX)(),(0,o.Wv)(V,{"model-value":c.value,title:"新增资金券",size:"500",class:"custom-drawer","before-close":I},{footer:(0,o.k6)((()=>[(0,o.bF)(N,{type:"primary",onClick:w},{default:(0,o.k6)((()=>l[5]||(l[5]=[(0,o.eW)("确认下发")]))),_:1}),(0,o.bF)(N,{onClick:l[4]||(l[4]=e=>R(!1))},{default:(0,o.k6)((()=>l[6]||(l[6]=[(0,o.eW)("关闭")]))),_:1})])),default:(0,o.k6)((()=>[(0,o.bF)(C,{ref_key:"formRef",ref:b,model:s,rules:g},{default:(0,o.k6)((()=>[(0,o.bF)(d,{label:"选择公司：",prop:"companyId"},{default:(0,o.k6)((()=>[(0,o.bF)(u,{modelValue:s.companyId,"onUpdate:modelValue":l[0]||(l[0]=e=>s.companyId=e),filterable:"",remote:"","reserve-keyword":"",placeholder:"输入公司名称，在客户管理中搜索公司信息","remote-show-suffix":"","remote-method":h,loading:F.value,style:{width:"360px"}},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(k.value,(e=>((0,o.uX)(),(0,o.Wv)(a,{key:e.companyId,label:`${e.companyName} —— ${e.companyCode}`,value:e.companyId},null,8,["label","value"])))),128))])),_:1},8,["modelValue","loading"])])),_:1}),(0,o.bF)(d,{label:"分配金额：",prop:"couponAmount"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",p,[(0,o.bF)(r,{style:{width:"360px"},modelValue:s.couponAmount,"onUpdate:modelValue":l[1]||(l[1]=e=>s.couponAmount=e),placeholder:"请输入金额"},null,8,["modelValue"]),(0,o.bF)(y,{class:"box-item",effect:"dark",content:"下发给客户的资金将以调拨类型从代理商余额中扣除。",placement:"top"},{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.bF)((0,t.R1)(n.lOC))])),_:1})])),_:1})])])),_:1}),(0,o.bF)(d,{label:"使用范围：",prop:"productIds"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",m,[(0,o.bF)(u,{style:{width:"360px"},modelValue:s.productIds,"onUpdate:modelValue":l[2]||(l[2]=e=>s.productIds=e),multiple:"",placeholder:"请选择使用范围"},{default:(0,o.k6)((()=>[(0,o.bF)(a,{label:"全部",value:"1"}),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(v.value,(e=>((0,o.uX)(),(0,o.Wv)(a,{key:e.productId,label:e.productName,value:e.productId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,o.bF)(y,{class:"box-item",effect:"dark",content:"可用来购买那些产品，如果选择全部，则可以用来支付代理商代理的全部产品。",placement:"top"},{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.bF)((0,t.R1)(n.lOC))])),_:1})])),_:1})])])),_:1}),(0,o.bF)(d,{label:"到期时间：",prop:"expTime"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",i,[(0,o.bF)(_,{style:{width:"360px"},modelValue:s.expTime,"onUpdate:modelValue":l[3]||(l[3]=e=>s.expTime=e),type:"datetime",placeholder:"请选择到期时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"]),(0,o.bF)(y,{class:"box-item",effect:"dark",content:"券到期后，自动退回到代理商余额中。",placement:"top"},{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.bF)((0,t.R1)(n.lOC))])),_:1})])),_:1})])])),_:1})])),_:1},8,["model"])])),_:1},8,["model-value"])}}}),s=a(83936);const b=(0,s.A)(c,[["__scopeId","data-v-dfe2187c"]]);var f=b,g=a(38627),k=(0,o.pM)({__name:"FundAllocationDetailsDrawer",props:{info:{}},setup(e,{expose:l}){const a=e,n=(0,t.KR)(!1);function u(){n.value=!1}function d(e){return e?`${e}￥`:"-"}function r(e=!0){n.value=e}return l({toggle:r}),(e,l)=>{const t=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-form"),m=(0,o.g2)("el-button"),i=(0,o.g2)("el-drawer");return(0,o.uX)(),(0,o.Wv)(i,{"model-value":n.value,title:"查看使用情况",size:"600",class:"custom-drawer","before-close":u},{footer:(0,o.k6)((()=>[(0,o.bF)(m,{onClick:l[0]||(l[0]=e=>r(!1))},{default:(0,o.k6)((()=>l[1]||(l[1]=[(0,o.eW)("关闭")]))),_:1})])),default:(0,o.k6)((()=>[(0,o.bF)(p,null,{default:(0,o.k6)((()=>[(0,o.bF)(t,{label:"选择公司："},{default:(0,o.k6)((()=>[(0,o.eW)((0,g.v_)(a.info.companyName||"-"),1)])),_:1}),(0,o.bF)(t,{label:"分配金额："},{default:(0,o.k6)((()=>[(0,o.eW)((0,g.v_)(d(a.info.couponAmount)),1)])),_:1}),(0,o.bF)(t,{label:"订单编号："},{default:(0,o.k6)((()=>[(0,o.eW)((0,g.v_)(a.info.orderNo),1)])),_:1}),(0,o.bF)(t,{label:"订单金额："},{default:(0,o.k6)((()=>[(0,o.eW)((0,g.v_)(d(a.info.orderAmount)),1)])),_:1}),(0,o.bF)(t,{label:"资金券使用："},{default:(0,o.k6)((()=>[(0,o.eW)((0,g.v_)(d(a.info.useAmount)),1)])),_:1}),(0,o.bF)(t,{label:"客户余额使用："},{default:(0,o.k6)((()=>[(0,o.eW)((0,g.v_)(d(a.info.balanceAmount)),1)])),_:1})])),_:1})])),_:1},8,["model-value"])}}});const v=k;var F=v,y=a(6934);const _={class:"fund-allocation-page"},h={class:"table-container"},I={key:2};var C=(0,o.pM)({__name:"index",setup(e){const l=(0,t.KR)("1"),a=(0,t.KR)(),p=(0,t.KR)(),m=(0,t.KR)({}),i=[{label:"待使用",name:"1"},{label:"已使用",name:"2"},{label:"已过期",name:"3"},{label:"全部",name:""}],c=u.DT.getItem("bd_agentId"),{pageNumberChange:s,pageSizeChange:b,pageData:g,getList:k,resetPageNumber:v}=(0,u.N5)({listApi:d.cV,props:{pageNumber:"current",pageSize:"size"},searchParams(){return{agencyId:c,status:l.value,page:g.pageNumber,pageSize:g.pageSize,companyName:C.companyName,companyCode:C.companyCode}},notExecute:!0}),C=(0,t.Kh)({companyName:"",companyCode:""});function w(e){m.value=e,(0,o.dY)((()=>{p.value.toggle()}))}function R(e){y.s.confirm("回收资金券后客户不可再使用该金额在服务市场下单。","确认回收资金券",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,d.SM)({couponId:e.id}).then((e=>{r.nk.success(e.msg||"收回成功")}))}))}return k(),(e,u)=>{const d=(0,o.g2)("el-tab-pane"),r=(0,o.g2)("el-tabs"),c=(0,o.g2)("el-input"),v=(0,o.g2)("el-form-item"),y=(0,o.g2)("el-button"),N=(0,o.g2)("el-form"),V=(0,o.g2)("el-table-column"),x=(0,o.g2)("el-icon"),T=(0,o.g2)("el-tooltip"),W=(0,o.g2)("el-link"),A=(0,o.g2)("TableEmpty"),K=(0,o.g2)("el-table"),z=(0,o.g2)("PagePagination");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",_,[(0,o.bF)(r,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=e=>l.value=e),class:"no-border-tabs",onTabChange:(0,t.R1)(k)},{default:(0,o.k6)((()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(i,(e=>(0,o.bF)(d,{key:e.name,label:e.label,name:e.name},null,8,["label","name"]))),64))])),_:1},8,["modelValue","onTabChange"]),(0,o.bF)(N,{class:"modify-form-style",inline:!0,model:C},{default:(0,o.k6)((()=>[(0,o.bF)(v,{label:"企业名称："},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:C.companyName,"onUpdate:modelValue":u[1]||(u[1]=e=>C.companyName=e),placeholder:"请输入企业名称"},null,8,["modelValue"])])),_:1}),(0,o.bF)(v,{label:"企业代码："},{default:(0,o.k6)((()=>[(0,o.bF)(c,{modelValue:C.companyCode,"onUpdate:modelValue":u[2]||(u[2]=e=>C.companyCode=e),placeholder:"请输入企业代码"},null,8,["modelValue"])])),_:1}),(0,o.bF)(v,null,{default:(0,o.k6)((()=>{var e;return[(0,o.bF)(y,{type:"primary",onClick:(0,t.R1)(k)},{default:(0,o.k6)((()=>u[3]||(u[3]=[(0,o.eW)("搜索")]))),_:1},8,["onClick"]),(0,o.bF)(y,{type:"primary",onClick:null===(e=a.value)||void 0===e?void 0:e.toggle},{default:(0,o.k6)((()=>u[4]||(u[4]=[(0,o.eW)("下发资金券 ")]))),_:1},8,["onClick"])]})),_:1})])),_:1},8,["model"]),(0,o.Lk)("div",h,[(0,o.bF)(K,{data:(0,t.R1)(g).list,height:"calc(100vh - 280px)"},{empty:(0,o.k6)((()=>[(0,o.bF)(A)])),default:(0,o.k6)((()=>[(0,o.bF)(V,{prop:"companyName",label:"企业名称","min-width":"200"}),(0,o.bF)(V,{prop:"companyCode",label:"企业代码",width:"130"}),(0,o.bF)(V,{prop:"couponAmount",label:"代金券金额",width:"160"}),(0,o.bF)(V,{prop:"statusText",label:"使用状态",width:"130"}),(0,o.bF)(V,{prop:"useAmount",label:"实际使用金额",width:"180"},{header:(0,o.k6)((()=>[u[5]||(u[5]=(0,o.eW)(" 实际使用金额 ")),(0,o.bF)(T,{class:"box-item",effect:"dark",content:"代金券只能使用一次，使用后产生了多余金额，退回 代理商余额中。",placement:"top"},{default:(0,o.k6)((()=>[(0,o.bF)(x,null,{default:(0,o.k6)((()=>[(0,o.bF)((0,t.R1)(n.lOC))])),_:1})])),_:1})])),_:1}),(0,o.bF)(V,{prop:"useTime",label:"实际使用时间",width:"200"}),(0,o.bF)(V,{prop:"createdName",label:"创建人",width:"160"}),(0,o.bF)(V,{prop:"createdTime",label:"创建时间",width:"200"}),(0,o.bF)(V,{prop:"companyName",label:"操作",width:"120"},{default:(0,o.k6)((({row:e})=>[1===e.status?((0,o.uX)(),(0,o.Wv)(W,{key:0,type:"primary",onClick:l=>R(e)},{default:(0,o.k6)((()=>u[6]||(u[6]=[(0,o.eW)(" 收回 ")]))),_:2},1032,["onClick"])):2===e.status?((0,o.uX)(),(0,o.Wv)(W,{key:1,type:"primary",onClick:l=>w(e)},{default:(0,o.k6)((()=>u[7]||(u[7]=[(0,o.eW)(" 查看 ")]))),_:2},1032,["onClick"])):((0,o.uX)(),(0,o.CE)("span",I,"-"))])),_:1})])),_:1},8,["data"]),(0,o.bF)(z,{pageTotal:(0,t.R1)(g).pageTotal,pageSize:(0,t.R1)(g).pageSize,pageNumber:(0,t.R1)(g).pageNumber,onEmitPageSizeChange:(0,t.R1)(b),onEmitPageNumberChange:(0,t.R1)(s)},null,8,["pageTotal","pageSize","pageNumber","onEmitPageSizeChange","onEmitPageNumberChange"])])]),(0,o.bF)(f,{ref_key:"addFundVoucherDrawerRef",ref:a,refresh:(0,t.R1)(k)},null,8,["refresh"]),(0,o.bF)(F,{info:m.value,ref_key:"fundAllocationDetailsDrawerRef",ref:p},null,8,["info"])],64)}}});const w=(0,s.A)(C,[["__scopeId","data-v-bcbb504e"]]);var R=w}}]);
//# sourceMappingURL=1992.d40150dd.js.map