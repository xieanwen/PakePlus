"use strict";(self["webpackChunkdaili"]=self["webpackChunkdaili"]||[]).push([[9128],{79128:function(e,a,l){l.r(a),l.d(a,{default:function(){return y}});l(95226),l(59784),l(47961),l(70549),l(83238);var u=l(6254),t=l(25598),o=l(38627),i=l(10901),c=l(88365),s=l(95239);const d={class:"product-name"},n={class:"product-price"},r={class:"product-price"},v={class:"dialog-footer"};var m=(0,u.pM)({__name:"renew-dialog",setup(e,{expose:a}){const{routeQuery:l,goPage:m}=(0,i.dG)(),{bd_userInfo:b}=c.DT.batchGetItem(["bd_userInfo"]),p=(0,t.Gc)({visible:!1,timeList:[{label:"1年",value:"1"},{label:"2年",value:"2"},{label:"3年",value:"3"}]}),y=(0,t.IJ)({}),C=(0,t.IJ)({}),f=(0,t.IJ)({}),L=(0,t.IJ)({}),_=(0,t.Gc)({cycle:"1",payType:"WX",productPrice:"0.00",sumPrice:"0.00"}),g=[{label:"微信",value:"WX",modePayment:"onlinePayment"},{label:"支付宝",value:"ZFB",modePayment:"onlinePayment"},{label:"代理商企付宝",value:"DLSZHYE",modePayment:"balancePayment"},{label:"代理商预付款",value:"DLSYHK",modePayment:"balancePayment"}];async function I(){if("service"===y.value.productType){const e={serviceCode:y.value.combineServiceCode},{data:a}=await s.dh.getData(e);if(f.value=s.dh.handleData(a),["CLOUD_CALL_PACKAGE","CLOUD_CALL_SOFT"].includes(y.value.combineServiceCode)){const e={CLOUD_CALL_SOFT:"CALL_CENTER_ADDED",CLOUD_CALL_PACKAGE:"CALL_PACKAGE_ADDED_NEW"};p.timeList=h(e[y.value.combineServiceCode],0,f.value.addedServiceList)}else["SCRM","WEB_CUSTOMER_PHONE"].includes(y.value.combineServiceCode)&&(p.timeList=[{label:"1年",value:"1"}]);_.cycle=p.timeList[0].value}else if("resource"===y.value.productType){const e={sizeCode:y.value.addedCodes},{data:a}=await s.eW.getData(e);f.value=s.eW.handleData(a)}}async function P(e=y.value.combineServiceCode){const a={agentId:b.profileId,helpOrder:1,companyId:l.value.companyId,marketCode:e,addedCode:y.value.addedCodes},{data:u}=await s.z5.getData(a);L.value=s.z5.handleData(u)}async function k(){const e={companyId:l.value.companyId,marketCode:y.value.combineServiceCode},{data:a}=await s.JV.getData(e);C.value=s.JV.handleData(a)}function h(e,a,l){const u=[],t=l.find((a=>a.addedServiceCode===e)).specsList;return(0,c.TC)(t)?(t.forEach((e=>{const l=e.groupNames.split(","),t=e.groupValues.split(","),o=e.groupCodes.split(","),i={minNum:e.minNum,maxNum:e.maxNum,coding:e.coding,serviceCode:e.serviceCode,groupNameList:l,groupValueList:t,groupCodeList:o},c=u.find((e=>e.value===t[a]));c?c.specs.push(i):u.push({value:t[a],label:l[a],specs:[i]})})),u.sort(((e,a)=>e.value-a.value))):u}function N(){const e=new BigNumber(_.cycle).toNumber()*new BigNumber(L.value.basePrice).toNumber(),a=new BigNumber(L.value.addedPrice).toNumber();_.sumPrice=(0,c.CE)(e,a)?new BigNumber(e+a).toFixed(2):"0.00",_.productPrice=e?new BigNumber(e).toFixed(2):"0.00"}function T(){var e;const a=f.value.serviceInfo,u=g.find((e=>_.payType===e.value)),t={agentId:b.profileId,buyCar:!1,helpOrder:1,buyType:"RENEW",paymentType:null===u||void 0===u?void 0:u.value,modePayment:null===u||void 0===u?void 0:u.modePayment,companyId:l.value.companyId,profileId:l.value.profileId,shopBuyList:[{agentId:b.profileId,isisTry:!1,dateType:["CLOUD_CALL_PACKAGE","CLOUD_CALL_SOFT"].includes(a.combineServiceCode)?2:3,dateValue:_.cycle,marketCode:a.combineServiceCode,baseCodeList:[]}],sumPrice:_.sumPrice},o={list:[{...null===(e=f.value)||void 0===e?void 0:e.serviceInfo,price:_.productPrice,augmentedServiceList:L.value.subMarketList.map((e=>("1"===e.calculateType&&(e.specsInfo=`${_.cycle}个月`),e)))}],sumPrice:_.sumPrice};if(["1"].includes(a.calculateType)){t.shopBuyList[0].baseCodeList=[{baseCode:null,number:0}];const e=`${_.cycle}年期；`;Reflect.set(o.list[0],"specsInfo",e)}else if(["2"].includes(a.calculateType)){t.shopBuyList[0].baseCodeList=[{baseCode:y.value.addedCodes,number:y.value.residue}];const e=`续费数量：${y.value.residue}${y.value.unit}；${_.cycle}年期；`;Reflect.set(o.list[0],"specsInfo",e)}else if(["3"].includes(a.calculateType)){t.shopBuyList[0].baseCodeList=[{baseCode:"CALL_PACKAGE_TIME",number:_.cycle}];const e=new BigNumber(C.value.seatSize).toNumber(),a=new BigNumber(C.value.chooseMinute).toNumber(),l=e&&a?new BigNumber(e&&a).toNumber():0,u=`套餐周期：${_.cycle}个月；最低消费：${C.value.chooseMinFee}元/坐席/月；系统软件费：${C.value.callSoftPrice}元/坐席/月；${y.value.userNumber}个坐席；${C.value.chooseMinute}分钟/坐席/月（总计${l}分钟/月，分钟数可共享）；`;Reflect.set(o.list[0],"specsInfo",u)}else if(["6"].includes(a.calculateType)){t.shopBuyList[0].baseCodeList=[{baseCode:a.addedCodes,number:y.value.userNumber}];const e=`${y.value.userNumber}个坐席；坐席单价${L.value.seatUnitPrice}元；${_.cycle}个月；`;Reflect.set(o.list[0],"specsInfo",e)}c.uW.setItem("bd_market-cart",t),c.uW.setItem("bd_market-commodity",o),m("/orderManagement/createOrder/confirmOrder")}function A(){p.visible=!1,p.timeList=[{label:"1年",value:"1"},{label:"2年",value:"2"},{label:"3年",value:"3"}],_.cycle="1",_.payType="WX",_.sumPrice="0.00",y.value={},C.value={},f.value={},L.value={}}function D(e,a){y.value=a,p.visible=e;let l=[];"service"===y.value.productType?(l=[P(),I()],["CLOUD_CALL_PACKAGE"].includes(y.value.combineServiceCode)&&l.push(k()),Promise.allSettled(l).then((()=>{N()}))):"resource"===y.value.productType&&I().then((async()=>{await P(f.value.serviceInfo.combineServiceCode),N()}))}return a({toggle:D}),(e,a)=>{const l=(0,u.g2)("el-form-item"),i=(0,u.g2)("el-option"),c=(0,u.g2)("el-select"),s=(0,u.g2)("el-form"),m=(0,u.g2)("el-button"),b=(0,u.g2)("el-dialog");return(0,u.uX)(),(0,u.Wv)(b,{"model-value":(0,t.R1)(p).visible,title:"续费",width:"480",onClosed:A,class:"custom-dialog"},{footer:(0,u.k6)((()=>[(0,u.Lk)("div",v,[(0,u.bF)(m,{onClick:A},{default:(0,u.k6)((()=>a[2]||(a[2]=[(0,u.eW)("取消")]))),_:1}),(0,u.bF)(m,{type:"primary",onClick:T},{default:(0,u.k6)((()=>a[3]||(a[3]=[(0,u.eW)("续费")]))),_:1})])])),default:(0,u.k6)((()=>[(0,u.bF)(s,{ref:"form","label-width":"100"},{default:(0,u.k6)((()=>[(0,u.bF)(l,{label:"续费产品"},{default:(0,u.k6)((()=>[(0,u.Lk)("h6",d,(0,o.v_)(y.value.combineServiceName),1)])),_:1}),(0,u.bF)(l,{label:"续费时间"},{default:(0,u.k6)((()=>[(0,u.bF)(c,{modelValue:(0,t.R1)(_).cycle,"onUpdate:modelValue":a[0]||(a[0]=e=>(0,t.R1)(_).cycle=e),onChange:N},{default:(0,u.k6)((()=>[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)((0,t.R1)(p).timeList,(e=>((0,u.uX)(),(0,u.Wv)(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),"resource"===y.value.productType?((0,u.uX)(),(0,u.Wv)(l,{key:0,label:"续费数量"},{default:(0,u.k6)((()=>[(0,u.Lk)("span",n,(0,o.v_)(y.value.residue)+(0,o.v_)(y.value.unit),1)])),_:1})):(0,u.Q3)("",!0),(0,u.bF)(l,{label:"续费价格"},{default:(0,u.k6)((()=>[(0,u.Lk)("span",r,"¥ "+(0,o.v_)((0,t.R1)(_).sumPrice),1)])),_:1}),(0,u.bF)(l,{label:"支付方式"},{default:(0,u.k6)((()=>[(0,u.bF)(c,{modelValue:(0,t.R1)(_).payType,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,t.R1)(_).payType=e)},{default:(0,u.k6)((()=>[((0,u.uX)(),(0,u.CE)(u.FK,null,(0,u.pI)(g,(e=>(0,u.bF)(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1})])),_:1},512)])),_:1},8,["model-value"])}}}),b=l(83936);const p=(0,b.A)(m,[["__scopeId","data-v-0d80b5f8"]]);var y=p}}]);
//# sourceMappingURL=9128.b983107e.js.map