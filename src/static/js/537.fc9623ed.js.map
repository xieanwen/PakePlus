{"version":3,"file":"static/js/537.fc9623ed.js","mappings":"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","sources":["webpack://daili/./src/components/order-management/create-order/product-detail/channel-package.vue?5869","webpack://daili/./src/components/order-management/create-order/product-detail/channel-package.vue","webpack://daili/./src/components/order-management/create-order/product-detail/channel-package.vue?b947"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createCommentVNode as _createCommentVNode } from \"vue\"\n\nconst _hoisted_1 = { class: \"service-specs\" }\nconst _hoisted_2 = { class: \"purchased-list\" }\nconst _hoisted_3 = { class: \"grids clearfix\" }\nconst _hoisted_4 = { class: \"toper\" }\nconst _hoisted_5 = { class: \"tit\" }\nconst _hoisted_6 = { class: \"format\" }\nconst _hoisted_7 = { class: \"word\" }\n\nimport { computed, onMounted, reactive, watch, shallowRef } from \"vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomCheckboxButtonGroup from \"@components/common/custom-checkbox-button-group.vue\";\r\nimport BaseSumPrice from \"@components/order-management/create-order/product-detail/base-sum-price.vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\n\r\ninterface AllDataType {\r\n  specList: any[];\r\n  activeSpecCodes: string[];\r\n  gridList: any[];\r\n}\r\n\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'channel-package',\n  props: {\n    productData: {},\n    purchasedData: {}\n  },\n  setup(__props: any) {\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { serviceCode, companyId, profileId } = routeQuery.value;\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = __props;\r\n\r\nconst allData = reactive<AllDataType>({\r\n  specList: [],\r\n  gridList: [],\r\n  activeSpecCodes: [],\r\n});\r\n\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\nconsole.log(props.productData);\r\n// 所有信息\r\nconst productInfo = computed(() => {\r\n  return props.productData;\r\n});\r\n\r\n// 服务基本信息\r\nconst serviceInfo = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n\r\n// 增值服务\r\nconst addedServiceList = computed(() => {\r\n  return productInfo.value?.addedServiceList;\r\n});\r\n\r\n// 更新gridList\r\nconst chGridList = () => {\r\n  allData.gridList = allData.gridList.map((grid: any) => {\r\n    const code = grid.code;\r\n    const isSelect = allData.activeSpecCodes.includes(code);\r\n    if (isSelect) {\r\n      const item = addedServiceList.value.find(\r\n        (addedService: any) => addedService.addedServiceCode === code\r\n      );\r\n      const specsList = item.specsList || [];\r\n      const label: string = item.addedServiceName;\r\n      const coding: string = specsList[0]?.coding || \"\";\r\n      const groupCodes = specsList[0]?.groupCodes || \"\";\r\n      const value = grid.value || specsList[0]?.minNum || 1;\r\n      const price = specsList[0]?.unitPrice || 0;\r\n      const minNum = specsList[0]?.minNum || 1;\r\n      const maxNum = specsList[0]?.maxNum || 1;\r\n      const incrementNum = item.mininum || 1;\r\n      const hidden = specsList[0]?.hidden || 0;\r\n      const historyIndex = purchasedInfo.value.findIndex(\r\n        (item) => item.consumptionTypeCd === groupCodes\r\n      );\r\n      const time =\r\n        historyIndex === -1\r\n          ? new Date()\r\n          : purchasedInfo.value[historyIndex].endTime;\r\n      const nowDateStamp = dayjs().format(\"YYYY-MM-DD\"); // 当前天数\r\n      const expireDateStamp = dayjs(time).format(\"YYYY-MM-DD\"); // 到期天数\r\n      return {\r\n        label,\r\n        code,\r\n        coding,\r\n        groupCodes,\r\n        value,\r\n        price,\r\n        minNum,\r\n        maxNum,\r\n        incrementNum,\r\n        hidden,\r\n        isUpgrade: historyIndex !== -1,\r\n        dateNum: new BigNumber(\r\n          dayjs(expireDateStamp).diff(nowDateStamp, \"days\")\r\n        ).toNumber(),\r\n      };\r\n    } else {\r\n      return { code, hidden: 1 };\r\n    }\r\n  });\r\n};\r\n\r\n// 购买规格描述\r\nconst specsDescribe = computed(() => {\r\n  return allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .reduce((pre, item) => {\r\n      return pre + `${item.label}：${item.value}${serviceInfo.value.unit}；`;\r\n    }, \"\");\r\n});\r\n\r\n// 合计描述\r\nconst sumDescribe = computed(() => {\r\n  const totalTip = allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .map((grid: any) => {\r\n      const isUpgrade = grid.isUpgrade;\r\n      if (isUpgrade)\r\n        return `${grid.label}：剩余天数${grid.dateNum}/一年365天x${grid.price}元/个x${grid.value}个`;\r\n      else return `${grid.label}：${grid.price}元/个x${grid.value}个`;\r\n    })\r\n    .join(\" + \");\r\n  return `合计：${totalTip} = ${agentInfo.value.price}元`;\r\n});\r\n\r\n// 已购买信息（升级时需要）\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n\r\n// 初始化受邀规模列表\r\nconst initSpecList = () => {\r\n  allData.specList =\r\n    addedServiceList.value?.map((item: any) => ({\r\n      label: item.addedServiceName,\r\n      value: item.addedServiceCode,\r\n    })) || [];\r\n};\r\n\r\n// 初始化受邀规模高亮值\r\nconst initActiveSpecCodes = () => {\r\n  allData.activeSpecCodes = allData.specList[0]?.value\r\n    ? [allData.specList[0]?.value]\r\n    : [];\r\n};\r\n\r\n// 初始化gridList\r\nconst initGridList = () => {\r\n  allData.gridList = allData.specList.map((spec: any) => ({\r\n    code: spec.value,\r\n    hidden: 1,\r\n  }));\r\n};\r\n\r\n// 参数处理\r\nfunction handleParams() {\r\n  const coding = allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .map((grid: any) => ({\r\n      code: grid.code,\r\n      num: grid.value,\r\n      coding: grid.coding,\r\n    }));\r\n  const baseCodeList = allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .map((grid: any) => ({\r\n      baseCode: grid.groupCodes,\r\n      number: grid.value,\r\n    }));\r\n  const params = {\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    agentId: userInfo.profileId, // 代理商id\r\n    companyId: companyId, // 代理商子公司id\r\n    profileId: profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\", // 购买：BUY_SERVER、升级：UPGRADE、续费：RENEW\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 默认1\r\n        marketCode: serviceCode,\r\n        // userNumber: finalCount.value, // 购买数量\r\n        coding: coding,\r\n        baseCodeList: baseCodeList,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: specsDescribe.value,\r\n        augmentedServiceList: [],\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\r\nwatch(\r\n  () => allData.activeSpecCodes,\r\n  () => {\r\n    chGridList();\r\n    getPrice();\r\n  }\r\n);\r\n\r\nonMounted(async () => {\r\n  initSpecList();\r\n  initGridList();\r\n  initActiveSpecCodes();\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_input_number = _resolveComponent(\"el-input-number\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", null, [\n    _createVNode(BaseServiceInfo, { serviceData: serviceInfo.value }, null, 8, [\"serviceData\"]),\n    _createElementVNode(\"div\", _hoisted_1, [\n      _createVNode(_component_el_form, { \"label-width\": \"150px\" }, {\n        default: _withCtx(() => [\n          (purchasedInfo.value.length)\n            ? (_openBlock(), _createBlock(_component_el_form_item, {\n                key: 0,\n                label: \"已购详情\"\n              }, {\n                default: _withCtx(() => [\n                  _createElementVNode(\"ul\", _hoisted_2, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(purchasedInfo.value, (item, index) => {\n                      return (_openBlock(), _createElementBlock(\"li\", { key: index }, [\n                        _createElementVNode(\"span\", null, _toDisplayString(item.resourceName), 1),\n                        _createElementVNode(\"span\", null, \"已购买数量：\" + _toDisplayString(item.resourceCount) + _toDisplayString(serviceInfo.value.unit), 1),\n                        _createElementVNode(\"span\", null, \"服务到期时间：\" + _toDisplayString(item.endTime), 1)\n                      ]))\n                    }), 128))\n                  ])\n                ]),\n                _: 1\n              }))\n            : _createCommentVNode(\"\", true),\n          _createVNode(_component_el_form_item, { label: \"受邀规模\" }, {\n            default: _withCtx(() => [\n              _createVNode(CustomCheckboxButtonGroup, {\n                direction: \"row\",\n                list: allData.specList,\n                modelValue: allData.activeSpecCodes,\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((allData.activeSpecCodes) = $event))\n              }, null, 8, [\"list\", \"modelValue\"])\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, { label: \"资源数量\" }, {\n            default: _withCtx(() => [\n              _createElementVNode(\"ul\", _hoisted_3, [\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(allData.gridList, (v, i) => {\n                  return (_openBlock(), _createElementBlock(_Fragment, null, [\n                    (v.hidden !== 1)\n                      ? (_openBlock(), _createElementBlock(\"li\", {\n                          key: i,\n                          class: \"grid\"\n                        }, [\n                          _createElementVNode(\"div\", _hoisted_4, [\n                            _createElementVNode(\"p\", _hoisted_5, _toDisplayString(v.label), 1),\n                            _createElementVNode(\"p\", _hoisted_6, _toDisplayString(v.price) + \"元 * \" + _toDisplayString(v.value) + \"个\", 1)\n                          ]),\n                          _createVNode(_component_el_input_number, {\n                            class: \"step-input\",\n                            modelValue: v.value,\n                            \"onUpdate:modelValue\": ($event: any) => ((v.value) = $event),\n                            min: v.minNum,\n                            max: v.maxNum,\n                            step: v.incrementNum,\n                            \"step-strictly\": \"\",\n                            \"value-on-clear\": v.minNum,\n                            onChange: getPrice\n                          }, null, 8, [\"modelValue\", \"onUpdate:modelValue\", \"min\", \"max\", \"step\", \"value-on-clear\"])\n                        ]))\n                      : _createCommentVNode(\"\", true)\n                  ], 64))\n                }), 256))\n              ])\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, null, {\n            default: _withCtx(() => [\n              _createElementVNode(\"p\", _hoisted_7, _toDisplayString(sumDescribe.value), 1)\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(BaseSumPrice, {\n        onEmitFunc: handleBuy,\n        \"buy-price\": agentInfo.value.sumPrice,\n        \"can-buy\": productInfo.value?.canBuy,\n        hasAgentPrice: agentInfo.value.hasAgentPrice\n      }, null, 8, [\"buy-price\", \"can-buy\", \"hasAgentPrice\"])\n    ])\n  ]))\n}\n}\n\n})","<template>\r\n  <div>\r\n    <BaseServiceInfo :serviceData=\"serviceInfo\"></BaseServiceInfo>\r\n    <div class=\"service-specs\">\r\n      <el-form label-width=\"150px\">\r\n        <template v-if=\"purchasedInfo.length\">\r\n          <el-form-item label=\"已购详情\">\r\n            <ul class=\"purchased-list\">\r\n              <li v-for=\"(item, index) in purchasedInfo\" :key=\"index\">\r\n                <span>{{ item.resourceName }}</span>\r\n                <span\r\n                  >已购买数量：{{ item.resourceCount\r\n                  }}{{ serviceInfo.unit }}</span\r\n                >\r\n                <span>服务到期时间：{{ item.endTime }}</span>\r\n              </li>\r\n            </ul>\r\n          </el-form-item>\r\n        </template>\r\n        <el-form-item label=\"受邀规模\">\r\n          <CustomCheckboxButtonGroup\r\n            direction=\"row\"\r\n            :list=\"allData.specList\"\r\n            v-model=\"allData.activeSpecCodes\"\r\n          >\r\n          </CustomCheckboxButtonGroup>\r\n        </el-form-item>\r\n        <el-form-item label=\"资源数量\">\r\n          <ul class=\"grids clearfix\">\r\n            <template v-for=\"(v, i) in allData.gridList\">\r\n              <li v-if=\"v.hidden !== 1\" :key=\"i\" class=\"grid\">\r\n                <div class=\"toper\">\r\n                  <p class=\"tit\">{{ v.label }}</p>\r\n                  <p class=\"format\">{{ v.price }}元 * {{ v.value }}个</p>\r\n                </div>\r\n                <el-input-number\r\n                  class=\"step-input\"\r\n                  v-model=\"v.value\"\r\n                  :min=\"v.minNum\"\r\n                  :max=\"v.maxNum\"\r\n                  :step=\"v.incrementNum\"\r\n                  step-strictly\r\n                  :value-on-clear=\"v.minNum\"\r\n                  @change=\"getPrice\"\r\n                ></el-input-number>\r\n              </li>\r\n            </template>\r\n          </ul>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p class=\"word\">\r\n            {{ sumDescribe }}\r\n          </p>\r\n        </el-form-item>\r\n      </el-form>\r\n      <BaseSumPrice\r\n        @emitFunc=\"handleBuy\"\r\n        :buy-price=\"agentInfo.sumPrice\"\r\n        :can-buy=\"productInfo?.canBuy\"\r\n        :hasAgentPrice=\"agentInfo.hasAgentPrice\"\r\n      ></BaseSumPrice>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, onMounted, reactive, watch, shallowRef } from \"vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomCheckboxButtonGroup from \"@components/common/custom-checkbox-button-group.vue\";\r\nimport BaseSumPrice from \"@components/order-management/create-order/product-detail/base-sum-price.vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\n\r\ninterface AllDataType {\r\n  specList: any[];\r\n  activeSpecCodes: string[];\r\n  gridList: any[];\r\n}\r\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { serviceCode, companyId, profileId } = routeQuery.value;\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = defineProps<{\r\n  productData: Record<string, any>;\r\n  purchasedData: Record<string, any>[];\r\n}>();\r\n\r\nconst allData = reactive<AllDataType>({\r\n  specList: [],\r\n  gridList: [],\r\n  activeSpecCodes: [],\r\n});\r\n\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\nconsole.log(props.productData);\r\n// 所有信息\r\nconst productInfo = computed(() => {\r\n  return props.productData;\r\n});\r\n\r\n// 服务基本信息\r\nconst serviceInfo = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n\r\n// 增值服务\r\nconst addedServiceList = computed(() => {\r\n  return productInfo.value?.addedServiceList;\r\n});\r\n\r\n// 更新gridList\r\nconst chGridList = () => {\r\n  allData.gridList = allData.gridList.map((grid: any) => {\r\n    const code = grid.code;\r\n    const isSelect = allData.activeSpecCodes.includes(code);\r\n    if (isSelect) {\r\n      const item = addedServiceList.value.find(\r\n        (addedService: any) => addedService.addedServiceCode === code\r\n      );\r\n      const specsList = item.specsList || [];\r\n      const label: string = item.addedServiceName;\r\n      const coding: string = specsList[0]?.coding || \"\";\r\n      const groupCodes = specsList[0]?.groupCodes || \"\";\r\n      const value = grid.value || specsList[0]?.minNum || 1;\r\n      const price = specsList[0]?.unitPrice || 0;\r\n      const minNum = specsList[0]?.minNum || 1;\r\n      const maxNum = specsList[0]?.maxNum || 1;\r\n      const incrementNum = item.mininum || 1;\r\n      const hidden = specsList[0]?.hidden || 0;\r\n      const historyIndex = purchasedInfo.value.findIndex(\r\n        (item) => item.consumptionTypeCd === groupCodes\r\n      );\r\n      const time =\r\n        historyIndex === -1\r\n          ? new Date()\r\n          : purchasedInfo.value[historyIndex].endTime;\r\n      const nowDateStamp = dayjs().format(\"YYYY-MM-DD\"); // 当前天数\r\n      const expireDateStamp = dayjs(time).format(\"YYYY-MM-DD\"); // 到期天数\r\n      return {\r\n        label,\r\n        code,\r\n        coding,\r\n        groupCodes,\r\n        value,\r\n        price,\r\n        minNum,\r\n        maxNum,\r\n        incrementNum,\r\n        hidden,\r\n        isUpgrade: historyIndex !== -1,\r\n        dateNum: new BigNumber(\r\n          dayjs(expireDateStamp).diff(nowDateStamp, \"days\")\r\n        ).toNumber(),\r\n      };\r\n    } else {\r\n      return { code, hidden: 1 };\r\n    }\r\n  });\r\n};\r\n\r\n// 购买规格描述\r\nconst specsDescribe = computed(() => {\r\n  return allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .reduce((pre, item) => {\r\n      return pre + `${item.label}：${item.value}${serviceInfo.value.unit}；`;\r\n    }, \"\");\r\n});\r\n\r\n// 合计描述\r\nconst sumDescribe = computed(() => {\r\n  const totalTip = allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .map((grid: any) => {\r\n      const isUpgrade = grid.isUpgrade;\r\n      if (isUpgrade)\r\n        return `${grid.label}：剩余天数${grid.dateNum}/一年365天x${grid.price}元/个x${grid.value}个`;\r\n      else return `${grid.label}：${grid.price}元/个x${grid.value}个`;\r\n    })\r\n    .join(\" + \");\r\n  return `合计：${totalTip} = ${agentInfo.value.price}元`;\r\n});\r\n\r\n// 已购买信息（升级时需要）\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n\r\n// 初始化受邀规模列表\r\nconst initSpecList = () => {\r\n  allData.specList =\r\n    addedServiceList.value?.map((item: any) => ({\r\n      label: item.addedServiceName,\r\n      value: item.addedServiceCode,\r\n    })) || [];\r\n};\r\n\r\n// 初始化受邀规模高亮值\r\nconst initActiveSpecCodes = () => {\r\n  allData.activeSpecCodes = allData.specList[0]?.value\r\n    ? [allData.specList[0]?.value]\r\n    : [];\r\n};\r\n\r\n// 初始化gridList\r\nconst initGridList = () => {\r\n  allData.gridList = allData.specList.map((spec: any) => ({\r\n    code: spec.value,\r\n    hidden: 1,\r\n  }));\r\n};\r\n\r\n// 参数处理\r\nfunction handleParams() {\r\n  const coding = allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .map((grid: any) => ({\r\n      code: grid.code,\r\n      num: grid.value,\r\n      coding: grid.coding,\r\n    }));\r\n  const baseCodeList = allData.gridList\r\n    .filter((grid: any) => grid.hidden !== 1)\r\n    .map((grid: any) => ({\r\n      baseCode: grid.groupCodes,\r\n      number: grid.value,\r\n    }));\r\n  const params = {\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    agentId: userInfo.profileId, // 代理商id\r\n    companyId: companyId, // 代理商子公司id\r\n    profileId: profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\", // 购买：BUY_SERVER、升级：UPGRADE、续费：RENEW\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 默认1\r\n        marketCode: serviceCode,\r\n        // userNumber: finalCount.value, // 购买数量\r\n        coding: coding,\r\n        baseCodeList: baseCodeList,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: specsDescribe.value,\r\n        augmentedServiceList: [],\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\r\nwatch(\r\n  () => allData.activeSpecCodes,\r\n  () => {\r\n    chGridList();\r\n    getPrice();\r\n  }\r\n);\r\n\r\nonMounted(async () => {\r\n  initSpecList();\r\n  initGridList();\r\n  initActiveSpecCodes();\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.purchased-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  li {\r\n    display: flex;\r\n    align-items: flex-start;\r\n    column-gap: 20px;\r\n    line-height: 24px;\r\n    color: #606266;\r\n    span:nth-child(1) {\r\n      width: 100px;\r\n    }\r\n    span:nth-child(2) {\r\n      width: 140px;\r\n    }\r\n    span:last-child {\r\n      width: 200px;\r\n    }\r\n  }\r\n}\r\n.grids {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  width: 460px;\r\n  .grid {\r\n    width: 220px;\r\n    margin-bottom: 10px;\r\n    border: 1px solid #0056ff;\r\n    &:nth-child(2n + 1) {\r\n      margin-right: 20px;\r\n    }\r\n    .toper {\r\n      position: relative;\r\n      z-index: 2;\r\n      padding: 20px;\r\n      .tit {\r\n        font-size: 16px;\r\n        line-height: 30px;\r\n        color: #0056ff;\r\n        text-align: center;\r\n      }\r\n      .format {\r\n        line-height: 24px;\r\n        color: #0056ff;\r\n        text-align: center;\r\n      }\r\n      &::after {\r\n        position: absolute;\r\n        bottom: -1px;\r\n        left: 0;\r\n        display: block;\r\n        width: 100%;\r\n        height: 1px;\r\n        content: \"\";\r\n        background: #0056ff;\r\n      }\r\n    }\r\n    .step-input {\r\n      width: 100%;\r\n      margin: 0;\r\n      :deep(.el-input__wrapper) {\r\n        box-shadow: none !important;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import script from \"./channel-package.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./channel-package.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./channel-package.vue?vue&type=style&index=0&id=578de4c1&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_typescript@5.7.2__webpack@5.97.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-578de4c1\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_defineComponent","__name","props","productData","purchasedData","setup","__props","routeQuery","useVueRouter","serviceCode","companyId","profileId","value","bd_userInfo","userInfo","LocalStorage","batchGetItem","allData","reactive","specList","gridList","activeSpecCodes","agentInfo","shallowRef","price","sumPrice","unitPrice","addedPrice","subMarketList","hasAgentPrice","console","log","productInfo","computed","serviceInfo","addedServiceList","_productInfo$value","chGridList","map","grid","code","isSelect","includes","_specsList$","_specsList$2","_specsList$3","_specsList$4","_specsList$5","_specsList$6","_specsList$7","item","find","addedService","addedServiceCode","specsList","label","addedServiceName","coding","groupCodes","minNum","maxNum","incrementNum","mininum","hidden","historyIndex","purchasedInfo","findIndex","consumptionTypeCd","time","Date","endTime","nowDateStamp","dayjs","format","expireDateStamp","isUpgrade","dateNum","BigNumber","diff","toNumber","specsDescribe","filter","reduce","pre","unit","sumDescribe","totalTip","join","initSpecList","_addedServiceList$val","initActiveSpecCodes","_allData$specList$","_allData$specList$2","initGridList","spec","handleParams","num","baseCodeList","baseCode","number","params","helpOrder","agentId","buyType","shopBuyList","isisTry","dateType","dateValue","marketCode","commodityInfo","list","specsInfo","augmentedServiceList","async","getPrice","handlePrice","handleBuy","createdOrder","watch","onMounted","_ctx","_cache","_productInfo$value2","_component_el_form_item","_resolveComponent","_component_el_input_number","_component_el_form","_openBlock","_createElementBlock","_createVNode","BaseServiceInfo","serviceData","_createElementVNode","default","_withCtx","length","_createBlock","key","_Fragment","_renderList","index","_toDisplayString","resourceName","resourceCount","_","_createCommentVNode","CustomCheckboxButtonGroup","direction","modelValue","$event","v","i","min","max","step","onChange","BaseSumPrice","onEmitFunc","canBuy","__exports__"],"sourceRoot":""}