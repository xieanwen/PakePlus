"use strict";(self["webpackChunkdaili"]=self["webpackChunkdaili"]||[]).push([[4233],{4233:function(e,a,l){l.r(a),l.d(a,{default:function(){return V}});var t=l(6254),n=l(25598),o=l(38627),u=l(88365),d=l(27412),i=l(10901),s=l(57030),r=l(59259);const c={class:"dialog-footer"};var p=(0,t.pM)({__name:"change-number",emits:["emitFunc"],setup(e,{expose:a,emit:l}){u.DT.getItem("bd_userInfo");const o=u.DT.getItem("bd_virCompanyId"),i=l,s=(0,n.KR)(),p=(0,n.KR)(!1);let m=(0,n.Kh)({});const b=(0,n.Kh)({reason:"1",imageCode:""}),g=((0,n.Kh)({codeImageUrl:"",uuid:""}),[{label:"标记过多",value:"1"},{label:"被投诉",value:"2"},{label:"其他",value:"3"},{label:"不使用混显号码",value:"5"}]),v=(0,n.KR)([]),f={reason:[{required:!0,message:"请选择换号原因",trigger:"blur"}]},k=()=>{},h=()=>{s.value.resetFields(),p.value=!1},y=()=>{s.value.validate((async e=>{if(!e)return!1;{const e={changeReasonType:b.reason,phoneId:m.id,operatorId:o,phoneNumber:m.num,companyCode:m.companyCode,companyId:m.companyId,agentUserType:m.type,numCompanyId:m.numCompanyId};"5"===b.reason&&(e.labelNames=m.sceneName);const a=await d.rs.getData(e);(0,r.nk)({message:a.msg||"换号中，请稍等",type:"success"}),h(),setTimeout((()=>{i("emitFunc")}),1e3)}}))},C=(e,a={})=>{m=a,m.isMixed?v.value=g:v.value=g.filter((e=>"5"!==e.value)),p.value=e};return a({toggle:C}),(e,a)=>{const l=(0,t.g2)("el-option"),n=(0,t.g2)("el-select"),o=(0,t.g2)("el-form-item"),u=(0,t.g2)("el-form"),d=(0,t.g2)("el-button"),i=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.Wv)(i,{class:"custom-dialog",width:"450px",title:"申请换号","model-value":p.value,onClose:h,onOpen:k},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",c,[(0,t.bF)(d,{onClick:h},{default:(0,t.k6)((()=>a[2]||(a[2]=[(0,t.eW)("取消")]))),_:1}),(0,t.bF)(d,{type:"primary",onClick:y},{default:(0,t.k6)((()=>a[3]||(a[3]=[(0,t.eW)("确定")]))),_:1})])])),default:(0,t.k6)((()=>[(0,t.Lk)("div",null,[a[1]||(a[1]=(0,t.Lk)("div",{class:"tip"},"注：请谨慎操作！",-1)),(0,t.bF)(u,{class:"form",ref_key:"formRef",ref:s,model:b,rules:f,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(o,{label:"换号原因",prop:"reason"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{placeholder:"请选择",modelValue:b.reason,"onUpdate:modelValue":a[0]||(a[0]=e=>b.reason=e),class:"verification"},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(v.value,(e=>((0,t.uX)(),(0,t.Wv)(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["model-value"])}}}),m=l(83936);const b=(0,m.A)(p,[["__scopeId","data-v-63e16a32"]]);var g=b,v=l(27656);const f={key:0},k={class:"picture-code"},h=["src"],y={class:"telephone-code"},C={key:0,class:"count"},_={key:1,class:"unBind"},F={class:"dialog-footer"};var I=(0,t.pM)({__name:"handle-number",props:{isBind:{type:Boolean}},emits:["emitFunc","cancel"],setup(e,{expose:a,emit:l}){const i=(0,n.IJ)(!1),c=l,p=e,m=(0,n.KR)(),b=(0,n.Kh)({companyId:null,phoneNumManageId:"",staffNumber:"",validateCode:"",xnumber:"",imageCode:""}),g=(0,n.Kh)({telephoneCodeObj:{flag:!0,timer:0,count:60},telephoneCodeFlag:!1,codeImageUrl:"",uuid:""}),I={staffNumber:[{required:!0,validator:(e,a,l)=>{(0,v.lr)(e,a,l)},trigger:"blur"}],imageCode:[{required:!0,message:"请输入图形验证码",trigger:"blur"}],validateCode:[{required:!0,message:"请输入短信验证码",trigger:"blur"}]},N=(0,t.EW)((()=>(p.isBind?"绑定":"解绑")+"手机号")),R=async()=>{i.value=!0,await W()},S=()=>{c("cancel",{callback:()=>{}}),i.value=!1,clearInterval(g.telephoneCodeObj.timer),g.telephoneCodeObj.flag=!0,g.telephoneCodeObj.count=60,p.isBind&&m.value.resetFields()},W=async()=>{const e=await(0,s.z8)(),{img:a,uuid:l}=e.data;g.codeImageUrl=`data:image/png;base64,${a}`,g.uuid=l},x=()=>{const{staffNumber:e}=b,{telephoneCodeFlag:a}=g;if(a)return;if(g.telephoneCodeFlag=!0,!e)return r.nk.error("请输入手机号"),w();if(!(0,u.Pk)(e))return r.nk.error("请输入正确的手机号码"),w();if(!b.imageCode)return r.nk.error("请输入图形验证码"),w();const l={phone:e,imageCode:b.imageCode,uuid:g.uuid};d.oN.getData(l).then((()=>{r.nk.success("短信已发送"),E()})).catch((async()=>{await W()})).finally(w)},w=()=>{g.telephoneCodeFlag=!1},E=()=>{g.telephoneCodeObj.timer=setInterval((()=>{0===g.telephoneCodeObj.count?(clearInterval(g.telephoneCodeObj.timer),g.telephoneCodeObj.flag=!0,g.telephoneCodeObj.count=60):(g.telephoneCodeObj.flag=!1,g.telephoneCodeObj.count-=1)}),1e3)},O=()=>{const e=()=>{c("emitFunc"),i.value=!1};p.isBind?m.value.validate((async a=>{a&&(await T(),e(),m.value.resetFields())})):(V(),e()),clearInterval(g.telephoneCodeObj.timer),g.telephoneCodeObj.flag=!0,g.telephoneCodeObj.count=60};async function T(){const e={companyId:b.companyId,phoneNumManageId:b.phoneNumManageId,staffNumber:b.staffNumber,validateCode:b.validateCode,xnumber:b.xnumber},a=await d.qv.getData(e);0==a.statusCode&&r.nk.success("绑定成功")}async function V(){const e={companyId:b.companyId,phoneNumManageId:b.phoneNumManageId},a=await d.X8.getData(e);0==a.statusCode&&r.nk.success("解绑成功")}const X=e=>{const{companyId:a,id:l,phone:t}=e;b.companyId=a,b.phoneNumManageId=l,b.xnumber=t};return a({handleOpen:R,setData:X}),(e,a)=>{const l=(0,t.g2)("el-input"),n=(0,t.g2)("el-form-item"),u=(0,t.g2)("el-form"),d=(0,t.g2)("el-button"),s=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.Wv)(s,{class:"custom-dialog",width:"600",title:N.value,"model-value":i.value,onClose:S},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",F,[(0,t.bF)(d,{type:"primary",onClick:O},{default:(0,t.k6)((()=>a[4]||(a[4]=[(0,t.eW)("确定")]))),_:1}),(0,t.bF)(d,{onClick:S},{default:(0,t.k6)((()=>a[5]||(a[5]=[(0,t.eW)("取消")]))),_:1})])])),default:(0,t.k6)((()=>[p.isBind?((0,t.uX)(),(0,t.CE)("div",f,[(0,t.bF)(u,{class:"form",ref_key:"formRef",ref:m,model:b,rules:I,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.bF)(n,{label:"手机号码",prop:"staffNumber"},{default:(0,t.k6)((()=>[(0,t.bF)(l,{modelValue:b.staffNumber,"onUpdate:modelValue":a[0]||(a[0]=e=>b.staffNumber=e),placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),(0,t.bF)(n,{label:"图形验证码",prop:"imageCode",class:"verification"},{default:(0,t.k6)((()=>[(0,t.bF)(l,{class:"input-width",modelValue:b.imageCode,"onUpdate:modelValue":a[1]||(a[1]=e=>b.imageCode=e),placeholder:"请输入图形验证码"},null,8,["modelValue"]),(0,t.Lk)("div",k,[(0,t.Lk)("img",{src:g.codeImageUrl,onClick:W,alt:""},null,8,h)])])),_:1}),(0,t.bF)(n,{label:"短信验证码",prop:"validateCode",class:"verification"},{default:(0,t.k6)((()=>[(0,t.bF)(l,{class:"input-width",modelValue:b.validateCode,"onUpdate:modelValue":a[2]||(a[2]=e=>b.validateCode=e),placeholder:"请输入短信验证码"},null,8,["modelValue"]),(0,t.Lk)("div",y,[g.telephoneCodeObj.flag?((0,t.uX)(),(0,t.CE)("span",{key:1,onClick:x},"获取验证码")):((0,t.uX)(),(0,t.CE)("span",C,(0,o.v_)(g.telephoneCodeObj.count)+"s",1))])])),_:1}),a[3]||(a[3]=(0,t.Lk)("h4",null,[(0,t.eW)(" 绑定成功后，请留意手机号码短信，运营商系统将向你发送短信实名信息采集链接，请在"),(0,t.Lk)("br"),(0,t.eW)(" 一周内完成实名信息 ")],-1))])),_:1},8,["model"])])):((0,t.uX)(),(0,t.CE)("div",_,"确认解绑主叫号码和虚拟号码间的绑定关系！"))])),_:1},8,["title","model-value"])}}});const N=(0,m.A)(I,[["__scopeId","data-v-9783de42"]]);var R=N;const S={class:"call-statistics"},W={class:"form-container"},x={class:"search-box"},w={class:"table-container"},E={key:1};var O=(0,t.pM)({__name:"detail",setup(e){const a=[{label:"虚拟号",value:"2"},{label:"固话",value:"4"},{label:"实体卡",value:"5"},{label:"虚拟主叫",value:"7"}],l={0:"待绑定",1:"绑定中",2:"已绑定",3:"绑定失败",4:"解绑中"},s=(0,n.Kh)({isBind:!1}),r=[{label:"使用中",value:"1"},{label:"待分配",value:"0"}],{routeQuery:c}=(0,i.dG)(),p=(0,n.KR)("2"),m=(0,n.KR)(),b=(0,n.KR)(),v=(0,n.Kh)({type:c.value.type}),f=(0,n.Gc)({companyId:c.value.companyId,phone:"",phoneStatus:"",phoneType:p.value}),k=(0,t.EW)((()=>"7"!==p.value||1==v.type&&"7"==p.value)),{getList:h,pageNumberChange:y,pageSizeChange:C,pageData:_,resetPageNumber:F}=(0,u.N5)({listApi:d.lQ,props:{pageSize:"pageSize",pageNumber:"pageNo"},searchParams:()=>({...f})}),I=e=>{p.value=e.value,f.phoneType=e.value,F(),h()},N=e=>{m.value.toggle(!0,{...e,companyCode:c.value.companyCode,companyId:c.value.companyId,type:v.type})},O=({callback:e})=>{setTimeout((()=>{s.isBind=!1}),300),e&&e()},T=e=>{if(0!==e.bindStatus&&2!==e.bindStatus&&3!==e.bindStatus)return;0==e.bindStatus||3==e.bindStatus?s.isBind=!0:2==e.bindStatus&&(s.isBind=!1),b.value.handleOpen();const{setData:a}=b.value;a(e)},V=()=>{F(),h()};return(e,u)=>{const d=(0,t.g2)("TabList"),i=(0,t.g2)("el-input"),c=(0,t.g2)("el-form-item"),v=(0,t.g2)("el-option"),F=(0,t.g2)("el-select"),X=(0,t.g2)("el-button"),j=(0,t.g2)("el-form"),K=(0,t.g2)("el-tag"),B=(0,t.g2)("el-table-column"),L=(0,t.g2)("el-tooltip"),M=(0,t.g2)("TableEmpty"),U=(0,t.g2)("el-table"),z=(0,t.g2)("PagePagination");return(0,t.uX)(),(0,t.CE)("div",S,[(0,t.Lk)("div",W,[(0,t.bF)(d,{list:a,activeIndex:p.value,onEmitTab:I},null,8,["activeIndex"]),(0,t.Lk)("div",x,[(0,t.bF)(j,{model:(0,n.R1)(f),class:"form"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{label:"号码："},{default:(0,t.k6)((()=>[(0,t.bF)(i,{modelValue:(0,n.R1)(f).phone,"onUpdate:modelValue":u[0]||(u[0]=e=>(0,n.R1)(f).phone=e),placeholder:"请输入",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.bF)(c,{label:"号码状态："},{default:(0,t.k6)((()=>[(0,t.bF)(F,{placeholder:"请选择",modelValue:(0,n.R1)(f).phoneStatus,"onUpdate:modelValue":u[1]||(u[1]=e=>(0,n.R1)(f).phoneStatus=e),onChange:V,clearable:"",style:{width:"200px"}},{default:(0,t.k6)((()=>[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(r,(e=>(0,t.bF)(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),(0,t.bF)(c,null,{default:(0,t.k6)((()=>[(0,t.bF)(X,{type:"primary",style:{"margin-left":"20px"},onClick:V},{default:(0,t.k6)((()=>u[2]||(u[2]=[(0,t.eW)("搜索")]))),_:1})])),_:1})])),_:1},8,["model"])])]),(0,t.Lk)("div",w,[(0,t.bF)(U,{data:(0,n.R1)(_).list,height:"calc(100vh - 260px)"},{empty:(0,t.k6)((()=>[(0,t.bF)(M,{"empty-text":"暂无数据"})])),default:(0,t.k6)((()=>[(0,t.bF)(B,{align:"center",prop:"phone",key:"phone",label:"号码"},{default:(0,t.k6)((({row:e})=>[(0,t.eW)((0,o.v_)(e.phone)+" ",1),e.isMixed?((0,t.uX)(),(0,t.Wv)(K,{key:0,size:"small"},{default:(0,t.k6)((()=>u[3]||(u[3]=[(0,t.eW)("混显")]))),_:1})):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(B,{align:"center",prop:"city",key:"city",label:"归属地"},{default:(0,t.k6)((({row:e})=>[e.cityHandler?((0,t.uX)(),(0,t.Wv)(L,{key:0,class:"box-item",content:e.city,placement:"top"},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.cityHandler),1)])),_:2},1032,["content"])):((0,t.uX)(),(0,t.CE)("span",E,(0,o.v_)(e.city),1))])),_:1}),(0,t.bF)(B,{align:"center",prop:"useStatusName",key:"useStatusName",label:"号码状态"}),"7"==p.value?((0,t.uX)(),(0,t.Wv)(B,{align:"center",prop:"bindStatus",key:"bindStatus",label:"绑定状态"},{default:(0,t.k6)((({row:e})=>[(0,t.eW)((0,o.v_)(l[e.bindStatus]),1)])),_:1})):(0,t.Q3)("",!0),(0,t.bF)(B,{align:"center",prop:"distributeNum",key:"distributeNum",label:"并发量"}),(0,t.bF)(B,{align:"center",prop:"createTime",key:"createTime",label:"下号时间"}),(0,t.bF)(B,{align:"center",prop:"endTime",key:"endTime",label:"到期时间"}),k.value?((0,t.uX)(),(0,t.Wv)(B,{key:1,align:"center",label:"操作"},{default:(0,t.k6)((({row:e})=>["4"!==p.value&&"7"!==p.value?((0,t.uX)(),(0,t.Wv)(X,{key:0,type:"text",onClick:a=>N(e)},{default:(0,t.k6)((()=>u[4]||(u[4]=[(0,t.eW)("换号")]))),_:2},1032,["onClick"])):(0,t.Q3)("",!0),"7"==p.value?((0,t.uX)(),(0,t.Wv)(X,{key:1,type:"text",onClick:a=>T(e)},{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(0==e.bindStatus?"绑定":2==e.bindStatus?"解绑":3==e.bindStatus?"绑定":""),1)])),_:2},1032,["onClick"])):(0,t.Q3)("",!0)])),_:1})):(0,t.Q3)("",!0)])),_:1},8,["data"]),(0,t.bF)(z,{pageTotal:(0,n.R1)(_).pageTotal,pageSize:(0,n.R1)(_).pageSize,pageNumber:(0,n.R1)(_).pageNumber,onEmitPageSizeChange:(0,n.R1)(C),onEmitPageNumberChange:(0,n.R1)(y)},null,8,["pageTotal","pageSize","pageNumber","onEmitPageSizeChange","onEmitPageNumberChange"])]),(0,t.bF)(g,{ref_key:"changeNumberRef",ref:m,onEmitFunc:(0,n.R1)(h)},null,8,["onEmitFunc"]),(0,t.bF)(R,{ref_key:"handleNumberRef",ref:b,onEmitFunc:(0,n.R1)(h),onCancel:O,isBind:s.isBind},null,8,["onEmitFunc","isBind"])])}}});const T=(0,m.A)(O,[["__scopeId","data-v-69d970aa"]]);var V=T}}]);
//# sourceMappingURL=4233.fead79ee.js.map