{"version":3,"file":"static/js/7642.c26b1ad7.js","mappings":"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","sources":["webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-soft.vue?8094","webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-soft.vue","webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-soft.vue?c588"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode } from \"vue\"\n\nconst _hoisted_1 = { class: \"product-detail\" }\nconst _hoisted_2 = { class: \"service-specs\" }\nconst _hoisted_3 = { class: \"word\" }\n\nimport { ref, computed, reactive, shallowRef } from \"vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\n\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomRadioButtonGroup from \"@/components/common/custom-radio-button-group.vue\";\r\nimport { arrayHasValue } from \"jz-tool-lib\";\r\nimport BusinessScenariosDialog from \"@components/common/business-scenarios-dialog.vue\";\r\nimport { ElMessage } from \"element-plus\";\r\n\r\nconst addedServiceCode = \"CALL_CENTER_ADDED\";\r\ntype InitData = {\r\n  cycle: string;\r\n  seatNum: string | number;\r\n  seatCustomNum: number;\r\n  minSeatNum: number;\r\n  maxSeatNum: number;\r\n  cycleList: any[];\r\n  scenariosLabel: string[];\r\n  scenariosList: Record<string, any>[];\r\n  seatList: Record<string, any>[];\r\n  curSpecsInfo: Record<string, any>;\r\n};\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'cloud-call-soft',\n  props: {\n    tagList: {},\n    productData: {},\n    purchasedData: {}\n  },\n  setup(__props: any) {\n\r\nconst scenariosRef = ref();\r\nconst { routeQuery } = useVueRouter();\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = __props;\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList.find(\r\n    (item) => item.addedServiceCode === addedServiceCode\r\n  );\r\n});\r\n// 周期数据\r\nconst cycleSpecs = computed(() => {\r\n  return handleSpecs(\"cycle\", 0);\r\n});\r\n// 坐席数量\r\nconst seatCount = computed(() => {\r\n  return initData.seatNum === \"custom\"\r\n    ? initData.seatCustomNum\r\n    : initData.seatNum;\r\n});\r\n// 提示\r\nconst tipDesc = computed(() => {\r\n  const addedPrice = Number(agentInfo.value.addedPrice)\r\n    ? `+ 附赠产品${agentInfo.value.addedPrice}元`\r\n    : \"\";\r\n  if (productInfo.value?.canBuy) {\r\n    return `合计： 坐席单价${agentInfo.value.unitPrice}元 x\r\n            ${seatCount.value}个坐席 x ${initData.cycle}个月${addedPrice} = ${agentInfo.value.sumPrice}元`;\r\n  } else {\r\n    return \"\";\r\n  }\r\n});\r\n// 处理周期\r\nconst handleSpecs = (type: \"cycle\", specsIndex) => {\r\n  const list: any[] = [];\r\n  const specsList = addedServiceInfo.value?.specsList;\r\n  if (!arrayHasValue(specsList)) return list;\r\n  specsList.forEach((item) => {\r\n    const groupNameList = item.groupNames.split(\",\");\r\n    const groupValueList = item.groupValues.split(\",\");\r\n    const groupCodeList = item.groupCodes.split(\",\");\r\n    const specsValue = {\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n      coding: item.coding,\r\n      serviceCode: item.serviceCode,\r\n      groupNameList,\r\n      groupValueList,\r\n      groupCodeList,\r\n    };\r\n    const info = list.find((sonItem: Record<string, any>) => {\r\n      return sonItem.value === groupValueList[specsIndex];\r\n    });\r\n    if (!info) {\r\n      list.push({\r\n        value: groupValueList[specsIndex],\r\n        label: groupNameList[specsIndex],\r\n        specs: [specsValue],\r\n      });\r\n    } else {\r\n      info.specs.push(specsValue);\r\n    }\r\n  });\r\n  return list.sort((a, b) => {\r\n    return a.value - b.value;\r\n  });\r\n};\r\nconst initData = reactive<InitData>({\r\n  scenariosLabel: props.tagList.map((item) => item.tagName),\r\n  scenariosList: props.tagList,\r\n  cycle: \"0\", // 套餐周期\r\n  seatNum: \"\", // 坐席数量\r\n  seatCustomNum: 0, // 坐席数量\r\n  minSeatNum: 1, // 最小坐席数量\r\n  maxSeatNum: 10000000, // 最大坐席数量\r\n  cycleList: [], // 套餐周期列表\r\n  seatList: [], // 坐席数量列表\r\n  curSpecsInfo: {}, // 选择当前规格\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  subMarketList: [],\r\n});\r\n// 初始化信息\r\nhandleCycleList();\r\n\r\n// 周期切换\r\nfunction handleCycleCount(value, type) {\r\n  initData[type] = value;\r\n  const curIndex = initData[`${type}List`].findIndex(\r\n    (item) => item.value === value\r\n  );\r\n  handleCycleList(curIndex === -1 ? 0 : curIndex);\r\n}\r\n\r\n// 设置默认套餐周期和获取最低消费列表\r\nfunction handleCycleList(curIndex = 0) {\r\n  if (!cycleSpecs.value.length) return;\r\n  initData.cycleList = cycleSpecs.value;\r\n  const cycleInfo = initData.cycleList[curIndex];\r\n  initData.cycle = cycleInfo?.value ?? \"\";\r\n  handleSeatList(cycleInfo);\r\n}\r\n\r\n// 获取seat坐席列表\r\nfunction handleSeatList(cycleInfo) {\r\n  const specsInfo = cycleInfo.specs[0];\r\n  initData.seatNum = specsInfo?.minNum;\r\n  initData.seatCustomNum = specsInfo?.minNum;\r\n  initData.minSeatNum = specsInfo?.minNum;\r\n  initData.maxSeatNum = specsInfo?.maxNum;\r\n  initData.seatList = cycleInfo.specs.map((item) => {\r\n    if (initData.minSeatNum > item.minNum) initData.minSeatNum = item.minNum;\r\n    if (initData.maxSeatNum < item.maxNum) initData.maxSeatNum = item.maxNum;\r\n    return {\r\n      label: `${item.minNum}个`,\r\n      value: item.minNum,\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n    };\r\n  });\r\n  if (addedServiceInfo.value?.isDiy) {\r\n    initData.seatList.push({ label: \"自定义\", value: \"custom\" });\r\n  }\r\n  initData.curSpecsInfo = specsInfo;\r\n  getPrice();\r\n}\r\n\r\n// 坐席数量改变\r\nfunction handleSeatCount(value) {\r\n  let count = value;\r\n  if (value === \"custom\") count = initData.seatCustomNum;\r\n  const cycleInfo = initData.cycleList.find(\r\n    (item) => item.value === initData.cycle\r\n  );\r\n  initData.curSpecsInfo = cycleInfo.specs.find((item) => {\r\n    return item.minNum <= count && count <= item.maxNum;\r\n  });\r\n  getPrice();\r\n}\r\n\r\n// 打开业务场景弹框\r\nfunction openScenarios() {\r\n  const list = initData.scenariosList.map((item) => {\r\n    return {\r\n      id: item.id,\r\n      pid: item.pid,\r\n      name: item.tagName || item.name,\r\n    };\r\n  });\r\n  scenariosRef.value.trigger(true, list);\r\n}\r\n\r\n// 获取业务标签\r\nfunction updateScenarios(data) {\r\n  const { list = [], label = [] } = data;\r\n  initData.scenariosList = list;\r\n  initData.scenariosLabel = label;\r\n}\r\n\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const tagList = initData.scenariosList.map((item) => {\r\n    return {\r\n      id: item.id,\r\n      name: item.name,\r\n    };\r\n  });\r\n  const params = {\r\n    helpOrder: 1,\r\n    agentId: userInfo.profileId,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\",\r\n    businessTagsInfo: JSON.stringify(tagList),\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"2\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: initData.cycle, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: seatCount.value,\r\n        coding: [\r\n          {\r\n            code: initData.curSpecsInfo.serviceCode,\r\n            coding: initData.curSpecsInfo.coding,\r\n            num: seatCount.value,\r\n          },\r\n        ],\r\n        baseCodeList: initData.curSpecsInfo.groupCodeList.map((item, index) => {\r\n          return {\r\n            baseCode: item,\r\n            number: initData.curSpecsInfo.groupValueList[index],\r\n          };\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `坐席数量：${seatCount.value}个；合作时间：${initData.cycle}个月；坐席单价：${agentInfo.value.unitPrice}元；`,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"1\") {\r\n              item.specsInfo = `${initData.cycle}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  if (!initData.scenariosList || !initData.scenariosList.length) {\r\n    ElMessage.warning(\"请选择业务场景!\");\r\n    return;\r\n  }\r\n  createdOrder(handleParams());\r\n}\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_input = _resolveComponent(\"el-input\")!\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_input_number = _resolveComponent(\"el-input-number\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    _createElementVNode(\"div\", _hoisted_1, [\n      _createVNode(BaseServiceInfo, { serviceData: serviceInfo.value }, null, 8, [\"serviceData\"]),\n      _createElementVNode(\"div\", _hoisted_2, [\n        _createVNode(_component_el_form, { \"label-width\": \"150px\" }, {\n          default: _withCtx(() => [\n            _createVNode(_component_el_form_item, { label: \"业务场景\" }, {\n              default: _withCtx(() => [\n                _createVNode(_component_el_input, {\n                  readonly: \"\",\n                  modelValue: initData.scenariosLabel,\n                  \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((initData.scenariosLabel) = $event)),\n                  onClick: openScenarios\n                }, null, 8, [\"modelValue\"])\n              ]),\n              _: 1\n            }),\n            _createVNode(_component_el_form_item, { label: \"软件周期\" }, {\n              default: _withCtx(() => [\n                _createVNode(CustomRadioButtonGroup, {\n                  list: initData.cycleList,\n                  \"model-value\": initData.cycle,\n                  \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => (handleCycleCount($event, 'cycle'))),\n                  minWidth: \"95px\"\n                }, null, 8, [\"list\", \"model-value\"])\n              ]),\n              _: 1\n            }),\n            _createVNode(_component_el_form_item, {\n              label: \"购买坐席数\",\n              class: \"amount-form-item\"\n            }, {\n              default: _withCtx(() => [\n                _createVNode(_component_el_select, {\n                  modelValue: initData.seatNum,\n                  \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event: any) => ((initData.seatNum) = $event)),\n                  onChange: handleSeatCount\n                }, {\n                  default: _withCtx(() => [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(initData.seatList, (item) => {\n                      return (_openBlock(), _createBlock(_component_el_option, {\n                        key: item.value,\n                        label: item.label,\n                        value: item.value\n                      }, null, 8, [\"label\", \"value\"]))\n                    }), 128))\n                  ]),\n                  _: 1\n                }, 8, [\"modelValue\"]),\n                (initData.seatNum === 'custom')\n                  ? (_openBlock(), _createBlock(_component_el_input_number, {\n                      key: 0,\n                      modelValue: initData.seatCustomNum,\n                      \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event: any) => ((initData.seatCustomNum) = $event)),\n                      min: initData.minSeatNum,\n                      max: initData.maxSeatNum,\n                      step: addedServiceInfo.value.miniNum,\n                      onChange: handleSeatCount\n                    }, null, 8, [\"modelValue\", \"min\", \"max\", \"step\"]))\n                  : _createCommentVNode(\"\", true)\n              ]),\n              _: 1\n            }),\n            _createVNode(_component_el_form_item, null, {\n              default: _withCtx(() => [\n                _createElementVNode(\"p\", _hoisted_3, _toDisplayString(tipDesc.value), 1)\n              ]),\n              _: 1\n            })\n          ]),\n          _: 1\n        }),\n        _createVNode(BaseSumPrice, {\n          onEmitFunc: handleBuy,\n          \"buy-price\": agentInfo.value.sumPrice,\n          \"can-buy\": productInfo.value?.canBuy,\n          hasAgentPrice: agentInfo.value.hasAgentPrice\n        }, null, 8, [\"buy-price\", \"can-buy\", \"hasAgentPrice\"])\n      ])\n    ]),\n    _createVNode(BusinessScenariosDialog, {\n      ref_key: \"scenariosRef\",\n      ref: scenariosRef,\n      onEmitFunc: updateScenarios\n    }, null, 512)\n  ], 64))\n}\n}\n\n})","<template>\r\n  <div class=\"product-detail\">\r\n    <BaseServiceInfo :serviceData=\"serviceInfo\"></BaseServiceInfo>\r\n    <div class=\"service-specs\">\r\n      <el-form label-width=\"150px\">\r\n        <el-form-item label=\"业务场景\">\r\n          <el-input\r\n            readonly\r\n            v-model=\"initData.scenariosLabel\"\r\n            @click=\"openScenarios\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"软件周期\">\r\n          <CustomRadioButtonGroup\r\n            :list=\"initData.cycleList\"\r\n            :model-value=\"initData.cycle\"\r\n            @update:modelValue=\"handleCycleCount($event, 'cycle')\"\r\n            minWidth=\"95px\"\r\n          ></CustomRadioButtonGroup>\r\n        </el-form-item>\r\n        <el-form-item label=\"购买坐席数\" class=\"amount-form-item\">\r\n          <el-select v-model=\"initData.seatNum\" @change=\"handleSeatCount\">\r\n            <el-option\r\n              v-for=\"item in initData.seatList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            />\r\n          </el-select>\r\n          <el-input-number\r\n            v-if=\"initData.seatNum === 'custom'\"\r\n            v-model=\"initData.seatCustomNum\"\r\n            :min=\"initData.minSeatNum\"\r\n            :max=\"initData.maxSeatNum\"\r\n            :step=\"addedServiceInfo.miniNum\"\r\n            @change=\"handleSeatCount\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p class=\"word\">{{ tipDesc }}</p>\r\n        </el-form-item>\r\n      </el-form>\r\n      <BaseSumPrice\r\n        @emitFunc=\"handleBuy\"\r\n        :buy-price=\"agentInfo.sumPrice\"\r\n        :can-buy=\"productInfo?.canBuy\"\r\n        :hasAgentPrice=\"agentInfo.hasAgentPrice\"\r\n      ></BaseSumPrice>\r\n    </div>\r\n  </div>\r\n  <BusinessScenariosDialog\r\n    ref=\"scenariosRef\"\r\n    @emitFunc=\"updateScenarios\"\r\n  ></BusinessScenariosDialog>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, reactive, shallowRef } from \"vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\n\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport CustomRadioButtonGroup from \"@/components/common/custom-radio-button-group.vue\";\r\nimport { arrayHasValue } from \"jz-tool-lib\";\r\nimport BusinessScenariosDialog from \"@components/common/business-scenarios-dialog.vue\";\r\nimport { ElMessage } from \"element-plus\";\r\n\r\nconst scenariosRef = ref();\r\nconst { routeQuery } = useVueRouter();\r\nconst addedServiceCode = \"CALL_CENTER_ADDED\";\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst props = defineProps<{\r\n  tagList: Record<string, any>[];\r\n  productData: Record<string, any>;\r\n  purchasedData: Record<string, any>[];\r\n}>();\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList.find(\r\n    (item) => item.addedServiceCode === addedServiceCode\r\n  );\r\n});\r\n// 周期数据\r\nconst cycleSpecs = computed(() => {\r\n  return handleSpecs(\"cycle\", 0);\r\n});\r\n// 坐席数量\r\nconst seatCount = computed(() => {\r\n  return initData.seatNum === \"custom\"\r\n    ? initData.seatCustomNum\r\n    : initData.seatNum;\r\n});\r\n// 提示\r\nconst tipDesc = computed(() => {\r\n  const addedPrice = Number(agentInfo.value.addedPrice)\r\n    ? `+ 附赠产品${agentInfo.value.addedPrice}元`\r\n    : \"\";\r\n  if (productInfo.value?.canBuy) {\r\n    return `合计： 坐席单价${agentInfo.value.unitPrice}元 x\r\n            ${seatCount.value}个坐席 x ${initData.cycle}个月${addedPrice} = ${agentInfo.value.sumPrice}元`;\r\n  } else {\r\n    return \"\";\r\n  }\r\n});\r\n// 处理周期\r\nconst handleSpecs = (type: \"cycle\", specsIndex) => {\r\n  const list: any[] = [];\r\n  const specsList = addedServiceInfo.value?.specsList;\r\n  if (!arrayHasValue(specsList)) return list;\r\n  specsList.forEach((item) => {\r\n    const groupNameList = item.groupNames.split(\",\");\r\n    const groupValueList = item.groupValues.split(\",\");\r\n    const groupCodeList = item.groupCodes.split(\",\");\r\n    const specsValue = {\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n      coding: item.coding,\r\n      serviceCode: item.serviceCode,\r\n      groupNameList,\r\n      groupValueList,\r\n      groupCodeList,\r\n    };\r\n    const info = list.find((sonItem: Record<string, any>) => {\r\n      return sonItem.value === groupValueList[specsIndex];\r\n    });\r\n    if (!info) {\r\n      list.push({\r\n        value: groupValueList[specsIndex],\r\n        label: groupNameList[specsIndex],\r\n        specs: [specsValue],\r\n      });\r\n    } else {\r\n      info.specs.push(specsValue);\r\n    }\r\n  });\r\n  return list.sort((a, b) => {\r\n    return a.value - b.value;\r\n  });\r\n};\r\ntype InitData = {\r\n  cycle: string;\r\n  seatNum: string | number;\r\n  seatCustomNum: number;\r\n  minSeatNum: number;\r\n  maxSeatNum: number;\r\n  cycleList: any[];\r\n  scenariosLabel: string[];\r\n  scenariosList: Record<string, any>[];\r\n  seatList: Record<string, any>[];\r\n  curSpecsInfo: Record<string, any>;\r\n};\r\nconst initData = reactive<InitData>({\r\n  scenariosLabel: props.tagList.map((item) => item.tagName),\r\n  scenariosList: props.tagList,\r\n  cycle: \"0\", // 套餐周期\r\n  seatNum: \"\", // 坐席数量\r\n  seatCustomNum: 0, // 坐席数量\r\n  minSeatNum: 1, // 最小坐席数量\r\n  maxSeatNum: 10000000, // 最大坐席数量\r\n  cycleList: [], // 套餐周期列表\r\n  seatList: [], // 坐席数量列表\r\n  curSpecsInfo: {}, // 选择当前规格\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  subMarketList: [],\r\n});\r\n// 初始化信息\r\nhandleCycleList();\r\n\r\n// 周期切换\r\nfunction handleCycleCount(value, type) {\r\n  initData[type] = value;\r\n  const curIndex = initData[`${type}List`].findIndex(\r\n    (item) => item.value === value\r\n  );\r\n  handleCycleList(curIndex === -1 ? 0 : curIndex);\r\n}\r\n\r\n// 设置默认套餐周期和获取最低消费列表\r\nfunction handleCycleList(curIndex = 0) {\r\n  if (!cycleSpecs.value.length) return;\r\n  initData.cycleList = cycleSpecs.value;\r\n  const cycleInfo = initData.cycleList[curIndex];\r\n  initData.cycle = cycleInfo?.value ?? \"\";\r\n  handleSeatList(cycleInfo);\r\n}\r\n\r\n// 获取seat坐席列表\r\nfunction handleSeatList(cycleInfo) {\r\n  const specsInfo = cycleInfo.specs[0];\r\n  initData.seatNum = specsInfo?.minNum;\r\n  initData.seatCustomNum = specsInfo?.minNum;\r\n  initData.minSeatNum = specsInfo?.minNum;\r\n  initData.maxSeatNum = specsInfo?.maxNum;\r\n  initData.seatList = cycleInfo.specs.map((item) => {\r\n    if (initData.minSeatNum > item.minNum) initData.minSeatNum = item.minNum;\r\n    if (initData.maxSeatNum < item.maxNum) initData.maxSeatNum = item.maxNum;\r\n    return {\r\n      label: `${item.minNum}个`,\r\n      value: item.minNum,\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n    };\r\n  });\r\n  if (addedServiceInfo.value?.isDiy) {\r\n    initData.seatList.push({ label: \"自定义\", value: \"custom\" });\r\n  }\r\n  initData.curSpecsInfo = specsInfo;\r\n  getPrice();\r\n}\r\n\r\n// 坐席数量改变\r\nfunction handleSeatCount(value) {\r\n  let count = value;\r\n  if (value === \"custom\") count = initData.seatCustomNum;\r\n  const cycleInfo = initData.cycleList.find(\r\n    (item) => item.value === initData.cycle\r\n  );\r\n  initData.curSpecsInfo = cycleInfo.specs.find((item) => {\r\n    return item.minNum <= count && count <= item.maxNum;\r\n  });\r\n  getPrice();\r\n}\r\n\r\n// 打开业务场景弹框\r\nfunction openScenarios() {\r\n  const list = initData.scenariosList.map((item) => {\r\n    return {\r\n      id: item.id,\r\n      pid: item.pid,\r\n      name: item.tagName || item.name,\r\n    };\r\n  });\r\n  scenariosRef.value.trigger(true, list);\r\n}\r\n\r\n// 获取业务标签\r\nfunction updateScenarios(data) {\r\n  const { list = [], label = [] } = data;\r\n  initData.scenariosList = list;\r\n  initData.scenariosLabel = label;\r\n}\r\n\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const tagList = initData.scenariosList.map((item) => {\r\n    return {\r\n      id: item.id,\r\n      name: item.name,\r\n    };\r\n  });\r\n  const params = {\r\n    helpOrder: 1,\r\n    agentId: userInfo.profileId,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\",\r\n    businessTagsInfo: JSON.stringify(tagList),\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"2\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: initData.cycle, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: seatCount.value,\r\n        coding: [\r\n          {\r\n            code: initData.curSpecsInfo.serviceCode,\r\n            coding: initData.curSpecsInfo.coding,\r\n            num: seatCount.value,\r\n          },\r\n        ],\r\n        baseCodeList: initData.curSpecsInfo.groupCodeList.map((item, index) => {\r\n          return {\r\n            baseCode: item,\r\n            number: initData.curSpecsInfo.groupValueList[index],\r\n          };\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `坐席数量：${seatCount.value}个；合作时间：${initData.cycle}个月；坐席单价：${agentInfo.value.unitPrice}元；`,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"1\") {\r\n              item.specsInfo = `${initData.cycle}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  if (!initData.scenariosList || !initData.scenariosList.length) {\r\n    ElMessage.warning(\"请选择业务场景!\");\r\n    return;\r\n  }\r\n  createdOrder(handleParams());\r\n}\r\n</script>\r\n","import script from \"./cloud-call-soft.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./cloud-call-soft.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","addedServiceCode","_defineComponent","__name","props","tagList","productData","purchasedData","setup","__props","scenariosRef","ref","routeQuery","useVueRouter","bd_userInfo","userInfo","LocalStorage","batchGetItem","productInfo","computed","serviceInfo","value","addedServiceInfo","_productInfo$value","addedServiceList","find","item","cycleSpecs","handleSpecs","seatCount","initData","seatNum","seatCustomNum","tipDesc","_productInfo$value2","addedPrice","Number","agentInfo","canBuy","unitPrice","cycle","sumPrice","type","specsIndex","_addedServiceInfo$val","list","specsList","arrayHasValue","forEach","groupNameList","groupNames","split","groupValueList","groupValues","groupCodeList","groupCodes","specsValue","minNum","maxNum","coding","serviceCode","info","sonItem","specs","push","label","sort","a","b","reactive","scenariosLabel","map","tagName","scenariosList","minSeatNum","maxSeatNum","cycleList","seatList","curSpecsInfo","shallowRef","price","subMarketList","handleCycleCount","curIndex","findIndex","handleCycleList","length","cycleInfo","handleSeatList","_addedServiceInfo$val2","specsInfo","isDiy","getPrice","handleSeatCount","count","openScenarios","id","pid","name","trigger","updateScenarios","data","handleParams","_agentInfo$value","params","helpOrder","agentId","profileId","companyId","buyType","businessTagsInfo","JSON","stringify","shopBuyList","isisTry","dateType","dateValue","marketCode","userNumber","code","num","baseCodeList","index","baseCode","number","commodityInfo","augmentedServiceList","calculateType","async","handlePrice","handleBuy","createdOrder","ElMessage","warning","_ctx","_cache","_productInfo$value3","_component_el_input","_resolveComponent","_component_el_form_item","_component_el_option","_component_el_select","_component_el_input_number","_component_el_form","_openBlock","_createElementBlock","_Fragment","_createElementVNode","_createVNode","BaseServiceInfo","serviceData","default","_withCtx","readonly","modelValue","$event","onClick","_","CustomRadioButtonGroup","minWidth","onChange","_renderList","_createBlock","key","min","max","step","miniNum","_createCommentVNode","_toDisplayString","BaseSumPrice","onEmitFunc","hasAgentPrice","BusinessScenariosDialog","ref_key","__exports__"],"sourceRoot":""}