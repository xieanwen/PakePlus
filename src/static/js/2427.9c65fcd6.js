"use strict";(self["webpackChunkdaili"]=self["webpackChunkdaili"]||[]).push([[2427],{22427:function(e,a,l){l.r(a),l.d(a,{default:function(){return J}});l(83238);var n=l(6254),t=l(38627),i=l(25598),o=l(59259),u=(l(59784),l(84e3),l(18964)),c=l(88365),s=l(20394);const d={class:"select-bill"},r={class:"invoice-bill"},v={class:"table-container"};var p=(0,n.pM)({__name:"select-bill",setup(e,{expose:a}){const{bd_agentId:l}=c.DT.batchGetItem(["bd_agentId"]),{pageNumberChange:o,pageSizeChange:p,pageData:m}=(0,c.N5)({listApi:u.ar,props:{pageNumber:"page",pageSize:"pageSize"},paramsData:{agencyId:l,invoicedPageFlag:1}}),b=(0,i.IJ)(""),k=(0,i.KR)([]),f=(0,i.KR)(!1),g=(0,i.KR)(null),_=(0,n.EW)((()=>{if(f.value)return b.value;{const e=k.value.reduce(((e,a)=>e+Number(a.invoicableBalance)),0);return(0,c.qG)(e,{isCover:!0})}}));function y(e){k.value=e,e.length>0&&(f.value=!1)}async function h(){const e={agentId:l},a=await s.Ic.getData(e);f.value?b.value=(0,c.qG)(a.data):b.value=""}function C(){return new Promise(((e,a)=>{f.value&&m.list.length>0?e({selectList:m.list,invoicePrice:_.value,isAllSelected:f.value}):k.value.length?e({selectList:k.value,invoicePrice:_.value,isAllSelected:f.value}):a("开票账单最少选择一个")}))}return a({next:C}),(e,a)=>{const l=(0,n.g2)("el-checkbox"),u=(0,n.g2)("el-table-column"),c=(0,n.g2)("TableEmpty"),s=(0,n.g2)("el-table"),b=(0,n.g2)("PagePagination");return(0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",r,[(0,n.Lk)("div",null,"选择开票账单，开票金额：￥"+(0,t.v_)(_.value),1),k.value.length?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(l,{key:0,modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),onChange:h},{default:(0,n.k6)((()=>a[1]||(a[1]=[(0,n.eW)("全部开票")]))),_:1},8,["modelValue"]))]),(0,n.Lk)("div",v,[(0,n.bF)(s,{ref_key:"tableRef",ref:g,border:"",data:(0,i.R1)(m).list,height:"360",onSelectionChange:y},{empty:(0,n.k6)((()=>[(0,n.bF)(c,{"empty-text":"暂无数据"})])),default:(0,n.k6)((()=>[(0,n.bF)(u,{type:"selection",width:"55"}),(0,n.bF)(u,{prop:"orderNo",label:"订单号\\交易号",width:"180"}),(0,n.bF)(u,{prop:"billTypeLabel",label:"账单类型",width:"180"}),(0,n.bF)(u,{prop:"productName",label:"产品"}),(0,n.bF)(u,{prop:"invoicableBalance",label:"可开票金额",width:"180"})])),_:1},8,["data"]),(0,n.bF)(b,{pageTotal:(0,i.R1)(m).pageTotal,pageSize:(0,i.R1)(m).pageSize,pageNumber:(0,i.R1)(m).pageNumber,onEmitPageSizeChange:(0,i.R1)(p),onEmitPageNumberChange:(0,i.R1)(o)},null,8,["pageTotal","pageSize","pageNumber","onEmitPageSizeChange","onEmitPageNumberChange"])])])}}}),m=l(83936);const b=(0,m.A)(p,[["__scopeId","data-v-8a7b5ce6"]]);var k=b,f=l(55533),g=l(63646),_=l(6934),y=l(57030);const h={class:"invoice-header"},C={class:"invoice-title"},I=["onClick"],F={class:"item-content"},R={class:"item-type"},L={class:"item-btn"};var w=(0,n.pM)({__name:"invoice-header",setup(e,{expose:a}){const{bd_userInfo:u}=c.DT.batchGetItem(["bd_userInfo"]),{bd_virCompanyId:s}=c.DT.batchGetItem(["bd_virCompanyId"]),d=(0,n.h)(g.fR,{direction:"vertical"}),r=(0,n.$V)((()=>Promise.all([l.e(2076),l.e(238)]).then(l.bind(l,47220)))),v=(0,i.IJ)(!1),p=(0,i.IJ)(""),m=(0,i.KR)([]),b=(0,i.KR)({});function k(e){p.value===e&&(m.value.length?p.value=m.value[0].id:p.value="")}function w(){b.value={},v.value=!0}function D(e){b.value={id:e.id,type:e.type,invoiceTitle:e.invoiceTitle,creditCodes:e.creditCodes,address:e.address,phone:e.phone,bank:e.bank,account:e.account},v.value=!0}function W(e){_.s.confirm("您确定要删除该发票信息吗?",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((async()=>{const a={ids:e.id,profileId:u.profileId},{statusCode:l,msg:n}=await(0,y.PG)(a);if(l)return o.nk.warning(n||"删除失败");o.nk.success(n||"删除成功"),await T(),k(e.id)}))}async function T(){const e={companyId:s};try{const a=await y.QQ.getData(e);m.value=y.QQ.handleData(a.data)}catch(a){console.error("获取开票信息列表失败",a)}}function E(){return new Promise(((e,a)=>{p.value?e(p.value):a("请选择发票抬头")}))}return T(),a({next:E}),(e,a)=>{const l=(0,n.g2)("el-link"),o=(0,n.g2)("el-space");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("dl",h,[(0,n.Lk)("dt",C,[a[2]||(a[2]=(0,n.Lk)("span",null,"选择发票抬头",-1)),(0,n.bF)(l,{type:"primary",underline:!1,onClick:w},{default:(0,n.k6)((()=>a[1]||(a[1]=[(0,n.eW)("新增发票抬头")]))),_:1})]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(m.value,(e=>((0,n.uX)(),(0,n.CE)("dd",{class:(0,t.C4)(["invoice-item",p.value===e.id?"is-active":""]),key:e.id,onClick:a=>p.value=e.id},[(0,n.Lk)("div",F,[(0,n.Lk)("div",R,(0,t.v_)(e.typeLabel),1),(0,n.bF)(o,{size:10,spacer:(0,i.R1)(d)},{default:(0,n.k6)((()=>[(0,n.Lk)("span",null,(0,t.v_)(e.invoiceTitle),1),(0,n.Lk)("span",null,(0,t.v_)(e.creditCodes),1)])),_:2},1032,["spacer"])]),(0,n.Lk)("div",L,[(0,n.bF)(o,{size:10,spacer:(0,i.R1)(d)},{default:(0,n.k6)((()=>[(0,n.bF)(l,{type:"primary",underline:!1,onClick:(0,f.D$)((a=>D(e)),["stop"])},{default:(0,n.k6)((()=>a[3]||(a[3]=[(0,n.eW)("编辑")]))),_:2},1032,["onClick"]),(0,n.bF)(l,{type:"primary",underline:!1,onClick:(0,f.D$)((a=>W(e)),["stop"])},{default:(0,n.k6)((()=>a[4]||(a[4]=[(0,n.eW)("删除")]))),_:2},1032,["onClick"])])),_:2},1032,["spacer"])])],10,I)))),128))]),(0,n.bF)((0,i.R1)(r),{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e),formData:b.value,onSuccess:T},null,8,["modelValue","formData"])],64)}}});const D=(0,m.A)(w,[["__scopeId","data-v-0571979a"]]);var W=D;const T={class:"receive-address"},E={class:"address-title"},K=["onClick"],P={class:"item-content"},x={class:"item-type"},N={class:"item-btn"};var S=(0,n.pM)({__name:"receive-address",setup(e,{expose:a}){const{bd_userInfo:u}=c.DT.batchGetItem(["bd_userInfo"]),{bd_virCompanyId:s}=c.DT.batchGetItem(["bd_virCompanyId"]),d=(0,n.h)(g.fR,{direction:"vertical"}),r=(0,n.$V)((()=>Promise.all([l.e(2076),l.e(9074)]).then(l.bind(l,3609)))),v=(0,i.IJ)(!1),p=(0,i.IJ)(""),m=(0,i.KR)([]),b=(0,i.KR)({});function k(e){p.value===e&&(m.value.length?p.value=m.value[0].id:p.value="")}function h(){b.value={},v.value=!0}function C(e){b.value={id:e.id,name:e.name,phone:e.phone,email:e.email},v.value=!0}function I(e){_.s.confirm("您确定要删除收件地址吗?",{confirmButtonText:"确认",cancelButtonText:"取消"}).then((async()=>{const a={ids:e.id,profileId:u.profileId},{statusCode:l,msg:n}=await(0,y.M6)(a);if(l)return o.nk.warning(n||"删除失败");o.nk.success(n||"删除成功"),await F(),k(e.id)}))}async function F(){const e={companyId:s};try{const a=await y.xz.getData(e);m.value=a.data}catch(a){console.error("获取收件地址列表失败",a)}}function R(){return new Promise(((e,a)=>{p.value?e(p.value):a("请选择收件地址")}))}return F(),a({confirm:R}),(e,a)=>{const l=(0,n.g2)("el-link"),o=(0,n.g2)("el-space");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.Lk)("dl",T,[(0,n.Lk)("dt",E,[a[2]||(a[2]=(0,n.Lk)("span",null,"选择收件地址",-1)),(0,n.bF)(l,{type:"primary",underline:!1,onClick:h},{default:(0,n.k6)((()=>a[1]||(a[1]=[(0,n.eW)("新增收件地址")]))),_:1})]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(m.value,(e=>((0,n.uX)(),(0,n.CE)("dd",{class:(0,t.C4)(["address-item",p.value===e.id?"is-active":""]),key:e.id,onClick:a=>p.value=e.id},[(0,n.Lk)("div",P,[(0,n.Lk)("div",x,(0,t.v_)(e.name),1),(0,n.bF)(o,{size:10,spacer:(0,i.R1)(d)},{default:(0,n.k6)((()=>[(0,n.Lk)("span",null,(0,t.v_)(e.phone),1),(0,n.Lk)("span",null,(0,t.v_)(e.email),1)])),_:2},1032,["spacer"])]),(0,n.Lk)("div",N,[(0,n.bF)(o,{size:10,spacer:(0,i.R1)(d)},{default:(0,n.k6)((()=>[(0,n.bF)(l,{type:"primary",underline:!1,onClick:(0,f.D$)((a=>C(e)),["stop"])},{default:(0,n.k6)((()=>a[3]||(a[3]=[(0,n.eW)("编辑")]))),_:2},1032,["onClick"]),(0,n.bF)(l,{type:"primary",underline:!1,onClick:(0,f.D$)((a=>I(e)),["stop"])},{default:(0,n.k6)((()=>a[4]||(a[4]=[(0,n.eW)("删除")]))),_:2},1032,["onClick"])])),_:2},1032,["spacer"])])],10,K)))),128))]),(0,n.bF)((0,i.R1)(r),{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e),formData:b.value,onSuccess:F},null,8,["modelValue","formData"])],64)}}});const X=(0,m.A)(S,[["__scopeId","data-v-2543bfcd"]]);var z=X;const V={class:"dialog-footer"};var G=(0,n.pM)({__name:"request-invoice",emits:["success"],setup(e,{expose:a,emit:l}){const{bd_agentId:u}=c.DT.batchGetItem(["bd_agentId"]),{bd_userInfo:d,bd_virCompanyId:r}=c.DT.batchGetItem(["bd_userInfo","bd_virCompanyId"]),v=l,p=(0,i.KR)(),m=["选择账单","发票抬头","收件地址"],b=(0,i.IJ)(!1),f=(0,i.IJ)(1),g=(0,i.KR)([k,W,z]),_=(0,i.Kh)({}),y=(0,i.IJ)(""),h=(0,n.EW)((()=>g.value[f.value-1]));function C(){p.value.next().then((e=>{Object.assign(_,e),++f.value})).catch((e=>{o.nk.warning(e)}))}function I(){p.value.next().then((e=>{y.value=e,++f.value})).catch((e=>{o.nk.warning(e)}))}function F(){p.value.confirm().then((async e=>{var a;const l=null===(a=_.selectList)||void 0===a?void 0:a.map((e=>e.orderNo)),n={companyId:r,expressInfoId:e,invoiceInfoId:y.value,invoicePrice:Number(_.invoicePrice).toFixed(2),orderNos:l,profileId:d.profileId,profileName:d.realName};console.log("1111",_.isAllSelected),_.isAllSelected&&(n.agencyId=u,n.allInvoices=1),await(0,s.zR)(n),o.nk.success("操作成功"),w(),v("success")})).catch((e=>{"string"===typeof e&&o.nk.warning(e)}))}function R(){f.value=1}function L(){b.value=!0}function w(){b.value=!1}return a({show:L,hide:w}),(e,a)=>{const l=(0,n.g2)("el-step"),i=(0,n.g2)("el-steps"),o=(0,n.g2)("el-button"),u=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.Wv)(u,{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value=e),title:"索要发票",width:"900",onClosed:R},{footer:(0,n.k6)((()=>[(0,n.Lk)("div",V,[1===f.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.bF)(o,{onClick:a[0]||(a[0]=e=>b.value=!1)},{default:(0,n.k6)((()=>a[4]||(a[4]=[(0,n.eW)("取消")]))),_:1}),(0,n.bF)(o,{type:"primary",onClick:C},{default:(0,n.k6)((()=>a[5]||(a[5]=[(0,n.eW)("下一步")]))),_:1})],64)):2===f.value?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bF)(o,{onClick:a[1]||(a[1]=e=>--f.value)},{default:(0,n.k6)((()=>a[6]||(a[6]=[(0,n.eW)("上一步")]))),_:1}),(0,n.bF)(o,{type:"primary",onClick:I},{default:(0,n.k6)((()=>a[7]||(a[7]=[(0,n.eW)("下一步")]))),_:1})],64)):((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.bF)(o,{onClick:a[2]||(a[2]=e=>b.value=!1)},{default:(0,n.k6)((()=>a[8]||(a[8]=[(0,n.eW)("取消")]))),_:1}),(0,n.bF)(o,{type:"primary",onClick:F},{default:(0,n.k6)((()=>a[9]||(a[9]=[(0,n.eW)("确认")]))),_:1})],64))])])),default:(0,n.k6)((()=>[(0,n.bF)(i,{class:"steps",active:f.value},{default:(0,n.k6)((()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(m,((e,a)=>(0,n.bF)(l,{key:a},{icon:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(e),1)])),_:2},1024))),64))])),_:1},8,["active"]),b.value?((0,n.uX)(),(0,n.Wv)(n.PR,{key:0},[((0,n.uX)(),(0,n.Wv)((0,n.$y)(h.value),{ref_key:"componentRef",ref:p,class:"component-container"},null,512))],1024)):(0,n.Q3)("",!0)])),_:1},8,["modelValue"])}}});const A=(0,m.A)(G,[["__scopeId","data-v-921b32d4"]]);var J=A}}]);
//# sourceMappingURL=2427.9c65fcd6.js.map