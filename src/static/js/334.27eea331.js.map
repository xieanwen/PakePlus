{"version":3,"file":"static/js/334.27eea331.js","mappings":"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","sources":["webpack://daili/./src/components/order-management/create-order/product-detail/added-recording-package.vue?9743","webpack://daili/./src/components/order-management/create-order/product-detail/added-recording-package.vue","webpack://daili/./src/components/order-management/create-order/product-detail/added-recording-package.vue?db01"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createBlock as _createBlock, createCommentVNode as _createCommentVNode, unref as _unref } from \"vue\"\n\nconst _hoisted_1 = { class: \"product-detail\" }\nconst _hoisted_2 = { class: \"service-specs\" }\n\nimport {\r\n  computed,\r\n  nextTick,\r\n  onMounted,\r\n  Ref,\r\n  ref,\r\n  shallowReactive,\r\n  shallowRef,\r\n  watch,\r\n} from \"vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\ninterface SeatList {\r\n  label: string;\r\n  value: number;\r\n}\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'added-recording-package',\n  props: {\n    productData: {},\n    purchasedData: {}\n  },\n  setup(__props: any) {\n\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\nconst props = __props;\r\nlet addedCode = \"\";\r\nconst seatList: Ref<SeatList[]> = ref([]); // 购买数量列表\r\nconst initData = shallowReactive<{\r\n  customCount: number;\r\n  count: string | number;\r\n  sumPrice: string | number;\r\n}>({\r\n  count: 1,\r\n  customCount: 1,\r\n  sumPrice: \"0.00\",\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: 0,\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\nconst { routeQuery } = useVueRouter();\r\n// 购买信息\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList[0];\r\n});\r\n// 已购买过得数量不能再次购买\r\nconst canBuyServer = computed(() => {\r\n  if (!purchasedInfo.value.length) {\r\n    return true;\r\n  }\r\n  return initData.count > purchasedInfo.value[0]?.resourceCount;\r\n});\r\n// 监听已购买的数量，并初始化选择可以购买的数量\r\nwatch(\r\n  () => purchasedInfo.value,\r\n  (value) => {\r\n    if (value.length) {\r\n      nextTick(() => {\r\n        if (seatList.value.length) {\r\n          const showCount = seatList.value.find((item) => {\r\n            return value[0].count < item.value;\r\n          });\r\n          if (showCount) {\r\n            initData.count = showCount?.value as number;\r\n          } else {\r\n            initData.count = value[0].count;\r\n          }\r\n          getPrice();\r\n        }\r\n      });\r\n    }\r\n  },\r\n  { deep: true, immediate: true }\r\n);\r\nconst setBuyInit = () => {\r\n  const initBuyList: any = []; // 购买数量列表\r\n  addedServiceInfo.value.specsList?.forEach((each: any) => {\r\n    if (each.hidden !== 1) {\r\n      const labels = each.groupNames.split(\",\");\r\n      const values = each.groupValues\r\n        .split(\",\")\r\n        .map((value: any) => Number(value));\r\n      labels.forEach((label: any, lIndex: number) => {\r\n        !initBuyList.some((buyItem: any) => buyItem.value === values[lIndex]) &&\r\n          initBuyList.push({\r\n            label: label,\r\n            value: values[lIndex],\r\n          });\r\n      });\r\n    }\r\n  });\r\n  initData.count = initBuyList.length ? initBuyList[0].value : 1;\r\n  initData.customCount = addedServiceInfo.value.miniNum || 1;\r\n  seatList.value = initBuyList;\r\n  getPrice();\r\n};\r\nconst coding = computed(() => {\r\n  let codingStr = \"\";\r\n  const buyNum = initData.count;\r\n  addedServiceInfo.value.specsList.forEach((v: any) => {\r\n    if (buyNum == v.groupValues) codingStr = v.coding;\r\n  });\r\n  return [{ code: addedCode, coding: codingStr, num: buyNum }];\r\n});\r\n\r\n// 拼成所需的规格\r\nfunction getSpecs() {\r\n  return [\r\n    {\r\n      baseCode: addedServiceInfo.value.specsList[0].groupCodes,\r\n      number: initData.count,\r\n    },\r\n  ];\r\n}\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const params = {\r\n    agentId: userInfo.profileId, // 代理商id\r\n    buyCar: false, // 是否为购物车下单\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    buyType: \"BUY_SERVER\", // 购买：BUY_SERVER,升级：UPGRADE,续费：RENEW\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"3\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: initData.count,\r\n        coding: coding.value,\r\n        baseCodeList: getSpecs(),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `购买数量：${initData.count}个月`,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\nonMounted(() => {\r\n  // 服务code\r\n  addedCode = addedServiceInfo.value.addedServiceCode;\r\n  setBuyInit();\r\n});\r\n// 计算价格\r\nasync function getPrice() {\r\n  const { params } = handleParams();\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(BaseServiceInfo, { serviceData: serviceInfo.value }, null, 8, [\"serviceData\"]),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createVNode(_component_el_form, { \"label-width\": \"150px\" }, {\n        default: _withCtx(() => [\n          (productInfo.value?.canBuy && _ctx.purchasedData.length)\n            ? (_openBlock(), _createBlock(_component_el_form_item, {\n                key: 0,\n                label: \"已购详情\"\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(purchasedInfo.value, (item, index) => {\n                    return (_openBlock(), _createElementBlock(\"div\", {\n                      class: \"purchased-info\",\n                      key: index\n                    }, [\n                      _createElementVNode(\"span\", null, \"已购买：\" + _toDisplayString(purchasedInfo.value[0]?.resourceCount) + \"个月\", 1),\n                      _createElementVNode(\"span\", null, \"服务到期时间：\" + _toDisplayString(item.endTime), 1)\n                    ]))\n                  }), 128))\n                ]),\n                _: 1\n              }))\n            : _createCommentVNode(\"\", true),\n          _createVNode(_component_el_form_item, {\n            label: \"购买数量\",\n            class: \"amount-form-item\"\n          }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: _unref(initData).count,\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((_unref(initData).count) = $event)),\n                onChange: getPrice\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(seatList.value, (item) => {\n                    return (_openBlock(), _createBlock(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"]))\n                  }), 128))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"])\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(BaseSumPrice, {\n        onEmitFunc: handleBuy,\n        \"buy-price\": agentInfo.value.price,\n        \"can-buy\": productInfo.value?.canBuy && canBuyServer.value,\n        hasAgentPrice: \"\"\n      }, null, 8, [\"buy-price\", \"can-buy\"])\n    ])\n  ]))\n}\n}\n\n})","<template>\r\n  <div class=\"product-detail\">\r\n    <BaseServiceInfo :serviceData=\"serviceInfo\"></BaseServiceInfo>\r\n    <div class=\"service-specs\">\r\n      <el-form label-width=\"150px\">\r\n        <template v-if=\"productInfo?.canBuy && purchasedData.length\">\r\n          <el-form-item label=\"已购详情\">\r\n            <div\r\n              class=\"purchased-info\"\r\n              v-for=\"(item, index) in purchasedInfo\"\r\n              :key=\"index\"\r\n            >\r\n              <span>已购买：{{ purchasedInfo[0]?.resourceCount }}个月</span>\r\n              <span>服务到期时间：{{ item.endTime }}</span>\r\n            </div>\r\n          </el-form-item>\r\n        </template>\r\n        <el-form-item label=\"购买数量\" class=\"amount-form-item\">\r\n          <el-select v-model=\"initData.count\" @change=\"getPrice\">\r\n            <el-option\r\n              v-for=\"item in seatList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <BaseSumPrice\r\n        @emitFunc=\"handleBuy\"\r\n        :buy-price=\"agentInfo.price\"\r\n        :can-buy=\"productInfo?.canBuy && canBuyServer\"\r\n        hasAgentPrice\r\n      ></BaseSumPrice>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport {\r\n  computed,\r\n  nextTick,\r\n  onMounted,\r\n  Ref,\r\n  ref,\r\n  shallowReactive,\r\n  shallowRef,\r\n  watch,\r\n} from \"vue\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\nconst props = defineProps<{\r\n  productData: Record<string, any>;\r\n  purchasedData: Record<string, any>[];\r\n}>();\r\ninterface SeatList {\r\n  label: string;\r\n  value: number;\r\n}\r\nlet addedCode = \"\";\r\nconst seatList: Ref<SeatList[]> = ref([]); // 购买数量列表\r\nconst initData = shallowReactive<{\r\n  customCount: number;\r\n  count: string | number;\r\n  sumPrice: string | number;\r\n}>({\r\n  count: 1,\r\n  customCount: 1,\r\n  sumPrice: \"0.00\",\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  unitPrice: 0,\r\n  subMarketList: [],\r\n  hasAgentPrice: false,\r\n});\r\nconst { routeQuery } = useVueRouter();\r\n// 购买信息\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList[0];\r\n});\r\n// 已购买过得数量不能再次购买\r\nconst canBuyServer = computed(() => {\r\n  if (!purchasedInfo.value.length) {\r\n    return true;\r\n  }\r\n  return initData.count > purchasedInfo.value[0]?.resourceCount;\r\n});\r\n// 监听已购买的数量，并初始化选择可以购买的数量\r\nwatch(\r\n  () => purchasedInfo.value,\r\n  (value) => {\r\n    if (value.length) {\r\n      nextTick(() => {\r\n        if (seatList.value.length) {\r\n          const showCount = seatList.value.find((item) => {\r\n            return value[0].count < item.value;\r\n          });\r\n          if (showCount) {\r\n            initData.count = showCount?.value as number;\r\n          } else {\r\n            initData.count = value[0].count;\r\n          }\r\n          getPrice();\r\n        }\r\n      });\r\n    }\r\n  },\r\n  { deep: true, immediate: true }\r\n);\r\nconst setBuyInit = () => {\r\n  const initBuyList: any = []; // 购买数量列表\r\n  addedServiceInfo.value.specsList?.forEach((each: any) => {\r\n    if (each.hidden !== 1) {\r\n      const labels = each.groupNames.split(\",\");\r\n      const values = each.groupValues\r\n        .split(\",\")\r\n        .map((value: any) => Number(value));\r\n      labels.forEach((label: any, lIndex: number) => {\r\n        !initBuyList.some((buyItem: any) => buyItem.value === values[lIndex]) &&\r\n          initBuyList.push({\r\n            label: label,\r\n            value: values[lIndex],\r\n          });\r\n      });\r\n    }\r\n  });\r\n  initData.count = initBuyList.length ? initBuyList[0].value : 1;\r\n  initData.customCount = addedServiceInfo.value.miniNum || 1;\r\n  seatList.value = initBuyList;\r\n  getPrice();\r\n};\r\nconst coding = computed(() => {\r\n  let codingStr = \"\";\r\n  const buyNum = initData.count;\r\n  addedServiceInfo.value.specsList.forEach((v: any) => {\r\n    if (buyNum == v.groupValues) codingStr = v.coding;\r\n  });\r\n  return [{ code: addedCode, coding: codingStr, num: buyNum }];\r\n});\r\n\r\n// 拼成所需的规格\r\nfunction getSpecs() {\r\n  return [\r\n    {\r\n      baseCode: addedServiceInfo.value.specsList[0].groupCodes,\r\n      number: initData.count,\r\n    },\r\n  ];\r\n}\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const params = {\r\n    agentId: userInfo.profileId, // 代理商id\r\n    buyCar: false, // 是否为购物车下单\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    buyType: \"BUY_SERVER\", // 购买：BUY_SERVER,升级：UPGRADE,续费：RENEW\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"3\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: 1, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: initData.count,\r\n        coding: coding.value,\r\n        baseCodeList: getSpecs(),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `购买数量：${initData.count}个月`,\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\nonMounted(() => {\r\n  // 服务code\r\n  addedCode = addedServiceInfo.value.addedServiceCode;\r\n  setBuyInit();\r\n});\r\n// 计算价格\r\nasync function getPrice() {\r\n  const { params } = handleParams();\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n</script>\r\n","import script from \"./added-recording-package.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./added-recording-package.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_defineComponent","__name","props","productData","purchasedData","setup","__props","bd_userInfo","userInfo","LocalStorage","batchGetItem","addedCode","seatList","ref","initData","shallowReactive","count","customCount","sumPrice","agentInfo","shallowRef","price","unitPrice","subMarketList","hasAgentPrice","routeQuery","useVueRouter","purchasedInfo","computed","productInfo","serviceInfo","value","addedServiceInfo","_productInfo$value","addedServiceList","canBuyServer","_purchasedInfo$value$","length","resourceCount","watch","nextTick","showCount","find","item","getPrice","deep","immediate","setBuyInit","_addedServiceInfo$val","initBuyList","specsList","forEach","each","hidden","labels","groupNames","split","values","groupValues","map","Number","label","lIndex","some","buyItem","push","miniNum","coding","codingStr","buyNum","v","code","num","getSpecs","baseCode","groupCodes","number","handleParams","params","agentId","profileId","buyCar","helpOrder","buyType","companyId","shopBuyList","isisTry","dateType","dateValue","marketCode","serviceCode","userNumber","baseCodeList","commodityInfo","list","specsInfo","async","handlePrice","handleBuy","createdOrder","onMounted","addedServiceCode","_ctx","_cache","_productInfo$value3","_component_el_form_item","_resolveComponent","_component_el_option","_component_el_select","_component_el_form","_openBlock","_createElementBlock","_createVNode","BaseServiceInfo","serviceData","_createElementVNode","default","_withCtx","_productInfo$value2","canBuy","_createBlock","key","_Fragment","_renderList","index","_purchasedInfo$value$2","_toDisplayString","endTime","_","_createCommentVNode","modelValue","_unref","$event","onChange","BaseSumPrice","onEmitFunc","__exports__"],"sourceRoot":""}