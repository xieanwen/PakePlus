"use strict";(self["webpackChunkdaili"]=self["webpackChunkdaili"]||[]).push([[4559,8647],{32203:function(e,u,a){a.r(u),a.d(u,{default:function(){return N}});a(95226),a(59784),a(29296),a(47961),a(83238),a(84e3);var l=a(6254),i=a(38627),t=a(25598),n=a(4710),d=a(10901),r=a(88365),s=a(64108),o=a(83862),v=a(8610);const c={class:"product-detail"},m={class:"service-specs"},p={class:"purchased-list"},b={class:"word"};var y=(0,l.pM)({__name:"message-type-service",props:{productData:{},purchasedData:{}},setup(e){const{routeQuery:u}=(0,d.dG)(),{serviceCode:a,companyId:y,profileId:f}=u.value,{bd_userInfo:C}=r.DT.batchGetItem(["bd_userInfo"]),N=e,g=(0,t.Kh)({typeGroupValues:[],typeGroupList:[],buyNum:null,buyList:[],buyCustomNum:1}),L=(0,t.IJ)({price:"0.00",sumPrice:"0.00",unitPrice:"0.00",addedPrice:"0.00",subMarketList:[],hasAgentPrice:!1}),k=(0,l.EW)((()=>N.purchasedData)),h=(0,l.EW)((()=>N.productData)),I=(0,l.EW)((()=>h.value.serviceInfo)),_=(0,l.EW)((()=>{var e;return null===(e=h.value)||void 0===e?void 0:e.addedServiceList})),V=(0,l.EW)((()=>{const{specsList:e=[],miniNum:u=1}=_.value[0],a=e.map((e=>e.groupValues))??[0],l=Math.max.apply(null,a),i=Math.min.apply(null,a);return{maxNum:l,minNum:i,increaseNum:u}})),E=(0,l.EW)((()=>-1===g.buyNum?g.buyCustomNum:g.buyNum)),$=(0,l.EW)((()=>{const e=_.value.filter((e=>g.typeGroupValues.includes(e.addedServiceCode)));return e.map((e=>{var u;const a=k.value??[],{specsList:l,addedServiceCode:i}=e,t=(null===(u=a.find((e=>e.consumptionTypeCd===i)))||void 0===u?void 0:u.resourceCount)??0,n=new BigNumber(t).plus(E.value).toNumber();return l.find((e=>e.minNum<=n&&n<=e.maxNum))}))})),P=(0,l.EW)((()=>$.value.reduce(((e,u)=>{const a=_.value.find((e=>e.addedServiceCode===u.serviceCode));return e+`${null===a||void 0===a?void 0:a.addedServiceName}：${E.value}${I.value.unit}；`}),""))),W=(0,l.EW)((()=>$.value.reduce(((e,u)=>{const a=_.value.find((e=>e.addedServiceCode===u.serviceCode));return e+`${null===a||void 0===a?void 0:a.addedServiceName}：${null===u||void 0===u?void 0:u.unitPrice}元/${I.value.unit}；`}),""))),F=(0,l.EW)((()=>{let e=0;const u=$.value.map((u=>{const a=_.value.find((e=>e.addedServiceCode===u.serviceCode)),l=k.value.find((e=>e.consumptionTypeCd===u.serviceCode))?"剩余天数365 / 一年365天 x ":"";return e+=new BigNumber((null===u||void 0===u?void 0:u.unitPrice)??0).times(E.value).toNumber(),`${null===a||void 0===a?void 0:a.addedServiceName}：${l}${null===u||void 0===u?void 0:u.unitPrice}元/${I.value.unit} x ${E.value}${I.value.unit}`}));return`合计：${u.join(" + ")} = ${e.toFixed(2)}元`}));function S(){var e;g.typeGroupList=(null===(e=_.value)||void 0===e?void 0:e.map((e=>({label:e.addedServiceName,value:e.addedServiceCode}))))||[],g.typeGroupValues=g.typeGroupList.length?[g.typeGroupList[0].value]:[],w()}function G(e){e.length&&(g.typeGroupValues=e),A()}function w(){g.buyList=_.value[0].specsList.map((e=>({label:e.groupNames,value:e.groupValues}))),g.buyNum=g.buyList[0].value,_.value[0].isDiy&&(g.buyList.push({label:"自定义",value:-1}),g.buyCustomNum=g.buyList[0].value)}function x(){var e;const u=$.value??[],l=u.map((e=>({coding:e.coding,num:E.value,baseCode:e.serviceCode}))),i=u.map((e=>({baseCode:e.serviceCode,number:E.value}))),t={helpOrder:1,agentId:C.profileId,companyId:y,profileId:f,buyType:"BUY_SERVER",shopBuyList:[{agentId:C.profileId,isisTry:!1,dateType:3,dateValue:1,marketCode:a,userNumber:E.value,coding:l,baseCodeList:i}],sumPrice:L.value.sumPrice},n={list:[{...I.value,price:L.value.price,specsInfo:P.value,augmentedServiceList:null===(e=L.value)||void 0===e?void 0:e.subMarketList.map((e=>("2"===e.calculateType&&(e.specsInfo=`${new BigNumber(E.value).multipliedBy(12)}个月`),e)))}],sumPrice:L.value.sumPrice};return{params:t,commodityInfo:n}}async function A(){const e=x().params;L.value=await(0,n.AV)(e)}function D(){(0,n.$d)(x())}return(0,l.sV)((async()=>{S(),await A()})),(e,u)=>{var a;const t=(0,l.g2)("el-form-item"),n=(0,l.g2)("el-option"),d=(0,l.g2)("el-select"),r=(0,l.g2)("el-input-number"),y=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(s.A,{serviceData:I.value},null,8,["serviceData"]),(0,l.Lk)("div",m,[(0,l.bF)(y,{"label-width":"150px"},{default:(0,l.k6)((()=>[k.value.length?((0,l.uX)(),(0,l.Wv)(t,{key:0,label:"已购详情"},{default:(0,l.k6)((()=>[(0,l.Lk)("ul",p,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(k.value,((e,u)=>((0,l.uX)(),(0,l.CE)("li",{key:u},[(0,l.Lk)("span",null,(0,i.v_)(e.resourceName),1),(0,l.Lk)("span",null,"已购数量："+(0,i.v_)(e.resourceCount)+"条",1),(0,l.Lk)("span",null,"服务到期时间："+(0,i.v_)(e.endTime),1)])))),128))])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(t,{label:"短信类型"},{default:(0,l.k6)((()=>[(0,l.bF)(o["default"],{direction:"row",list:g.typeGroupList,"model-value":g.typeGroupValues,"onUpdate:modelValue":G},null,8,["list","model-value"])])),_:1}),(0,l.bF)(t,{label:"购买数量",class:"amount-form-item"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:g.buyNum,"onUpdate:modelValue":u[0]||(u[0]=e=>g.buyNum=e),onChange:A},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(g.buyList,(e=>((0,l.uX)(),(0,l.Wv)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),-1===g.buyNum?((0,l.uX)(),(0,l.Wv)(r,{key:0,modelValue:g.buyCustomNum,"onUpdate:modelValue":u[1]||(u[1]=e=>g.buyCustomNum=e),min:V.value.minNum,max:V.value.maxNum,step:V.value.increaseNum,"step-strictly":"","value-on-clear":V.value.minNum,onChange:A},null,8,["modelValue","min","max","step","value-on-clear"])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(t,{label:"单价"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(W.value),1)])),_:1}),(0,l.bF)(t,null,{default:(0,l.k6)((()=>[(0,l.Lk)("p",b,(0,i.v_)(F.value),1)])),_:1})])),_:1}),(0,l.bF)(v.A,{onEmitFunc:D,"buy-price":L.value.sumPrice,"can-buy":null===(a=h.value)||void 0===a?void 0:a.canBuy,hasAgentPrice:L.value.hasAgentPrice},null,8,["buy-price","can-buy","hasAgentPrice"])])])}}}),f=a(83936);const C=(0,f.A)(y,[["__scopeId","data-v-736752af"]]);var N=C}}]);
//# sourceMappingURL=8647.35ccc36a.js.map