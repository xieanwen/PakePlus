{"version":3,"file":"static/js/9128.b983107e.js","mappings":"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","sources":["webpack://daili/./src/components/order-management/create-order/application-center/renew-dialog.vue?ad03","webpack://daili/./src/components/order-management/create-order/application-center/renew-dialog.vue","webpack://daili/./src/components/order-management/create-order/application-center/renew-dialog.vue?618b"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode } from \"vue\"\n\nconst _hoisted_1 = { class: \"product-name\" }\nconst _hoisted_2 = { class: \"product-price\" }\nconst _hoisted_3 = { class: \"product-price\" }\nconst _hoisted_4 = { class: \"dialog-footer\" }\n\nimport { shallowRef, shallowReactive } from \"vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage, SessionStorage } from \"jz-tool-lib\";\r\nimport { arrayHasValue, judgeBoolean } from \"jz-tool-lib\";\r\nimport {\r\n  renewPriceApi,\r\n  productDetailApi,\r\n  resourceDetailApi,\r\n  purchasedCloudCallPackageApi,\r\n} from \"@api/order-management-api\";\r\n\r\ntype InitData = {\r\n  visible: boolean;\r\n  timeList: Record<string, any>[];\r\n};\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'renew-dialog',\n  setup(__props, { expose: __expose }) {\n\r\nconst { routeQuery, goPage } = useVueRouter();\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\nconst initData = shallowReactive<InitData>({\r\n  visible: false,\r\n  timeList: [\r\n    { label: \"1年\", value: \"1\" },\r\n    { label: \"2年\", value: \"2\" },\r\n    { label: \"3年\", value: \"3\" },\r\n  ],\r\n});\r\nconst baseInfo = shallowRef<Record<string, any>>({}); // 续费产品基本信息\r\nconst purchasedData = shallowRef<Record<string, any>>({}); // 已购产品信息\r\nconst productDetail = shallowRef<Record<string, any>>({}); // 产品详情\r\nconst renewPriceData = shallowRef<Record<string, any>>({}); // 续费价格信息\r\nconst formData = shallowReactive({\r\n  cycle: \"1\",\r\n  payType: \"WX\",\r\n  productPrice: \"0.00\", // 产品价格\r\n  sumPrice: \"0.00\", // 产品价格 + 附赠产品价格\r\n});\r\n// 支付方式\r\nconst payList = [\r\n  {\r\n    label: \"微信\",\r\n    value: \"WX\",\r\n    modePayment: \"onlinePayment\",\r\n  },\r\n  {\r\n    label: \"支付宝\",\r\n    value: \"ZFB\",\r\n    modePayment: \"onlinePayment\",\r\n  },\r\n  {\r\n    label: \"代理商企付宝\",\r\n    value: \"DLSZHYE\",\r\n    modePayment: \"balancePayment\",\r\n  },\r\n  {\r\n    label: \"代理商预付款\",\r\n    value: \"DLSYHK\",\r\n    modePayment: \"balancePayment\",\r\n  },\r\n];\r\n// 获取服务产品详情\r\nasync function getProductDetail() {\r\n  if (baseInfo.value.productType === \"service\") {\r\n    const params = {\r\n      serviceCode: baseInfo.value.combineServiceCode,\r\n    };\r\n    const { data } = await productDetailApi.getData(params);\r\n    productDetail.value = productDetailApi.handleData(data);\r\n    if (\r\n      [\"CLOUD_CALL_PACKAGE\", \"CLOUD_CALL_SOFT\"].includes(\r\n        baseInfo.value.combineServiceCode\r\n      )\r\n    ) {\r\n      const addedServiceCode = {\r\n        CLOUD_CALL_SOFT: \"CALL_CENTER_ADDED\",\r\n        CLOUD_CALL_PACKAGE: \"CALL_PACKAGE_ADDED_NEW\",\r\n      };\r\n      initData.timeList = handleSpecs(\r\n        addedServiceCode[baseInfo.value.combineServiceCode],\r\n        0,\r\n        productDetail.value.addedServiceList\r\n      );\r\n    } else if (\r\n      [\"SCRM\", \"WEB_CUSTOMER_PHONE\"].includes(baseInfo.value.combineServiceCode)\r\n    ) {\r\n      initData.timeList = [{ label: \"1年\", value: \"1\" }];\r\n    }\r\n    formData.cycle = initData.timeList[0].value;\r\n  } else if (baseInfo.value.productType === \"resource\") {\r\n    const params = {\r\n      sizeCode: baseInfo.value.addedCodes,\r\n    };\r\n    const { data } = await resourceDetailApi.getData(params);\r\n    productDetail.value = resourceDetailApi.handleData(data);\r\n  }\r\n}\r\n\r\n// 获取产品基础价格\r\nasync function getRenewUnitPrice(\r\n  marketCode = baseInfo.value.combineServiceCode\r\n) {\r\n  const params = {\r\n    agentId: userInfo.profileId,\r\n    helpOrder: 1,\r\n    companyId: routeQuery.value.companyId,\r\n    marketCode,\r\n    addedCode: baseInfo.value.addedCodes,\r\n  };\r\n  const { data } = await renewPriceApi.getData(params);\r\n  renewPriceData.value = renewPriceApi.handleData(data);\r\n}\r\n\r\n// 获取已购产品信息【鱼鹰呼叫套餐】\r\nasync function getPurchasedInfo() {\r\n  const params = {\r\n    companyId: routeQuery.value.companyId,\r\n    marketCode: baseInfo.value.combineServiceCode,\r\n  };\r\n  const { data } = await purchasedCloudCallPackageApi.getData(params);\r\n  purchasedData.value = purchasedCloudCallPackageApi.handleData(data);\r\n}\r\n// 【鱼鹰呼叫套餐，鱼鹰呼叫软件】 处理周期\r\nfunction handleSpecs(\r\n  addedServiceCode: string,\r\n  specsIndex: number,\r\n  addedServiceList: Record<string, any>\r\n) {\r\n  const list: Record<string, any>[] = [];\r\n  const specsList = addedServiceList.find(\r\n    (item) => item.addedServiceCode === addedServiceCode\r\n  ).specsList;\r\n  if (!arrayHasValue(specsList)) return list;\r\n  specsList.forEach((item) => {\r\n    const groupNameList = item.groupNames.split(\",\");\r\n    const groupValueList = item.groupValues.split(\",\");\r\n    const groupCodeList = item.groupCodes.split(\",\");\r\n    const specsValue = {\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n      coding: item.coding,\r\n      serviceCode: item.serviceCode,\r\n      groupNameList,\r\n      groupValueList,\r\n      groupCodeList,\r\n    };\r\n    const info = list.find((sonItem: Record<string, any>) => {\r\n      return sonItem.value === groupValueList[specsIndex];\r\n    });\r\n    if (!info) {\r\n      list.push({\r\n        value: groupValueList[specsIndex],\r\n        label: groupNameList[specsIndex],\r\n        specs: [specsValue],\r\n      });\r\n    } else {\r\n      info.specs.push(specsValue);\r\n    }\r\n  });\r\n  return list.sort((a, b) => {\r\n    return a.value - b.value;\r\n  });\r\n}\r\n// 获取总价\r\nfunction getSumPrice() {\r\n  const productPrice =\r\n    new BigNumber(formData.cycle).toNumber() *\r\n    new BigNumber(renewPriceData.value.basePrice).toNumber();\r\n  const addedPrice = new BigNumber(renewPriceData.value.addedPrice).toNumber();\r\n  formData.sumPrice = judgeBoolean(productPrice, addedPrice)\r\n    ? new BigNumber(productPrice + addedPrice).toFixed(2)\r\n    : \"0.00\";\r\n  formData.productPrice = productPrice\r\n    ? new BigNumber(productPrice).toFixed(2)\r\n    : \"0.00\";\r\n}\r\n// 提交续费\r\nfunction handleRenew() {\r\n  const serviceInfo = productDetail.value.serviceInfo;\r\n  const payTypeInfo = payList.find((item) => formData.payType === item.value);\r\n  const params: Record<string, any> = {\r\n    agentId: userInfo.profileId, // 代理商id\r\n    buyCar: false, // 是否为购物车下单\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    buyType: \"RENEW\", // 购买：BUY_SERVER,升级：UPGRADE,续费：RENEW\r\n    paymentType: payTypeInfo?.value,\r\n    modePayment: payTypeInfo?.modePayment,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: [\"CLOUD_CALL_PACKAGE\", \"CLOUD_CALL_SOFT\"].includes(\r\n          serviceInfo.combineServiceCode\r\n        )\r\n          ? 2\r\n          : 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: formData.cycle, // 时长\r\n        marketCode: serviceInfo.combineServiceCode,\r\n        baseCodeList: [],\r\n      },\r\n    ],\r\n    sumPrice: formData.sumPrice, // 商品总价(商品价格 + 附赠产品价格)\r\n  };\r\n  // 附赠产品\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...productDetail.value?.serviceInfo,\r\n        price: formData.productPrice,\r\n        augmentedServiceList: renewPriceData.value.subMarketList.map((item) => {\r\n          if (item.calculateType === \"1\") {\r\n            item.specsInfo = `${formData.cycle}个月`;\r\n          }\r\n          return item;\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: formData.sumPrice,\r\n  };\r\n  if ([\"1\"].includes(serviceInfo.calculateType)) {\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: null,\r\n        number: 0,\r\n      },\r\n    ];\r\n    const specsInfo = `${formData.cycle}年期；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  } else if ([\"2\"].includes(serviceInfo.calculateType)) {\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: baseInfo.value.addedCodes,\r\n        number: baseInfo.value.residue,\r\n      },\r\n    ];\r\n    const specsInfo = `续费数量：${baseInfo.value.residue}${baseInfo.value.unit}；${formData.cycle}年期；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  } else if ([\"3\"].includes(serviceInfo.calculateType)) {\r\n    // 鱼鹰呼叫套餐\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: \"CALL_PACKAGE_TIME\",\r\n        number: formData.cycle,\r\n      },\r\n    ];\r\n    const seatSize = new BigNumber(purchasedData.value.seatSize).toNumber();\r\n    const minuteNum = new BigNumber(\r\n      purchasedData.value.chooseMinute\r\n    ).toNumber();\r\n    const minuteTotal =\r\n      seatSize && minuteNum\r\n        ? new BigNumber(seatSize && minuteNum).toNumber()\r\n        : 0;\r\n    const specsInfo = `套餐周期：${formData.cycle}个月；最低消费：${purchasedData.value.chooseMinFee}元/坐席/月；系统软件费：${purchasedData.value.callSoftPrice}元/坐席/月；${baseInfo.value.userNumber}个坐席；${purchasedData.value.chooseMinute}分钟/坐席/月（总计${minuteTotal}分钟/月，分钟数可共享）；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  } else if ([\"6\"].includes(serviceInfo.calculateType)) {\r\n    // 鱼鹰呼叫软件和软件坐席\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: serviceInfo.addedCodes,\r\n        number: baseInfo.value.userNumber,\r\n      },\r\n    ];\r\n    const specsInfo = `${baseInfo.value.userNumber}个坐席；坐席单价${renewPriceData.value.seatUnitPrice}元；${formData.cycle}个月；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  }\r\n  SessionStorage.setItem(\"bd_market-cart\", params);\r\n  SessionStorage.setItem(\"bd_market-commodity\", commodityInfo);\r\n  goPage(\"/orderManagement/createOrder/confirmOrder\");\r\n}\r\n// 关闭弹框\r\nfunction handleClose() {\r\n  initData.visible = false;\r\n  initData.timeList = [\r\n    { label: \"1年\", value: \"1\" },\r\n    { label: \"2年\", value: \"2\" },\r\n    { label: \"3年\", value: \"3\" },\r\n  ];\r\n  formData.cycle = \"1\";\r\n  formData.payType = \"WX\";\r\n  formData.sumPrice = \"0.00\";\r\n  baseInfo.value = {}; // 续费产品信息\r\n  purchasedData.value = {}; // 已购产品信息\r\n  productDetail.value = {}; // 产品详情\r\n  renewPriceData.value = {}; // 续费价格信息\r\n}\r\n\r\nfunction toggle(visible: boolean, info: Record<string, any>) {\r\n  baseInfo.value = info;\r\n  initData.visible = visible;\r\n  let apiList: Promise<any>[] = [];\r\n  if (baseInfo.value.productType === \"service\") {\r\n    apiList = [...[getRenewUnitPrice(), getProductDetail()]];\r\n    if ([\"CLOUD_CALL_PACKAGE\"].includes(baseInfo.value.combineServiceCode)) {\r\n      apiList.push(getPurchasedInfo());\r\n    }\r\n    Promise.allSettled(apiList).then(() => {\r\n      getSumPrice();\r\n    });\r\n  } else if (baseInfo.value.productType === \"resource\") {\r\n    getProductDetail().then(async () => {\r\n      await getRenewUnitPrice(\r\n        productDetail.value.serviceInfo.combineServiceCode\r\n      );\r\n      getSumPrice();\r\n    });\r\n  }\r\n}\r\n__expose({\r\n  toggle,\r\n});\r\n\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n  const _component_el_button = _resolveComponent(\"el-button\")!\n  const _component_el_dialog = _resolveComponent(\"el-dialog\")!\n\n  return (_openBlock(), _createBlock(_component_el_dialog, {\n    \"model-value\": _unref(initData).visible,\n    title: \"续费\",\n    width: \"480\",\n    onClosed: handleClose,\n    class: \"custom-dialog\"\n  }, {\n    footer: _withCtx(() => [\n      _createElementVNode(\"div\", _hoisted_4, [\n        _createVNode(_component_el_button, { onClick: handleClose }, {\n          default: _withCtx(() => _cache[2] || (_cache[2] = [\n            _createTextVNode(\"取消\")\n          ])),\n          _: 1\n        }),\n        _createVNode(_component_el_button, {\n          type: \"primary\",\n          onClick: handleRenew\n        }, {\n          default: _withCtx(() => _cache[3] || (_cache[3] = [\n            _createTextVNode(\"续费\")\n          ])),\n          _: 1\n        })\n      ])\n    ]),\n    default: _withCtx(() => [\n      _createVNode(_component_el_form, {\n        ref: \"form\",\n        \"label-width\": \"100\"\n      }, {\n        default: _withCtx(() => [\n          _createVNode(_component_el_form_item, { label: \"续费产品\" }, {\n            default: _withCtx(() => [\n              _createElementVNode(\"h6\", _hoisted_1, _toDisplayString(baseInfo.value.combineServiceName), 1)\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, { label: \"续费时间\" }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: _unref(formData).cycle,\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((_unref(formData).cycle) = $event)),\n                onChange: getSumPrice\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(initData).timeList, (item) => {\n                    return (_openBlock(), _createBlock(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"]))\n                  }), 128))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"])\n            ]),\n            _: 1\n          }),\n          (baseInfo.value.productType === 'resource')\n            ? (_openBlock(), _createBlock(_component_el_form_item, {\n                key: 0,\n                label: \"续费数量\"\n              }, {\n                default: _withCtx(() => [\n                  _createElementVNode(\"span\", _hoisted_2, _toDisplayString(baseInfo.value.residue) + _toDisplayString(baseInfo.value.unit), 1)\n                ]),\n                _: 1\n              }))\n            : _createCommentVNode(\"\", true),\n          _createVNode(_component_el_form_item, { label: \"续费价格\" }, {\n            default: _withCtx(() => [\n              _createElementVNode(\"span\", _hoisted_3, \"¥ \" + _toDisplayString(_unref(formData).sumPrice), 1)\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, { label: \"支付方式\" }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: _unref(formData).payType,\n                \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => ((_unref(formData).payType) = $event))\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(), _createElementBlock(_Fragment, null, _renderList(payList, (item) => {\n                    return _createVNode(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"])\n                  }), 64))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"])\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }, 512)\n    ]),\n    _: 1\n  }, 8, [\"model-value\"]))\n}\n}\n\n})","<template>\r\n  <el-dialog\r\n    :model-value=\"initData.visible\"\r\n    title=\"续费\"\r\n    width=\"480\"\r\n    @closed=\"handleClose\"\r\n    class=\"custom-dialog\"\r\n  >\r\n    <el-form ref=\"form\" label-width=\"100\">\r\n      <el-form-item label=\"续费产品\">\r\n        <h6 class=\"product-name\">{{ baseInfo.combineServiceName }}</h6>\r\n      </el-form-item>\r\n      <el-form-item label=\"续费时间\">\r\n        <el-select v-model=\"formData.cycle\" @change=\"getSumPrice\">\r\n          <el-option\r\n            v-for=\"item in initData.timeList\"\r\n            :key=\"item.value\"\r\n            :label=\"item.label\"\r\n            :value=\"item.value\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"续费数量\" v-if=\"baseInfo.productType === 'resource'\">\r\n        <span class=\"product-price\"\r\n          >{{ baseInfo.residue }}{{ baseInfo.unit }}</span\r\n        >\r\n      </el-form-item>\r\n      <el-form-item label=\"续费价格\">\r\n        <span class=\"product-price\">&yen;&nbsp;{{ formData.sumPrice }}</span>\r\n      </el-form-item>\r\n      <el-form-item label=\"支付方式\">\r\n        <el-select v-model=\"formData.payType\">\r\n          <el-option\r\n            v-for=\"item in payList\"\r\n            :key=\"item.value\"\r\n            :label=\"item.label\"\r\n            :value=\"item.value\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n    </el-form>\r\n    <template #footer>\r\n      <div class=\"dialog-footer\">\r\n        <el-button @click=\"handleClose\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleRenew\">续费</el-button>\r\n      </div>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { shallowRef, shallowReactive } from \"vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage, SessionStorage } from \"jz-tool-lib\";\r\nimport { arrayHasValue, judgeBoolean } from \"jz-tool-lib\";\r\nimport {\r\n  renewPriceApi,\r\n  productDetailApi,\r\n  resourceDetailApi,\r\n  purchasedCloudCallPackageApi,\r\n} from \"@api/order-management-api\";\r\n\r\nconst { routeQuery, goPage } = useVueRouter();\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n\r\ntype InitData = {\r\n  visible: boolean;\r\n  timeList: Record<string, any>[];\r\n};\r\nconst initData = shallowReactive<InitData>({\r\n  visible: false,\r\n  timeList: [\r\n    { label: \"1年\", value: \"1\" },\r\n    { label: \"2年\", value: \"2\" },\r\n    { label: \"3年\", value: \"3\" },\r\n  ],\r\n});\r\nconst baseInfo = shallowRef<Record<string, any>>({}); // 续费产品基本信息\r\nconst purchasedData = shallowRef<Record<string, any>>({}); // 已购产品信息\r\nconst productDetail = shallowRef<Record<string, any>>({}); // 产品详情\r\nconst renewPriceData = shallowRef<Record<string, any>>({}); // 续费价格信息\r\nconst formData = shallowReactive({\r\n  cycle: \"1\",\r\n  payType: \"WX\",\r\n  productPrice: \"0.00\", // 产品价格\r\n  sumPrice: \"0.00\", // 产品价格 + 附赠产品价格\r\n});\r\n// 支付方式\r\nconst payList = [\r\n  {\r\n    label: \"微信\",\r\n    value: \"WX\",\r\n    modePayment: \"onlinePayment\",\r\n  },\r\n  {\r\n    label: \"支付宝\",\r\n    value: \"ZFB\",\r\n    modePayment: \"onlinePayment\",\r\n  },\r\n  {\r\n    label: \"代理商企付宝\",\r\n    value: \"DLSZHYE\",\r\n    modePayment: \"balancePayment\",\r\n  },\r\n  {\r\n    label: \"代理商预付款\",\r\n    value: \"DLSYHK\",\r\n    modePayment: \"balancePayment\",\r\n  },\r\n];\r\n// 获取服务产品详情\r\nasync function getProductDetail() {\r\n  if (baseInfo.value.productType === \"service\") {\r\n    const params = {\r\n      serviceCode: baseInfo.value.combineServiceCode,\r\n    };\r\n    const { data } = await productDetailApi.getData(params);\r\n    productDetail.value = productDetailApi.handleData(data);\r\n    if (\r\n      [\"CLOUD_CALL_PACKAGE\", \"CLOUD_CALL_SOFT\"].includes(\r\n        baseInfo.value.combineServiceCode\r\n      )\r\n    ) {\r\n      const addedServiceCode = {\r\n        CLOUD_CALL_SOFT: \"CALL_CENTER_ADDED\",\r\n        CLOUD_CALL_PACKAGE: \"CALL_PACKAGE_ADDED_NEW\",\r\n      };\r\n      initData.timeList = handleSpecs(\r\n        addedServiceCode[baseInfo.value.combineServiceCode],\r\n        0,\r\n        productDetail.value.addedServiceList\r\n      );\r\n    } else if (\r\n      [\"SCRM\", \"WEB_CUSTOMER_PHONE\"].includes(baseInfo.value.combineServiceCode)\r\n    ) {\r\n      initData.timeList = [{ label: \"1年\", value: \"1\" }];\r\n    }\r\n    formData.cycle = initData.timeList[0].value;\r\n  } else if (baseInfo.value.productType === \"resource\") {\r\n    const params = {\r\n      sizeCode: baseInfo.value.addedCodes,\r\n    };\r\n    const { data } = await resourceDetailApi.getData(params);\r\n    productDetail.value = resourceDetailApi.handleData(data);\r\n  }\r\n}\r\n\r\n// 获取产品基础价格\r\nasync function getRenewUnitPrice(\r\n  marketCode = baseInfo.value.combineServiceCode\r\n) {\r\n  const params = {\r\n    agentId: userInfo.profileId,\r\n    helpOrder: 1,\r\n    companyId: routeQuery.value.companyId,\r\n    marketCode,\r\n    addedCode: baseInfo.value.addedCodes,\r\n  };\r\n  const { data } = await renewPriceApi.getData(params);\r\n  renewPriceData.value = renewPriceApi.handleData(data);\r\n}\r\n\r\n// 获取已购产品信息【鱼鹰呼叫套餐】\r\nasync function getPurchasedInfo() {\r\n  const params = {\r\n    companyId: routeQuery.value.companyId,\r\n    marketCode: baseInfo.value.combineServiceCode,\r\n  };\r\n  const { data } = await purchasedCloudCallPackageApi.getData(params);\r\n  purchasedData.value = purchasedCloudCallPackageApi.handleData(data);\r\n}\r\n// 【鱼鹰呼叫套餐，鱼鹰呼叫软件】 处理周期\r\nfunction handleSpecs(\r\n  addedServiceCode: string,\r\n  specsIndex: number,\r\n  addedServiceList: Record<string, any>\r\n) {\r\n  const list: Record<string, any>[] = [];\r\n  const specsList = addedServiceList.find(\r\n    (item) => item.addedServiceCode === addedServiceCode\r\n  ).specsList;\r\n  if (!arrayHasValue(specsList)) return list;\r\n  specsList.forEach((item) => {\r\n    const groupNameList = item.groupNames.split(\",\");\r\n    const groupValueList = item.groupValues.split(\",\");\r\n    const groupCodeList = item.groupCodes.split(\",\");\r\n    const specsValue = {\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n      coding: item.coding,\r\n      serviceCode: item.serviceCode,\r\n      groupNameList,\r\n      groupValueList,\r\n      groupCodeList,\r\n    };\r\n    const info = list.find((sonItem: Record<string, any>) => {\r\n      return sonItem.value === groupValueList[specsIndex];\r\n    });\r\n    if (!info) {\r\n      list.push({\r\n        value: groupValueList[specsIndex],\r\n        label: groupNameList[specsIndex],\r\n        specs: [specsValue],\r\n      });\r\n    } else {\r\n      info.specs.push(specsValue);\r\n    }\r\n  });\r\n  return list.sort((a, b) => {\r\n    return a.value - b.value;\r\n  });\r\n}\r\n// 获取总价\r\nfunction getSumPrice() {\r\n  const productPrice =\r\n    new BigNumber(formData.cycle).toNumber() *\r\n    new BigNumber(renewPriceData.value.basePrice).toNumber();\r\n  const addedPrice = new BigNumber(renewPriceData.value.addedPrice).toNumber();\r\n  formData.sumPrice = judgeBoolean(productPrice, addedPrice)\r\n    ? new BigNumber(productPrice + addedPrice).toFixed(2)\r\n    : \"0.00\";\r\n  formData.productPrice = productPrice\r\n    ? new BigNumber(productPrice).toFixed(2)\r\n    : \"0.00\";\r\n}\r\n// 提交续费\r\nfunction handleRenew() {\r\n  const serviceInfo = productDetail.value.serviceInfo;\r\n  const payTypeInfo = payList.find((item) => formData.payType === item.value);\r\n  const params: Record<string, any> = {\r\n    agentId: userInfo.profileId, // 代理商id\r\n    buyCar: false, // 是否为购物车下单\r\n    helpOrder: 1, // 是否代客下单0：否，1：是\r\n    buyType: \"RENEW\", // 购买：BUY_SERVER,升级：UPGRADE,续费：RENEW\r\n    paymentType: payTypeInfo?.value,\r\n    modePayment: payTypeInfo?.modePayment,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: [\"CLOUD_CALL_PACKAGE\", \"CLOUD_CALL_SOFT\"].includes(\r\n          serviceInfo.combineServiceCode\r\n        )\r\n          ? 2\r\n          : 3, // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: formData.cycle, // 时长\r\n        marketCode: serviceInfo.combineServiceCode,\r\n        baseCodeList: [],\r\n      },\r\n    ],\r\n    sumPrice: formData.sumPrice, // 商品总价(商品价格 + 附赠产品价格)\r\n  };\r\n  // 附赠产品\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...productDetail.value?.serviceInfo,\r\n        price: formData.productPrice,\r\n        augmentedServiceList: renewPriceData.value.subMarketList.map((item) => {\r\n          if (item.calculateType === \"1\") {\r\n            item.specsInfo = `${formData.cycle}个月`;\r\n          }\r\n          return item;\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: formData.sumPrice,\r\n  };\r\n  if ([\"1\"].includes(serviceInfo.calculateType)) {\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: null,\r\n        number: 0,\r\n      },\r\n    ];\r\n    const specsInfo = `${formData.cycle}年期；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  } else if ([\"2\"].includes(serviceInfo.calculateType)) {\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: baseInfo.value.addedCodes,\r\n        number: baseInfo.value.residue,\r\n      },\r\n    ];\r\n    const specsInfo = `续费数量：${baseInfo.value.residue}${baseInfo.value.unit}；${formData.cycle}年期；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  } else if ([\"3\"].includes(serviceInfo.calculateType)) {\r\n    // 鱼鹰呼叫套餐\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: \"CALL_PACKAGE_TIME\",\r\n        number: formData.cycle,\r\n      },\r\n    ];\r\n    const seatSize = new BigNumber(purchasedData.value.seatSize).toNumber();\r\n    const minuteNum = new BigNumber(\r\n      purchasedData.value.chooseMinute\r\n    ).toNumber();\r\n    const minuteTotal =\r\n      seatSize && minuteNum\r\n        ? new BigNumber(seatSize && minuteNum).toNumber()\r\n        : 0;\r\n    const specsInfo = `套餐周期：${formData.cycle}个月；最低消费：${purchasedData.value.chooseMinFee}元/坐席/月；系统软件费：${purchasedData.value.callSoftPrice}元/坐席/月；${baseInfo.value.userNumber}个坐席；${purchasedData.value.chooseMinute}分钟/坐席/月（总计${minuteTotal}分钟/月，分钟数可共享）；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  } else if ([\"6\"].includes(serviceInfo.calculateType)) {\r\n    // 鱼鹰呼叫软件和软件坐席\r\n    params.shopBuyList[0].baseCodeList = [\r\n      {\r\n        baseCode: serviceInfo.addedCodes,\r\n        number: baseInfo.value.userNumber,\r\n      },\r\n    ];\r\n    const specsInfo = `${baseInfo.value.userNumber}个坐席；坐席单价${renewPriceData.value.seatUnitPrice}元；${formData.cycle}个月；`;\r\n    Reflect.set(commodityInfo.list[0], \"specsInfo\", specsInfo);\r\n  }\r\n  SessionStorage.setItem(\"bd_market-cart\", params);\r\n  SessionStorage.setItem(\"bd_market-commodity\", commodityInfo);\r\n  goPage(\"/orderManagement/createOrder/confirmOrder\");\r\n}\r\n// 关闭弹框\r\nfunction handleClose() {\r\n  initData.visible = false;\r\n  initData.timeList = [\r\n    { label: \"1年\", value: \"1\" },\r\n    { label: \"2年\", value: \"2\" },\r\n    { label: \"3年\", value: \"3\" },\r\n  ];\r\n  formData.cycle = \"1\";\r\n  formData.payType = \"WX\";\r\n  formData.sumPrice = \"0.00\";\r\n  baseInfo.value = {}; // 续费产品信息\r\n  purchasedData.value = {}; // 已购产品信息\r\n  productDetail.value = {}; // 产品详情\r\n  renewPriceData.value = {}; // 续费价格信息\r\n}\r\n\r\nfunction toggle(visible: boolean, info: Record<string, any>) {\r\n  baseInfo.value = info;\r\n  initData.visible = visible;\r\n  let apiList: Promise<any>[] = [];\r\n  if (baseInfo.value.productType === \"service\") {\r\n    apiList = [...[getRenewUnitPrice(), getProductDetail()]];\r\n    if ([\"CLOUD_CALL_PACKAGE\"].includes(baseInfo.value.combineServiceCode)) {\r\n      apiList.push(getPurchasedInfo());\r\n    }\r\n    Promise.allSettled(apiList).then(() => {\r\n      getSumPrice();\r\n    });\r\n  } else if (baseInfo.value.productType === \"resource\") {\r\n    getProductDetail().then(async () => {\r\n      await getRenewUnitPrice(\r\n        productDetail.value.serviceInfo.combineServiceCode\r\n      );\r\n      getSumPrice();\r\n    });\r\n  }\r\n}\r\ndefineExpose({\r\n  toggle,\r\n});\r\n\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.product-name {\r\n  font-size: 14px;\r\n  color: #242934;\r\n}\r\n.product-price {\r\n  font-size: 14px;\r\n  color: #f12525;\r\n}\r\n:deep(.el-form-item__label) {\r\n  padding-right: 20px;\r\n}\r\n</style>\r\n","import script from \"./renew-dialog.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./renew-dialog.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./renew-dialog.vue?vue&type=style&index=0&id=0d80b5f8&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_typescript@5.7.2__webpack@5.97.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0d80b5f8\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_defineComponent","__name","setup","__props","expose","__expose","routeQuery","goPage","useVueRouter","bd_userInfo","userInfo","LocalStorage","batchGetItem","initData","shallowReactive","visible","timeList","label","value","baseInfo","shallowRef","purchasedData","productDetail","renewPriceData","formData","cycle","payType","productPrice","sumPrice","payList","modePayment","async","getProductDetail","productType","params","serviceCode","combineServiceCode","data","productDetailApi","getData","handleData","includes","addedServiceCode","CLOUD_CALL_SOFT","CLOUD_CALL_PACKAGE","handleSpecs","addedServiceList","sizeCode","addedCodes","resourceDetailApi","getRenewUnitPrice","marketCode","agentId","profileId","helpOrder","companyId","addedCode","renewPriceApi","getPurchasedInfo","purchasedCloudCallPackageApi","specsIndex","list","specsList","find","item","arrayHasValue","forEach","groupNameList","groupNames","split","groupValueList","groupValues","groupCodeList","groupCodes","specsValue","minNum","maxNum","coding","info","sonItem","specs","push","sort","a","b","getSumPrice","BigNumber","toNumber","basePrice","addedPrice","judgeBoolean","toFixed","handleRenew","_productDetail$value","serviceInfo","payTypeInfo","buyCar","buyType","paymentType","shopBuyList","isisTry","dateType","dateValue","baseCodeList","commodityInfo","price","augmentedServiceList","subMarketList","map","calculateType","specsInfo","baseCode","number","Reflect","set","residue","unit","seatSize","minuteNum","chooseMinute","minuteTotal","chooseMinFee","callSoftPrice","userNumber","seatUnitPrice","SessionStorage","setItem","handleClose","toggle","apiList","Promise","allSettled","then","_ctx","_cache","_component_el_form_item","_resolveComponent","_component_el_option","_component_el_select","_component_el_form","_component_el_button","_component_el_dialog","_openBlock","_createBlock","_unref","title","width","onClosed","footer","_withCtx","_createElementVNode","_createVNode","onClick","default","_createTextVNode","_","type","ref","_toDisplayString","combineServiceName","modelValue","$event","onChange","_createElementBlock","_Fragment","_renderList","key","_createCommentVNode","__exports__"],"sourceRoot":""}