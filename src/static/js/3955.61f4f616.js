"use strict";(self["webpackChunkdaili"]=self["webpackChunkdaili"]||[]).push([[3955],{83955:function(e,a,o){o.r(a),o.d(a,{default:function(){return C}});o(59784),o(47961);var t=o(6254),l=o(25598),d=o(38627),n=o(55533),i=o(91373),p=o(10901),c=o(88365),u=o(79689),s=o(35287);const m={class:"header-title"},r={class:"QRCode-content"},y={class:"prompt"},b={key:1,class:"QRCode-content"};var k=(0,t.pM)({__name:"report-QRCode-dialog",setup(e,{expose:a}){const k=(0,t.$V)((()=>Promise.all([o.e(2076),o.e(4199)]).then(o.bind(o,10044)))),{bd_userInfo:f,bd_virCompanyId:v}=c.DT.batchGetItem(["bd_userInfo","bd_virCompanyId"]),C=(0,l.KR)(),I=(0,l.Kh)({visible:!1,addSubCustomerVisible:!1,step:1,type:"",title:"",companyName:"",wechatQrCode:"",companyList:[]}),g=(0,l.KR)({id:"",companyId:"",companyCode:"",companyName:""}),_=(0,l.Kh)({companyId:""}),h={companyId:[{required:!0,message:"请选择公司",trigger:"blur"}]};async function F(e){if(!e)return;const a={parentId:f.profileId,pageSize:5e3,businessType:0,companyName:e??""},{data:o}=await u.ey.getData(a);I.companyList=u.ey.handleData(o).list}function L(){I.step=1,I.title="选择公司"}const $=()=>{I.addSubCustomerVisible=!0};async function Q(e){e&&e.validate((async(e,a)=>{if(e){I.step=2,I.title="扫码报备";const e=I.companyList.find((e=>e.companyId===_.companyId));I.companyName=null===e||void 0===e?void 0:e.companyName;const a={companyId:e.companyId,param:`profileId=${f.profileId}&source=1&companyId=${e.companyId}`},{data:o}=await s.k7.getData(a),t=`${o.urlLink}?${o.param}`,l=document.getElementById("qrCode");l.innerHTML="",t?(0,p.i$)({dom:l,text:t,width:240,height:240}):l.innerHTML="加载失败"}else console.log("error submit!",a)}))}async function W(){const e={source:7,companyName:g.value.companyName,param:`profileId=${f.profileId}&source=7&companyId=${g.value.companyId}&companyCode=${g.value.companyCode}&agentId=${v}&reportId=${g.value.id}`},{data:a}=await s.f$.getData(e);I.wechatQrCode=a.qrCodeUrl}function w(){I.type="",g.value={id:"",companyId:"",companyCode:"",companyName:""},_.companyId="",I.step=1,I.visible=!1}async function V(){"edit"===I.type&&await W()}function K(e,a){I.visible=e,I.type=a.type,e&&("add"===a.type?(F(),I.step=1,I.title="选择公司"):"edit"===a.type&&(I.step=2,I.title="扫码报备",g.value=a.info))}return a({trigger:K}),(e,a)=>{const o=(0,t.g2)("el-icon"),p=(0,t.g2)("el-option"),c=(0,t.g2)("el-select"),u=(0,t.g2)("el-button"),s=(0,t.g2)("el-form-item"),f=(0,t.g2)("el-form"),v=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.bF)(v,{modelValue:I.visible,"onUpdate:modelValue":a[3]||(a[3]=e=>I.visible=e),class:"custom-dialog",width:"580px",onOpen:V,onClosed:w},{header:(0,t.k6)((()=>[(0,t.Lk)("header",m,["add"===I.type&&2===I.step?((0,t.uX)(),(0,t.Wv)(o,{key:0,onClick:L},{default:(0,t.k6)((()=>[(0,t.bF)((0,l.R1)(i.nkM))])),_:1})):(0,t.Q3)("",!0),(0,t.eW)(" "+(0,d.v_)(I.title),1)])])),footer:(0,t.k6)((()=>["add"===I.type?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[1===I.step?((0,t.uX)(),(0,t.Wv)(u,{key:0,type:"primary",onClick:a[2]||(a[2]=e=>Q(C.value))},{default:(0,t.k6)((()=>a[10]||(a[10]=[(0,t.eW)("确定")]))),_:1})):(0,t.Q3)("",!0),2===I.step?((0,t.uX)(),(0,t.Wv)(u,{key:1,onClick:w},{default:(0,t.k6)((()=>a[11]||(a[11]=[(0,t.eW)("取消")]))),_:1})):(0,t.Q3)("",!0)],64)):(0,t.Q3)("",!0),"edit"===I.type?((0,t.uX)(),(0,t.Wv)(u,{key:1,onClick:w},{default:(0,t.k6)((()=>a[12]||(a[12]=[(0,t.eW)("取消")]))),_:1})):(0,t.Q3)("",!0)])),default:(0,t.k6)((()=>["add"===I.type?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bo)((0,t.bF)(f,{ref_key:"ruleFormRef",ref:C,model:_,rules:h},{default:(0,t.k6)((()=>[(0,t.bF)(s,{label:"公司名称",prop:"companyId"},{default:(0,t.k6)((()=>[(0,t.bF)(c,{modelValue:_.companyId,"onUpdate:modelValue":a[0]||(a[0]=e=>_.companyId=e),placeholder:"请选择公司",clearable:"",filterable:"",remote:"","reserve-keyword":"","remote-method":F},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(I.companyList,(e=>((0,t.uX)(),(0,t.Wv)(p,{key:e.companyId,label:`${e.companyName}（${e.companyCode}）`,value:e.companyId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,t.bF)(u,{onClick:$},{default:(0,t.k6)((()=>a[5]||(a[5]=[(0,t.eW)("新增子客户")]))),_:1})])),_:1})])),_:1},8,["model"]),[[n.aG,1===I.step]]),(0,t.bo)((0,t.Lk)("div",null,[(0,t.Lk)("div",r,[(0,t.bF)(o,{onClick:a[1]||(a[1]=e=>Q(C.value))},{default:(0,t.k6)((()=>[(0,t.bF)((0,l.R1)(i.kyK))])),_:1}),a[6]||(a[6]=(0,t.Lk)("div",{id:"qrCode"},null,-1))]),(0,t.Lk)("p",y,[a[7]||(a[7]=(0,t.eW)(" 您已选择")),(0,t.Lk)("span",null,(0,d.v_)(I.companyName),1),a[8]||(a[8]=(0,t.eW)(" ，扫描上方二维码，关注公众号进行业务报备;后续报备结果可在公众号查看 "))])],512),[[n.aG,2===I.step]])],64)):(0,t.Q3)("",!0),"edit"===I.type?((0,t.uX)(),(0,t.CE)("div",b,[(0,t.bF)(o,{onClick:W},{default:(0,t.k6)((()=>[(0,t.bF)((0,l.R1)(i.kyK))])),_:1}),a[9]||(a[9]=(0,t.Lk)("div",{id:"qrCode"},null,-1))])):(0,t.Q3)("",!0)])),_:1},8,["modelValue"]),(0,t.bF)((0,l.R1)(k),{visible:I.addSubCustomerVisible,"onUpdate:visible":a[4]||(a[4]=e=>I.addSubCustomerVisible=e)},null,8,["visible"])],64)}}}),f=o(83936);const v=(0,f.A)(k,[["__scopeId","data-v-4d900868"]]);var C=v}}]);
//# sourceMappingURL=3955.61f4f616.js.map