{"version":3,"file":"static/js/3955.61f4f616.js","mappings":"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","sources":["webpack://daili/./src/components/business-management/ospreyCloudCall/report/list/report-QRCode-dialog.vue?2038","webpack://daili/./src/components/business-management/ospreyCloudCall/report/list/report-QRCode-dialog.vue","webpack://daili/./src/components/business-management/ospreyCloudCall/report/list/report-QRCode-dialog.vue?83ee"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { unref as _unref, createVNode as _createVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, vShow as _vShow, withDirectives as _withDirectives } from \"vue\"\n\nconst _hoisted_1 = { class: \"header-title\" }\nconst _hoisted_2 = { class: \"QRCode-content\" }\nconst _hoisted_3 = { class: \"prompt\" }\nconst _hoisted_4 = {\n  key: 1,\n  class: \"QRCode-content\"\n}\n\nimport { ref, reactive, defineAsyncComponent } from \"vue\";\r\nimport { ArrowLeft, RefreshRight } from \"@element-plus/icons-vue\";\r\n\r\nimport { useQRCode } from \"@/assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\n\r\nimport { allCustomerApi } from \"@api/customer-management-api\";\r\nimport {\r\n  reportWechatQrcodeApi,\r\n  reportUrlLinkApi,\r\n} from \"@api/business-management-api\";\r\n\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'report-QRCode-dialog',\n  setup(__props, { expose: __expose }) {\n\r\nconst AddSubCustomerDialog = defineAsyncComponent(\r\n  () =>\r\n    import(\r\n      \"@components/customer-management/personal-customer/list/add-sub-customer-dialog.vue\"\r\n    )\r\n);\r\n\r\n// const emits = defineEmits<{\r\n//   (\r\n//     e: \"emitFunc\",\r\n//     value: {\r\n//       type: \"list\" | \"report-electron\" | \"report-manual\";\r\n//       info?: Record<string, any>;\r\n//     }\r\n//   ): void;\r\n// }>();\r\nconst { bd_userInfo: userInfo, bd_virCompanyId: virCompanyId } =\r\n  LocalStorage.batchGetItem([\"bd_userInfo\", \"bd_virCompanyId\"]);\r\nconst ruleFormRef = ref();\r\nconst initData = reactive<Record<string, any>>({\r\n  visible: false,\r\n  addSubCustomerVisible: false,\r\n  step: 1,\r\n  type: \"\",\r\n  title: \"\",\r\n  companyName: \"\",\r\n  wechatQrCode: \"\",\r\n  companyList: [],\r\n});\r\nconst companyInfo = ref({\r\n  id: \"\",\r\n  companyId: \"\",\r\n  companyCode: \"\",\r\n  companyName: \"\",\r\n});\r\nconst formData = reactive({\r\n  companyId: \"\",\r\n});\r\nconst rules = {\r\n  companyId: [{ required: true, message: \"请选择公司\", trigger: \"blur\" }],\r\n};\r\n\r\n// 获取公司列表\r\nasync function getList(value?: string) {\r\n  if (!value) return;\r\n  const params = {\r\n    parentId: userInfo.profileId,\r\n    pageSize: 5000,\r\n    businessType: 0,\r\n    companyName: value ?? \"\",\r\n  };\r\n  const { data } = await allCustomerApi.getData(params);\r\n  initData.companyList = allCustomerApi.handleData(data).list;\r\n}\r\n\r\n// 返回选择公司\r\nfunction handleBackCompany() {\r\n  initData.step = 1;\r\n  initData.title = \"选择公司\";\r\n}\r\n\r\n// 添加子客户\r\nconst handleOperate = () => {\r\n  initData.addSubCustomerVisible = true;\r\n};\r\n\r\n// 新增业务报备时-确认选择公司（新增电子化）  source：报备来源 (1:直客报备H5 2:直客报备PC 3:子业务报备H5 4:子业务报备PC 5:销售代客户报备 6:代理商报备 7:代理商子公司报备)\r\nasync function handleQRCodeAdd(formEl: Record<string, any>) {\r\n  if (!formEl) return;\r\n  formEl.validate(async (valid, fields) => {\r\n    if (valid) {\r\n      initData.step = 2;\r\n      initData.title = \"扫码报备\";\r\n      const companyInfo: any = initData.companyList.find(\r\n        (item: Record<string, any>) => item.companyId === formData.companyId\r\n      );\r\n      initData.companyName = companyInfo?.companyName;\r\n      // const params: Record<string, any> = {\r\n      //   source: undefined,\r\n      //   companyName: companyInfo.companyName,\r\n      //   param: \"\",\r\n      // };\r\n      // if (companyInfo.businessType === 0) {\r\n      //   params.source = 5;\r\n      //   params.param = `profileId=${userInfo.profileId}&source=5&companyId=${companyInfo.companyId}&businessType=0&saleId=`;\r\n      // } else if (companyInfo.businessType === 1) {\r\n      //   params.source = 7;\r\n      //   params.param = `profileId=${userInfo.profileId}&source=7&companyId=${companyInfo.companyId}&companyCode=${companyInfo.companyCode}&agentId=${virCompanyId}&businessType=1`;\r\n      // }\r\n      // const { data } = await reportWechatQrcodeApi.getData(params);\r\n      // initData.wechatQrCode = data.qrCodeUrl;\r\n\r\n      const params = {\r\n        companyId: companyInfo.companyId,\r\n        param: `profileId=${userInfo.profileId}&source=1&companyId=${companyInfo.companyId}`,\r\n      };\r\n      const { data } = await reportUrlLinkApi.getData(params);\r\n      const url = `${data.urlLink}?${data.param}`;\r\n      const qrCodeEle = document.getElementById(\"qrCode\")!;\r\n      qrCodeEle.innerHTML = \"\";\r\n      if (url) {\r\n        useQRCode({\r\n          dom: qrCodeEle,\r\n          text: url,\r\n          width: 240,\r\n          height: 240,\r\n        });\r\n      } else {\r\n        qrCodeEle.innerHTML = \"加载失败\";\r\n      }\r\n    } else {\r\n      console.log(\"error submit!\", fields);\r\n    }\r\n  });\r\n}\r\n\r\n// 编辑业务报备时\r\nasync function handleQRCodeEdit() {\r\n  const params = {\r\n    source: 7,\r\n    companyName: companyInfo.value.companyName,\r\n    param: `profileId=${userInfo.profileId}&source=7&companyId=${companyInfo.value.companyId}&companyCode=${companyInfo.value.companyCode}&agentId=${virCompanyId}&reportId=${companyInfo.value.id}`,\r\n  };\r\n  const { data } = await reportWechatQrcodeApi.getData(params);\r\n  initData.wechatQrCode = data.qrCodeUrl;\r\n}\r\n\r\nfunction handleClose() {\r\n  initData.type = \"\";\r\n  companyInfo.value = {\r\n    id: \"\",\r\n    companyId: \"\",\r\n    companyCode: \"\",\r\n    companyName: \"\",\r\n  };\r\n  formData.companyId = \"\";\r\n  initData.step = 1;\r\n  initData.visible = false;\r\n}\r\n// 编辑业务报备（电子化）\r\nasync function handleOpen() {\r\n  if (initData.type === \"edit\") {\r\n    await handleQRCodeEdit();\r\n  }\r\n}\r\n// function handleManualReport() {\r\n//   emits(\"emitFunc\", {\r\n//     type: \"report-manual\",\r\n//     info: companyInfo.value,\r\n//   });\r\n// }\r\nfunction trigger(visible, data) {\r\n  initData.visible = visible;\r\n  initData.type = data.type;\r\n  if (visible) {\r\n    if (data.type === \"add\") {\r\n      getList();\r\n      initData.step = 1;\r\n      initData.title = \"选择公司\";\r\n    } else if (data.type === \"edit\") {\r\n      initData.step = 2;\r\n      initData.title = \"扫码报备\";\r\n      companyInfo.value = data.info;\r\n    }\r\n  }\r\n}\r\n__expose({\r\n  trigger,\r\n});\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_icon = _resolveComponent(\"el-icon\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_button = _resolveComponent(\"el-button\")!\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n  const _component_el_dialog = _resolveComponent(\"el-dialog\")!\n\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    _createVNode(_component_el_dialog, {\n      modelValue: initData.visible,\n      \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event: any) => ((initData.visible) = $event)),\n      class: \"custom-dialog\",\n      width: \"580px\",\n      onOpen: handleOpen,\n      onClosed: handleClose\n    }, {\n      header: _withCtx(() => [\n        _createElementVNode(\"header\", _hoisted_1, [\n          (initData.type === 'add' && initData.step === 2)\n            ? (_openBlock(), _createBlock(_component_el_icon, {\n                key: 0,\n                onClick: handleBackCompany\n              }, {\n                default: _withCtx(() => [\n                  _createVNode(_unref(ArrowLeft))\n                ]),\n                _: 1\n              }))\n            : _createCommentVNode(\"\", true),\n          _createTextVNode(\" \" + _toDisplayString(initData.title), 1)\n        ])\n      ]),\n      footer: _withCtx(() => [\n        (initData.type === 'add')\n          ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n              (initData.step === 1)\n                ? (_openBlock(), _createBlock(_component_el_button, {\n                    key: 0,\n                    type: \"primary\",\n                    onClick: _cache[2] || (_cache[2] = ($event: any) => (handleQRCodeAdd(ruleFormRef.value)))\n                  }, {\n                    default: _withCtx(() => _cache[10] || (_cache[10] = [\n                      _createTextVNode(\"确定\")\n                    ])),\n                    _: 1\n                  }))\n                : _createCommentVNode(\"\", true),\n              (initData.step === 2)\n                ? (_openBlock(), _createBlock(_component_el_button, {\n                    key: 1,\n                    onClick: handleClose\n                  }, {\n                    default: _withCtx(() => _cache[11] || (_cache[11] = [\n                      _createTextVNode(\"取消\")\n                    ])),\n                    _: 1\n                  }))\n                : _createCommentVNode(\"\", true)\n            ], 64))\n          : _createCommentVNode(\"\", true),\n        (initData.type === 'edit')\n          ? (_openBlock(), _createBlock(_component_el_button, {\n              key: 1,\n              onClick: handleClose\n            }, {\n              default: _withCtx(() => _cache[12] || (_cache[12] = [\n                _createTextVNode(\"取消\")\n              ])),\n              _: 1\n            }))\n          : _createCommentVNode(\"\", true)\n      ]),\n      default: _withCtx(() => [\n        (initData.type === 'add')\n          ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n              _withDirectives(_createVNode(_component_el_form, {\n                ref_key: \"ruleFormRef\",\n                ref: ruleFormRef,\n                model: formData,\n                rules: rules\n              }, {\n                default: _withCtx(() => [\n                  _createVNode(_component_el_form_item, {\n                    label: \"公司名称\",\n                    prop: \"companyId\"\n                  }, {\n                    default: _withCtx(() => [\n                      _createVNode(_component_el_select, {\n                        modelValue: formData.companyId,\n                        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((formData.companyId) = $event)),\n                        placeholder: \"请选择公司\",\n                        clearable: \"\",\n                        filterable: \"\",\n                        remote: \"\",\n                        \"reserve-keyword\": \"\",\n                        \"remote-method\": getList\n                      }, {\n                        default: _withCtx(() => [\n                          (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(initData.companyList, (item) => {\n                            return (_openBlock(), _createBlock(_component_el_option, {\n                              key: item.companyId,\n                              label: `${item.companyName}（${item.companyCode}）`,\n                              value: item.companyId\n                            }, null, 8, [\"label\", \"value\"]))\n                          }), 128))\n                        ]),\n                        _: 1\n                      }, 8, [\"modelValue\"]),\n                      _createVNode(_component_el_button, { onClick: handleOperate }, {\n                        default: _withCtx(() => _cache[5] || (_cache[5] = [\n                          _createTextVNode(\"新增子客户\")\n                        ])),\n                        _: 1\n                      })\n                    ]),\n                    _: 1\n                  })\n                ]),\n                _: 1\n              }, 8, [\"model\"]), [\n                [_vShow, initData.step === 1]\n              ]),\n              _withDirectives(_createElementVNode(\"div\", null, [\n                _createElementVNode(\"div\", _hoisted_2, [\n                  _createVNode(_component_el_icon, {\n                    onClick: _cache[1] || (_cache[1] = ($event: any) => (handleQRCodeAdd(ruleFormRef.value)))\n                  }, {\n                    default: _withCtx(() => [\n                      _createVNode(_unref(RefreshRight))\n                    ]),\n                    _: 1\n                  }),\n                  _cache[6] || (_cache[6] = _createElementVNode(\"div\", { id: \"qrCode\" }, null, -1))\n                ]),\n                _createElementVNode(\"p\", _hoisted_3, [\n                  _cache[7] || (_cache[7] = _createTextVNode(\" 您已选择\")),\n                  _createElementVNode(\"span\", null, _toDisplayString(initData.companyName), 1),\n                  _cache[8] || (_cache[8] = _createTextVNode(\" ，扫描上方二维码，关注公众号进行业务报备;后续报备结果可在公众号查看 \"))\n                ])\n              ], 512), [\n                [_vShow, initData.step === 2]\n              ])\n            ], 64))\n          : _createCommentVNode(\"\", true),\n        (initData.type === 'edit')\n          ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [\n              _createVNode(_component_el_icon, { onClick: handleQRCodeEdit }, {\n                default: _withCtx(() => [\n                  _createVNode(_unref(RefreshRight))\n                ]),\n                _: 1\n              }),\n              _cache[9] || (_cache[9] = _createElementVNode(\"div\", { id: \"qrCode\" }, null, -1))\n            ]))\n          : _createCommentVNode(\"\", true)\n      ]),\n      _: 1\n    }, 8, [\"modelValue\"]),\n    _createVNode(_unref(AddSubCustomerDialog), {\n      visible: initData.addSubCustomerVisible,\n      \"onUpdate:visible\": _cache[4] || (_cache[4] = ($event: any) => ((initData.addSubCustomerVisible) = $event))\n    }, null, 8, [\"visible\"])\n  ], 64))\n}\n}\n\n})","<template>\r\n  <el-dialog\r\n    v-model=\"initData.visible\"\r\n    class=\"custom-dialog\"\r\n    width=\"580px\"\r\n    @open=\"handleOpen\"\r\n    @closed=\"handleClose\"\r\n  >\r\n    <template #header>\r\n      <header class=\"header-title\">\r\n        <template v-if=\"initData.type === 'add' && initData.step === 2\">\r\n          <el-icon @click=\"handleBackCompany\"><ArrowLeft /></el-icon>\r\n        </template>\r\n        {{ initData.title }}\r\n      </header>\r\n    </template>\r\n    <template v-if=\"initData.type === 'add'\">\r\n      <el-form\r\n        v-show=\"initData.step === 1\"\r\n        ref=\"ruleFormRef\"\r\n        :model=\"formData\"\r\n        :rules=\"rules\"\r\n      >\r\n        <el-form-item label=\"公司名称\" prop=\"companyId\">\r\n          <el-select\r\n            v-model=\"formData.companyId\"\r\n            placeholder=\"请选择公司\"\r\n            clearable\r\n            filterable\r\n            remote\r\n            reserve-keyword\r\n            :remote-method=\"getList\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in initData.companyList\"\r\n              :key=\"item.companyId\"\r\n              :label=\"`${item.companyName}（${item.companyCode}）`\"\r\n              :value=\"item.companyId\"\r\n            />\r\n          </el-select>\r\n          <el-button @click=\"handleOperate\">新增子客户</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div v-show=\"initData.step === 2\">\r\n        <div class=\"QRCode-content\">\r\n          <el-icon @click=\"handleQRCodeAdd(ruleFormRef)\"\r\n            ><RefreshRight\r\n          /></el-icon>\r\n          <div id=\"qrCode\">\r\n            <!--          <img :src=\"initData.wechatQrCode\" alt=\"\" />-->\r\n          </div>\r\n        </div>\r\n        <p class=\"prompt\">\r\n          您已选择<span>{{ initData.companyName }}</span>\r\n          ，扫描上方二维码，关注公众号进行业务报备;后续报备结果可在公众号查看\r\n        </p>\r\n      </div>\r\n    </template>\r\n    <template v-if=\"initData.type === 'edit'\">\r\n      <div class=\"QRCode-content\">\r\n        <el-icon @click=\"handleQRCodeEdit\"><RefreshRight /></el-icon>\r\n        <div id=\"qrCode\">\r\n          <!--          <img :src=\"initData.wechatQrCode\" alt=\"\" />-->\r\n        </div>\r\n      </div>\r\n      <!--      <p class=\"prompt\" v-if=\"initData.type === 'edit'\">-->\r\n      <!--        您也可通过<span @click=\"handleManualReport\">【手动报备】</span-->\r\n      <!--        >来进行业务资料的报备-->\r\n      <!--      </p>-->\r\n    </template>\r\n    <template #footer>\r\n      <template v-if=\"initData.type === 'add'\">\r\n        <template v-if=\"initData.step === 1\">\r\n          <el-button type=\"primary\" @click=\"handleQRCodeAdd(ruleFormRef)\"\r\n            >确定</el-button\r\n          >\r\n        </template>\r\n        <el-button v-if=\"initData.step === 2\" @click=\"handleClose\"\r\n          >取消</el-button\r\n        >\r\n      </template>\r\n      <template v-if=\"initData.type === 'edit'\">\r\n        <el-button @click=\"handleClose\">取消</el-button>\r\n      </template>\r\n    </template>\r\n  </el-dialog>\r\n  <!-- 新增子客户 -->\r\n  <AddSubCustomerDialog\r\n    v-model:visible=\"initData.addSubCustomerVisible\"\r\n  ></AddSubCustomerDialog>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { ref, reactive, defineAsyncComponent } from \"vue\";\r\nimport { ArrowLeft, RefreshRight } from \"@element-plus/icons-vue\";\r\n\r\nimport { useQRCode } from \"@/assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\n\r\nimport { allCustomerApi } from \"@api/customer-management-api\";\r\nimport {\r\n  reportWechatQrcodeApi,\r\n  reportUrlLinkApi,\r\n} from \"@api/business-management-api\";\r\n\r\nconst AddSubCustomerDialog = defineAsyncComponent(\r\n  () =>\r\n    import(\r\n      \"@components/customer-management/personal-customer/list/add-sub-customer-dialog.vue\"\r\n    )\r\n);\r\n\r\n// const emits = defineEmits<{\r\n//   (\r\n//     e: \"emitFunc\",\r\n//     value: {\r\n//       type: \"list\" | \"report-electron\" | \"report-manual\";\r\n//       info?: Record<string, any>;\r\n//     }\r\n//   ): void;\r\n// }>();\r\nconst { bd_userInfo: userInfo, bd_virCompanyId: virCompanyId } =\r\n  LocalStorage.batchGetItem([\"bd_userInfo\", \"bd_virCompanyId\"]);\r\nconst ruleFormRef = ref();\r\nconst initData = reactive<Record<string, any>>({\r\n  visible: false,\r\n  addSubCustomerVisible: false,\r\n  step: 1,\r\n  type: \"\",\r\n  title: \"\",\r\n  companyName: \"\",\r\n  wechatQrCode: \"\",\r\n  companyList: [],\r\n});\r\nconst companyInfo = ref({\r\n  id: \"\",\r\n  companyId: \"\",\r\n  companyCode: \"\",\r\n  companyName: \"\",\r\n});\r\nconst formData = reactive({\r\n  companyId: \"\",\r\n});\r\nconst rules = {\r\n  companyId: [{ required: true, message: \"请选择公司\", trigger: \"blur\" }],\r\n};\r\n\r\n// 获取公司列表\r\nasync function getList(value?: string) {\r\n  if (!value) return;\r\n  const params = {\r\n    parentId: userInfo.profileId,\r\n    pageSize: 5000,\r\n    businessType: 0,\r\n    companyName: value ?? \"\",\r\n  };\r\n  const { data } = await allCustomerApi.getData(params);\r\n  initData.companyList = allCustomerApi.handleData(data).list;\r\n}\r\n\r\n// 返回选择公司\r\nfunction handleBackCompany() {\r\n  initData.step = 1;\r\n  initData.title = \"选择公司\";\r\n}\r\n\r\n// 添加子客户\r\nconst handleOperate = () => {\r\n  initData.addSubCustomerVisible = true;\r\n};\r\n\r\n// 新增业务报备时-确认选择公司（新增电子化）  source：报备来源 (1:直客报备H5 2:直客报备PC 3:子业务报备H5 4:子业务报备PC 5:销售代客户报备 6:代理商报备 7:代理商子公司报备)\r\nasync function handleQRCodeAdd(formEl: Record<string, any>) {\r\n  if (!formEl) return;\r\n  formEl.validate(async (valid, fields) => {\r\n    if (valid) {\r\n      initData.step = 2;\r\n      initData.title = \"扫码报备\";\r\n      const companyInfo: any = initData.companyList.find(\r\n        (item: Record<string, any>) => item.companyId === formData.companyId\r\n      );\r\n      initData.companyName = companyInfo?.companyName;\r\n      // const params: Record<string, any> = {\r\n      //   source: undefined,\r\n      //   companyName: companyInfo.companyName,\r\n      //   param: \"\",\r\n      // };\r\n      // if (companyInfo.businessType === 0) {\r\n      //   params.source = 5;\r\n      //   params.param = `profileId=${userInfo.profileId}&source=5&companyId=${companyInfo.companyId}&businessType=0&saleId=`;\r\n      // } else if (companyInfo.businessType === 1) {\r\n      //   params.source = 7;\r\n      //   params.param = `profileId=${userInfo.profileId}&source=7&companyId=${companyInfo.companyId}&companyCode=${companyInfo.companyCode}&agentId=${virCompanyId}&businessType=1`;\r\n      // }\r\n      // const { data } = await reportWechatQrcodeApi.getData(params);\r\n      // initData.wechatQrCode = data.qrCodeUrl;\r\n\r\n      const params = {\r\n        companyId: companyInfo.companyId,\r\n        param: `profileId=${userInfo.profileId}&source=1&companyId=${companyInfo.companyId}`,\r\n      };\r\n      const { data } = await reportUrlLinkApi.getData(params);\r\n      const url = `${data.urlLink}?${data.param}`;\r\n      const qrCodeEle = document.getElementById(\"qrCode\")!;\r\n      qrCodeEle.innerHTML = \"\";\r\n      if (url) {\r\n        useQRCode({\r\n          dom: qrCodeEle,\r\n          text: url,\r\n          width: 240,\r\n          height: 240,\r\n        });\r\n      } else {\r\n        qrCodeEle.innerHTML = \"加载失败\";\r\n      }\r\n    } else {\r\n      console.log(\"error submit!\", fields);\r\n    }\r\n  });\r\n}\r\n\r\n// 编辑业务报备时\r\nasync function handleQRCodeEdit() {\r\n  const params = {\r\n    source: 7,\r\n    companyName: companyInfo.value.companyName,\r\n    param: `profileId=${userInfo.profileId}&source=7&companyId=${companyInfo.value.companyId}&companyCode=${companyInfo.value.companyCode}&agentId=${virCompanyId}&reportId=${companyInfo.value.id}`,\r\n  };\r\n  const { data } = await reportWechatQrcodeApi.getData(params);\r\n  initData.wechatQrCode = data.qrCodeUrl;\r\n}\r\n\r\nfunction handleClose() {\r\n  initData.type = \"\";\r\n  companyInfo.value = {\r\n    id: \"\",\r\n    companyId: \"\",\r\n    companyCode: \"\",\r\n    companyName: \"\",\r\n  };\r\n  formData.companyId = \"\";\r\n  initData.step = 1;\r\n  initData.visible = false;\r\n}\r\n// 编辑业务报备（电子化）\r\nasync function handleOpen() {\r\n  if (initData.type === \"edit\") {\r\n    await handleQRCodeEdit();\r\n  }\r\n}\r\n// function handleManualReport() {\r\n//   emits(\"emitFunc\", {\r\n//     type: \"report-manual\",\r\n//     info: companyInfo.value,\r\n//   });\r\n// }\r\nfunction trigger(visible, data) {\r\n  initData.visible = visible;\r\n  initData.type = data.type;\r\n  if (visible) {\r\n    if (data.type === \"add\") {\r\n      getList();\r\n      initData.step = 1;\r\n      initData.title = \"选择公司\";\r\n    } else if (data.type === \"edit\") {\r\n      initData.step = 2;\r\n      initData.title = \"扫码报备\";\r\n      companyInfo.value = data.info;\r\n    }\r\n  }\r\n}\r\ndefineExpose({\r\n  trigger,\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.header-title {\r\n  @include flex(center);\r\n  color: #303133;\r\n  font-size: 18px;\r\n  line-height: 24px;\r\n  .el-icon {\r\n    cursor: pointer;\r\n    font-size: 19px;\r\n    margin-right: 5px;\r\n  }\r\n}\r\n.el-form {\r\n  min-height: 250px;\r\n\r\n  .el-select {\r\n    width: 312px;\r\n  }\r\n  .el-button {\r\n    margin-left: 6px;\r\n  }\r\n}\r\n.QRCode-content {\r\n  position: relative;\r\n  width: 240px;\r\n  height: 240px;\r\n  margin: 0 auto;\r\n  #qrCode {\r\n    @include flex(center);\r\n    width: 100%;\r\n    height: 100%;\r\n    font-size: 14px;\r\n    text-align: center;\r\n    line-height: 240px;\r\n    border: 1px solid #edf1f6;\r\n    //img {\r\n    //  display: block;\r\n    //  width: 100%;\r\n    //  height: 100%;\r\n    //  &[src=\"\"] {\r\n    //    display: none;\r\n    //  }\r\n    //}\r\n  }\r\n  .el-icon {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    display: none;\r\n    cursor: pointer;\r\n    font-size: 40px;\r\n    line-height: 250px;\r\n    text-align: center;\r\n    color: #ffffff;\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n  }\r\n  &:hover {\r\n    .el-icon {\r\n      display: block;\r\n    }\r\n  }\r\n}\r\n.prompt {\r\n  color: #606266;\r\n  font-size: 12px;\r\n  line-height: 20px;\r\n  text-align: center;\r\n  margin-top: 10px;\r\n  background-color: #ffffff;\r\n  span {\r\n    color: #0056ff;\r\n    cursor: pointer;\r\n  }\r\n}\r\n</style>\r\n","import script from \"./report-QRCode-dialog.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./report-QRCode-dialog.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./report-QRCode-dialog.vue?vue&type=style&index=0&id=4d900868&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_typescript@5.7.2__webpack@5.97.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4d900868\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","key","_defineComponent","__name","setup","__props","expose","__expose","AddSubCustomerDialog","defineAsyncComponent","bd_userInfo","userInfo","bd_virCompanyId","virCompanyId","LocalStorage","batchGetItem","ruleFormRef","ref","initData","reactive","visible","addSubCustomerVisible","step","type","title","companyName","wechatQrCode","companyList","companyInfo","id","companyId","companyCode","formData","rules","required","message","trigger","async","getList","value","params","parentId","profileId","pageSize","businessType","data","allCustomerApi","getData","handleData","list","handleBackCompany","handleOperate","handleQRCodeAdd","formEl","validate","valid","fields","find","item","param","reportUrlLinkApi","url","urlLink","qrCodeEle","document","getElementById","innerHTML","useQRCode","dom","text","width","height","console","log","handleQRCodeEdit","source","reportWechatQrcodeApi","qrCodeUrl","handleClose","handleOpen","info","_ctx","_cache","_component_el_icon","_resolveComponent","_component_el_option","_component_el_select","_component_el_button","_component_el_form_item","_component_el_form","_component_el_dialog","_openBlock","_createElementBlock","_Fragment","_createVNode","modelValue","$event","onOpen","onClosed","header","_withCtx","_createElementVNode","_createBlock","onClick","default","_unref","ArrowLeft","_","_createCommentVNode","_createTextVNode","_toDisplayString","footer","_withDirectives","ref_key","model","label","prop","placeholder","clearable","filterable","remote","_renderList","_vShow","RefreshRight","__exports__"],"sourceRoot":""}