{"version":3,"file":"static/js/5545.35f9a4d8.js","mappings":"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","sources":["webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-soft-seat.vue?efb9","webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-soft-seat.vue","webpack://daili/./src/components/order-management/create-order/product-detail/cloud-call-soft-seat.vue?5646"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createVNode as _createVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, unref as _unref, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"product-detail\" }\nconst _hoisted_2 = { class: \"service-specs\" }\nconst _hoisted_3 = { class: \"purchased-info\" }\nconst _hoisted_4 = { class: \"word\" }\n\nimport { computed, shallowReactive, shallowRef } from \"vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\n\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\n\r\nconst addedServiceCode = \"CALL_SOFT_SEAT\";\r\ntype InitData = {\r\n  seatNum: string | number;\r\n  seatCustomNum: number;\r\n  minSeatNum: number;\r\n  maxSeatNum: number;\r\n  seatList: Record<string, any>[];\r\n  curSpecsInfo: Record<string, any>;\r\n};\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'cloud-call-soft-seat',\n  props: {\n    productData: {},\n    purchasedData: {}\n  },\n  setup(__props: any) {\n\r\nconst props = __props;\r\n\r\nconst { routeQuery } = useVueRouter();\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n// 购买信息\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\nconsole.log(purchasedInfo);\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList.find(\r\n    (item) => item.addedServiceCode === addedServiceCode\r\n  );\r\n});\r\n// 周期\r\nconst diffMonth = computed(() => {\r\n  let result = 0;\r\n  if (purchasedInfo.value.endTime) {\r\n    const overTime = purchasedInfo.value.endTime;\r\n    const overDate = new Date(purchasedInfo.value.endTime).getDate();\r\n    const nowTime = dayjs().format(\"YYYY-MM-DD\");\r\n    const nowDate = new Date().getDate();\r\n    const plusNum = overDate === nowDate ? 0 : 1;\r\n    result = new BigNumber(dayjs(overTime).diff(nowTime, \"months\"))\r\n      .plus(plusNum)\r\n      .toNumber();\r\n  }\r\n  return result;\r\n});\r\n// 坐席数量\r\nconst seatCount = computed(() => {\r\n  return initData.seatNum === \"custom\"\r\n    ? initData.seatCustomNum\r\n    : initData.seatNum;\r\n});\r\n// 提示\r\nconst tipDesc = computed(() => {\r\n  if (productInfo.value?.canBuy) {\r\n    return `合计： 坐席单价${agentInfo.value.unitPrice}元 x\r\n${seatCount.value}个坐席 x 剩余${diffMonth.value}个月 = ${agentInfo.value.sumPrice}元`;\r\n  } else {\r\n    return \"\";\r\n  }\r\n});\r\n\r\nconst initData = shallowReactive<InitData>({\r\n  seatNum: \"\", // 坐席数量\r\n  seatCustomNum: 0, // 坐席数量\r\n  minSeatNum: 1, // 最小坐席数量\r\n  maxSeatNum: 10000000, // 最大坐席数量\r\n  seatList: [], // 坐席数量列表\r\n  curSpecsInfo: {}, // 选择当前规格\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  subMarketList: [],\r\n});\r\n// 初始化信息\r\nhandleSeatList();\r\n\r\n// 获取seat坐席列表\r\nfunction handleSeatList() {\r\n  const specsList = addedServiceInfo.value.specsList ?? [];\r\n  initData.seatNum = Number(specsList[0].groupValues);\r\n  initData.seatCustomNum = specsList[0].minNum;\r\n  initData.minSeatNum = specsList[0].minNum;\r\n  initData.maxSeatNum = specsList[0].maxNum;\r\n  initData.seatList = specsList.map((item) => {\r\n    if (initData.minSeatNum > item.minNum) initData.minSeatNum = item.minNum;\r\n    if (initData.maxSeatNum < item.maxNum) initData.maxSeatNum = item.maxNum;\r\n    return {\r\n      label: `${item.groupValues}个`,\r\n      value: Number(item.groupValues),\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n      coding: item.coding,\r\n      serviceCode: item.serviceCode,\r\n      groupCodeList: item.groupCodes.split(\",\"),\r\n      groupValueList: item.groupValues.split(\",\"),\r\n    };\r\n  });\r\n  if (addedServiceInfo.value?.isDiy) {\r\n    initData.seatList.push({ label: \"自定义\", value: \"custom\" });\r\n  }\r\n  initData.curSpecsInfo = initData.seatList[0];\r\n  getPrice();\r\n}\r\n\r\n// 坐席数量\r\nfunction handleSeatCount(value) {\r\n  let count = value;\r\n  if (value === \"custom\") count = initData.seatCustomNum;\r\n  initData.curSpecsInfo = initData.seatList.find((item) => {\r\n    return item.minNum <= count && count <= item.maxNum;\r\n  }) as any;\r\n  getPrice();\r\n}\r\n\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const params = {\r\n    helpOrder: 1,\r\n    agentId: userInfo.profileId,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\",\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"2\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: purchasedInfo.value.dateValue, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: seatCount.value,\r\n        coding: [\r\n          {\r\n            code: initData.curSpecsInfo.serviceCode,\r\n            coding: initData.curSpecsInfo.coding,\r\n            num: seatCount.value,\r\n          },\r\n        ],\r\n        baseCodeList: initData.curSpecsInfo.groupCodeList.map((item, index) => {\r\n          return {\r\n            baseCode: item,\r\n            number: initData.curSpecsInfo.groupValueList[index],\r\n          };\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `坐席数量：${seatCount.value}个；合作时间：${diffMonth.value}个月；坐席单价：${agentInfo.value.unitPrice}元；`,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"1\") {\r\n              item.specsInfo = `${diffMonth.value}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_el_form_item = _resolveComponent(\"el-form-item\")!\n  const _component_el_option = _resolveComponent(\"el-option\")!\n  const _component_el_select = _resolveComponent(\"el-select\")!\n  const _component_el_input_number = _resolveComponent(\"el-input-number\")!\n  const _component_el_form = _resolveComponent(\"el-form\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createVNode(BaseServiceInfo, { serviceData: serviceInfo.value }, null, 8, [\"serviceData\"]),\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createVNode(_component_el_form, { \"label-width\": \"150px\" }, {\n        default: _withCtx(() => [\n          (productInfo.value?.canBuy)\n            ? (_openBlock(), _createBlock(_component_el_form_item, {\n                key: 0,\n                label: \"已购详情\"\n              }, {\n                default: _withCtx(() => [\n                  _createElementVNode(\"div\", _hoisted_3, [\n                    _createElementVNode(\"span\", null, \" 已购坐席数：\" + _toDisplayString(purchasedInfo.value.resourceCount) + _toDisplayString(serviceInfo.value.unit), 1),\n                    _createElementVNode(\"span\", null, \"服务到期时间：\" + _toDisplayString(purchasedInfo.value.endTime), 1)\n                  ])\n                ]),\n                _: 1\n              }))\n            : _createCommentVNode(\"\", true),\n          _createVNode(_component_el_form_item, {\n            label: \"购买坐席数\",\n            class: \"amount-form-item\"\n          }, {\n            default: _withCtx(() => [\n              _createVNode(_component_el_select, {\n                modelValue: _unref(initData).seatNum,\n                \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event: any) => ((_unref(initData).seatNum) = $event)),\n                onChange: handleSeatCount\n              }, {\n                default: _withCtx(() => [\n                  (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(initData).seatList, (item) => {\n                    return (_openBlock(), _createBlock(_component_el_option, {\n                      key: item.value,\n                      label: item.label,\n                      value: item.value\n                    }, null, 8, [\"label\", \"value\"]))\n                  }), 128))\n                ]),\n                _: 1\n              }, 8, [\"modelValue\"]),\n              (_unref(initData).seatNum === 'custom')\n                ? (_openBlock(), _createBlock(_component_el_input_number, {\n                    key: 0,\n                    modelValue: _unref(initData).seatCustomNum,\n                    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event: any) => ((_unref(initData).seatCustomNum) = $event)),\n                    min: _unref(initData).minSeatNum,\n                    max: _unref(initData).maxSeatNum,\n                    step: addedServiceInfo.value.miniNum,\n                    onChange: handleSeatCount\n                  }, null, 8, [\"modelValue\", \"min\", \"max\", \"step\"]))\n                : _createCommentVNode(\"\", true)\n            ]),\n            _: 1\n          }),\n          _createVNode(_component_el_form_item, null, {\n            default: _withCtx(() => [\n              _createElementVNode(\"p\", _hoisted_4, _toDisplayString(tipDesc.value), 1)\n            ]),\n            _: 1\n          })\n        ]),\n        _: 1\n      }),\n      _createVNode(BaseSumPrice, {\n        onEmitFunc: handleBuy,\n        \"buy-price\": agentInfo.value.sumPrice,\n        \"can-buy\": productInfo.value?.canBuy,\n        hasAgentPrice: agentInfo.value.hasAgentPrice,\n        tip: \"购买此产品前，需要先买鱼鹰呼叫软件\"\n      }, null, 8, [\"buy-price\", \"can-buy\", \"hasAgentPrice\"])\n    ])\n  ]))\n}\n}\n\n})","<template>\r\n  <div class=\"product-detail\">\r\n    <BaseServiceInfo :serviceData=\"serviceInfo\"></BaseServiceInfo>\r\n    <div class=\"service-specs\">\r\n      <el-form label-width=\"150px\">\r\n        <template v-if=\"productInfo?.canBuy\">\r\n          <el-form-item label=\"已购详情\">\r\n            <div class=\"purchased-info\">\r\n              <span>\r\n                已购坐席数：{{ purchasedInfo.resourceCount\r\n                }}{{ serviceInfo.unit }}\r\n              </span>\r\n              <span>服务到期时间：{{ purchasedInfo.endTime }}</span>\r\n            </div>\r\n          </el-form-item>\r\n        </template>\r\n        <el-form-item label=\"购买坐席数\" class=\"amount-form-item\">\r\n          <el-select v-model=\"initData.seatNum\" @change=\"handleSeatCount\">\r\n            <el-option\r\n              v-for=\"item in initData.seatList\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            />\r\n          </el-select>\r\n          <el-input-number\r\n            v-if=\"initData.seatNum === 'custom'\"\r\n            v-model=\"initData.seatCustomNum\"\r\n            :min=\"initData.minSeatNum\"\r\n            :max=\"initData.maxSeatNum\"\r\n            :step=\"addedServiceInfo.miniNum\"\r\n            @change=\"handleSeatCount\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p class=\"word\">{{ tipDesc }}</p>\r\n        </el-form-item>\r\n      </el-form>\r\n      <BaseSumPrice\r\n        @emitFunc=\"handleBuy\"\r\n        :buy-price=\"agentInfo.sumPrice\"\r\n        :can-buy=\"productInfo?.canBuy\"\r\n        :hasAgentPrice=\"agentInfo.hasAgentPrice\"\r\n        tip=\"购买此产品前，需要先买鱼鹰呼叫软件\"\r\n      ></BaseSumPrice>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { computed, shallowReactive, shallowRef } from \"vue\";\r\n\r\nimport { useVueRouter } from \"@assets/useHook\";\r\nimport { LocalStorage } from \"jz-tool-lib\";\r\nimport { createdOrder, handlePrice } from \"./common\";\r\n\r\nimport BaseSumPrice from \"./base-sum-price.vue\";\r\nimport BaseServiceInfo from \"./base-service-info.vue\";\r\n\r\nconst props = defineProps<{\r\n  productData: Record<string, any>;\r\n  purchasedData: Record<string, any>[];\r\n}>();\r\n\r\nconst { routeQuery } = useVueRouter();\r\nconst addedServiceCode = \"CALL_SOFT_SEAT\";\r\nconst { bd_userInfo: userInfo } = LocalStorage.batchGetItem([\"bd_userInfo\"]);\r\n// 购买信息\r\nconst purchasedInfo: Record<string, any> = computed(() => {\r\n  return props.purchasedData;\r\n});\r\nconsole.log(purchasedInfo);\r\n// 所有信息\r\nconst productInfo: Record<string, any> = computed(() => {\r\n  return props.productData;\r\n});\r\n// 服务基本信息\r\nconst serviceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value.serviceInfo;\r\n});\r\n// 增值服务信息\r\nconst addedServiceInfo: Record<string, any> = computed(() => {\r\n  return productInfo.value?.addedServiceList.find(\r\n    (item) => item.addedServiceCode === addedServiceCode\r\n  );\r\n});\r\n// 周期\r\nconst diffMonth = computed(() => {\r\n  let result = 0;\r\n  if (purchasedInfo.value.endTime) {\r\n    const overTime = purchasedInfo.value.endTime;\r\n    const overDate = new Date(purchasedInfo.value.endTime).getDate();\r\n    const nowTime = dayjs().format(\"YYYY-MM-DD\");\r\n    const nowDate = new Date().getDate();\r\n    const plusNum = overDate === nowDate ? 0 : 1;\r\n    result = new BigNumber(dayjs(overTime).diff(nowTime, \"months\"))\r\n      .plus(plusNum)\r\n      .toNumber();\r\n  }\r\n  return result;\r\n});\r\n// 坐席数量\r\nconst seatCount = computed(() => {\r\n  return initData.seatNum === \"custom\"\r\n    ? initData.seatCustomNum\r\n    : initData.seatNum;\r\n});\r\n// 提示\r\nconst tipDesc = computed(() => {\r\n  if (productInfo.value?.canBuy) {\r\n    return `合计： 坐席单价${agentInfo.value.unitPrice}元 x\r\n${seatCount.value}个坐席 x 剩余${diffMonth.value}个月 = ${agentInfo.value.sumPrice}元`;\r\n  } else {\r\n    return \"\";\r\n  }\r\n});\r\n\r\ntype InitData = {\r\n  seatNum: string | number;\r\n  seatCustomNum: number;\r\n  minSeatNum: number;\r\n  maxSeatNum: number;\r\n  seatList: Record<string, any>[];\r\n  curSpecsInfo: Record<string, any>;\r\n};\r\nconst initData = shallowReactive<InitData>({\r\n  seatNum: \"\", // 坐席数量\r\n  seatCustomNum: 0, // 坐席数量\r\n  minSeatNum: 1, // 最小坐席数量\r\n  maxSeatNum: 10000000, // 最大坐席数量\r\n  seatList: [], // 坐席数量列表\r\n  curSpecsInfo: {}, // 选择当前规格\r\n});\r\n// 购买的商品价格信息\r\nconst agentInfo = shallowRef({\r\n  price: \"0.00\",\r\n  sumPrice: \"0.00\",\r\n  addedPrice: \"0.00\",\r\n  unitPrice: \"0.00\",\r\n  subMarketList: [],\r\n});\r\n// 初始化信息\r\nhandleSeatList();\r\n\r\n// 获取seat坐席列表\r\nfunction handleSeatList() {\r\n  const specsList = addedServiceInfo.value.specsList ?? [];\r\n  initData.seatNum = Number(specsList[0].groupValues);\r\n  initData.seatCustomNum = specsList[0].minNum;\r\n  initData.minSeatNum = specsList[0].minNum;\r\n  initData.maxSeatNum = specsList[0].maxNum;\r\n  initData.seatList = specsList.map((item) => {\r\n    if (initData.minSeatNum > item.minNum) initData.minSeatNum = item.minNum;\r\n    if (initData.maxSeatNum < item.maxNum) initData.maxSeatNum = item.maxNum;\r\n    return {\r\n      label: `${item.groupValues}个`,\r\n      value: Number(item.groupValues),\r\n      minNum: item.minNum,\r\n      maxNum: item.maxNum,\r\n      coding: item.coding,\r\n      serviceCode: item.serviceCode,\r\n      groupCodeList: item.groupCodes.split(\",\"),\r\n      groupValueList: item.groupValues.split(\",\"),\r\n    };\r\n  });\r\n  if (addedServiceInfo.value?.isDiy) {\r\n    initData.seatList.push({ label: \"自定义\", value: \"custom\" });\r\n  }\r\n  initData.curSpecsInfo = initData.seatList[0];\r\n  getPrice();\r\n}\r\n\r\n// 坐席数量\r\nfunction handleSeatCount(value) {\r\n  let count = value;\r\n  if (value === \"custom\") count = initData.seatCustomNum;\r\n  initData.curSpecsInfo = initData.seatList.find((item) => {\r\n    return item.minNum <= count && count <= item.maxNum;\r\n  }) as any;\r\n  getPrice();\r\n}\r\n\r\n// 获取价格参数\r\nfunction handleParams() {\r\n  const params = {\r\n    helpOrder: 1,\r\n    agentId: userInfo.profileId,\r\n    companyId: routeQuery.value.companyId, // 代理商子公司id\r\n    profileId: routeQuery.value.profileId, // 代理商子公司操作人id\r\n    buyType: \"BUY_SERVER\",\r\n    shopBuyList: [\r\n      {\r\n        agentId: userInfo.profileId,\r\n        isisTry: false, // 是否试用\r\n        dateType: \"2\", // 时间单位 1:日, 2:月, 3:年\r\n        dateValue: purchasedInfo.value.dateValue, // 时长\r\n        marketCode: routeQuery.value.serviceCode,\r\n        userNumber: seatCount.value,\r\n        coding: [\r\n          {\r\n            code: initData.curSpecsInfo.serviceCode,\r\n            coding: initData.curSpecsInfo.coding,\r\n            num: seatCount.value,\r\n          },\r\n        ],\r\n        baseCodeList: initData.curSpecsInfo.groupCodeList.map((item, index) => {\r\n          return {\r\n            baseCode: item,\r\n            number: initData.curSpecsInfo.groupValueList[index],\r\n          };\r\n        }),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  const commodityInfo = {\r\n    list: [\r\n      {\r\n        ...serviceInfo.value,\r\n        price: agentInfo.value.price,\r\n        specsInfo: `坐席数量：${seatCount.value}个；合作时间：${diffMonth.value}个月；坐席单价：${agentInfo.value.unitPrice}元；`,\r\n        augmentedServiceList: agentInfo.value?.subMarketList.map(\r\n          (item: Record<string, any>) => {\r\n            if (item.calculateType === \"1\") {\r\n              item.specsInfo = `${diffMonth.value}个月`;\r\n            }\r\n            return item;\r\n          }\r\n        ),\r\n      },\r\n    ],\r\n    sumPrice: agentInfo.value.sumPrice,\r\n  };\r\n  return {\r\n    params,\r\n    commodityInfo,\r\n  };\r\n}\r\n\r\n// 计算价格\r\nasync function getPrice() {\r\n  const params = handleParams().params;\r\n  agentInfo.value = await handlePrice(params);\r\n}\r\n\r\n// 购买\r\nfunction handleBuy() {\r\n  createdOrder(handleParams());\r\n}\r\n</script>\r\n","import script from \"./cloud-call-soft-seat.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./cloud-call-soft-seat.vue?vue&type=script&setup=true&lang=ts\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","addedServiceCode","_defineComponent","__name","props","productData","purchasedData","setup","__props","routeQuery","useVueRouter","bd_userInfo","userInfo","LocalStorage","batchGetItem","purchasedInfo","computed","console","log","productInfo","serviceInfo","value","addedServiceInfo","_productInfo$value","addedServiceList","find","item","diffMonth","result","endTime","overTime","overDate","Date","getDate","nowTime","dayjs","format","nowDate","plusNum","BigNumber","diff","plus","toNumber","seatCount","initData","seatNum","seatCustomNum","tipDesc","_productInfo$value2","canBuy","agentInfo","unitPrice","sumPrice","shallowReactive","minSeatNum","maxSeatNum","seatList","curSpecsInfo","shallowRef","price","addedPrice","subMarketList","handleSeatList","_addedServiceInfo$val","specsList","Number","groupValues","minNum","maxNum","map","label","coding","serviceCode","groupCodeList","groupCodes","split","groupValueList","isDiy","push","getPrice","handleSeatCount","count","handleParams","_agentInfo$value","params","helpOrder","agentId","profileId","companyId","buyType","shopBuyList","isisTry","dateType","dateValue","marketCode","userNumber","code","num","baseCodeList","index","baseCode","number","commodityInfo","list","specsInfo","augmentedServiceList","calculateType","async","handlePrice","handleBuy","createdOrder","_ctx","_cache","_productInfo$value4","_component_el_form_item","_resolveComponent","_component_el_option","_component_el_select","_component_el_input_number","_component_el_form","_openBlock","_createElementBlock","_createVNode","BaseServiceInfo","serviceData","_createElementVNode","default","_withCtx","_productInfo$value3","_createBlock","key","_toDisplayString","resourceCount","unit","_","_createCommentVNode","modelValue","_unref","$event","onChange","_Fragment","_renderList","min","max","step","miniNum","BaseSumPrice","onEmitFunc","hasAgentPrice","tip","__exports__"],"sourceRoot":""}