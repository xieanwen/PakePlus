{"version":3,"file":"static/js/4076.c2180560.js","mappings":"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","sources":["webpack://daili/./src/components/business-management/ospreyCloudCall/report/detail/empower-info.vue?54f5","webpack://daili/./src/components/business-management/ospreyCloudCall/report/detail/empower-info.vue","webpack://daili/./src/components/business-management/ospreyCloudCall/report/detail/empower-info.vue?1698"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeStyle as _normalizeStyle, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, resolveComponent as _resolveComponent, createVNode as _createVNode } from \"vue\"\n\nconst _hoisted_1 = { class: \"empower-info\" }\nconst _hoisted_2 = [\"onClick\"]\nconst _hoisted_3 = [\"src\"]\nconst _hoisted_4 = { class: \"carousel-arrow\" }\n\nimport { ref, reactive } from \"vue\";\r\nimport { ElMessage } from \"element-plus\";\r\nimport * as pdfJs from \"pdfjs-dist/build/pdf\";\r\nimport pdfJsWorker from \"pdfjs-dist/build/pdf.worker.js\";\r\nimport { getFileFromUrl } from \"@/assets/common\";\r\nimport { downloadFile } from \"@api/download-api\";\r\n\r\n\nexport default /*@__PURE__*/_defineComponent({\n  __name: 'empower-info',\n  props: {\n    empowerPromiseLink: {}\n  },\n  emits: [\"emitFunc\"],\n  setup(__props: any, { emit: __emit }) {\n\r\npdfJs.GlobalWorkerOptions.workerSrc = pdfJsWorker;\r\nconst props = __props;\r\nconst emits = __emit;\r\nconst previewImageRef = ref();\r\nconst carouselListRef = ref();\r\nconst carouselContainerRef = ref();\r\nconst carouselData = reactive({\r\n  list: [],\r\n  isDown: false, // 是否按下鼠标\r\n  startX: 0, // 鼠标起始位置\r\n  scrollLeft: 0, // 滚动条位置\r\n});\r\nconst carouselStyle = {\r\n  itemWidth: 230,\r\n  itemHeight: 327,\r\n  viewCount: 4,\r\n  spacingWidth: 30,\r\n  containerWidth: 0,\r\n};\r\ncarouselStyle.containerWidth =\r\n  (carouselStyle.itemWidth + carouselStyle.spacingWidth) *\r\n  carouselStyle.viewCount;\r\n\r\n// 查看授权承诺书\r\nfunction previewEmpowerPromise() {\r\n  const url = props.empowerPromiseLink;\r\n  if (!url) {\r\n    ElMessage.warning(\"查看链接不能为空\");\r\n    return;\r\n  }\r\n  window.open(props.empowerPromiseLink, \"_blank\");\r\n}\r\n// 下载授权承诺书\r\nfunction downEmpowerPromise() {\r\n  const url = props.empowerPromiseLink;\r\n  if (!url) {\r\n    ElMessage.warning(\"下载链接不能为空\");\r\n    return;\r\n  }\r\n  getFileFromUrl(url, \"授权承诺书\", \"application/pdf\").then((data: any) => {\r\n    downloadFile({\r\n      api: URL.createObjectURL(data.blob),\r\n      filename: \"授权承诺书\",\r\n    });\r\n  });\r\n}\r\n// 直接使用链接\r\nfunction linkPdfLinkChange() {\r\n  const url = props.empowerPromiseLink;\r\n  if (!url) return;\r\n  getFileFromUrl(url, \"授权承诺书\", \"application/pdf\").then((data: any) => {\r\n    convertPdfToImage(URL.createObjectURL(data.file)).then((result) => {\r\n      (carouselData.list as any[]) = result;\r\n    });\r\n  });\r\n}\r\n// 文件流转pdf\r\nasync function convertPdfToImage(pdfUrl) {\r\n  const pdf = await pdfJs.getDocument(pdfUrl).promise;\r\n  const canvas = document.createElement(\"canvas\");\r\n  const context = canvas.getContext(\"2d\");\r\n  const imgList: any[] = [];\r\n  // 循环遍历每一页pdf，将其转成图片\r\n  for (let i = 1; i <= pdf._pdfInfo.numPages; i++) {\r\n    // 获取pdf页\r\n    const page = await pdf.getPage(i);\r\n    // 获取页的尺寸\r\n    const viewport = page.getViewport({ scale: 1 });\r\n    // 设置canvas的尺寸\r\n    canvas.width = viewport.width;\r\n    canvas.height = viewport.height;\r\n    // 将pdf页渲染到canvas上\r\n    await page.render({ canvasContext: context, viewport: viewport }).promise;\r\n    const imgSrc = canvas.toDataURL(\"image/png\");\r\n    imgList.push(imgSrc);\r\n  }\r\n  return imgList;\r\n}\r\n\r\n// 箭头向左\r\nconst handleArrowLeft = () => {\r\n  const carouselListWidth = carouselListRef.value.clientWidth;\r\n  const carouselListScrollLeft = carouselListRef.value.scrollLeft;\r\n  const itemClientWidth = carouselStyle.itemWidth + carouselStyle.spacingWidth;\r\n  const nextScrollLeft = carouselListScrollLeft - carouselListWidth;\r\n  if (nextScrollLeft >= 0) {\r\n    const remainder = carouselListScrollLeft % itemClientWidth;\r\n    const divisible = Math.floor(carouselListScrollLeft / itemClientWidth);\r\n    const count = remainder === 0 ? divisible - 1 : divisible;\r\n    carouselListRef.value.scrollTo({\r\n      left: count * itemClientWidth,\r\n      behavior: \"smooth\",\r\n    });\r\n  } else {\r\n    carouselListRef.value.scrollTo({\r\n      left: 0,\r\n      behavior: \"smooth\",\r\n    });\r\n  }\r\n};\r\n// 箭头向右\r\nconst handleArrowRight = () => {\r\n  const carouselListWidth = carouselListRef.value.clientWidth;\r\n  const carouselListScrollLeft = carouselListRef.value.scrollLeft;\r\n  const itemClientWidth = carouselStyle.itemWidth + carouselStyle.spacingWidth;\r\n  const maxScrollLeft = carouselListRef.value.scrollWidth - carouselListWidth;\r\n  const nextScrollLeft = carouselListScrollLeft + carouselListWidth;\r\n  if (nextScrollLeft <= maxScrollLeft) {\r\n    const remainder = carouselListScrollLeft % itemClientWidth;\r\n    const divisible = Math.ceil(carouselListScrollLeft / itemClientWidth);\r\n    const count = remainder === 0 ? divisible + 1 : divisible;\r\n    carouselListRef.value.scrollTo({\r\n      left: count * itemClientWidth,\r\n      behavior: \"smooth\",\r\n    });\r\n  } else {\r\n    carouselListRef.value.scrollTo({\r\n      left: maxScrollLeft,\r\n      behavior: \"smooth\",\r\n    });\r\n  }\r\n};\r\n// 鼠标按下\r\nfunction handleMousedown(e) {\r\n  carouselData.isDown = true;\r\n  carouselData.startX = e.pageX - carouselListRef.value.offsetLeft;\r\n  carouselData.scrollLeft = carouselListRef.value.scrollLeft;\r\n}\r\n// 鼠标收起\r\nfunction handleMouseup() {\r\n  carouselData.isDown = false;\r\n}\r\n// 鼠标移动\r\nfunction handleMousemove(e) {\r\n  if (!carouselData.isDown) return;\r\n  e.preventDefault();\r\n  const x = e.pageX - carouselListRef.value.offsetLeft; // 获取鼠标滑动时位置\r\n  const walk = x - carouselData.startX; // 滑动距离：鼠标滑动时位置-起始位置\r\n  carouselListRef.value.scrollLeft = carouselData.scrollLeft - walk;\r\n  carouselData.scrollLeft = carouselData.scrollLeft - walk;\r\n  requestAnimationFrame(() => {\r\n    carouselListRef.value.scrollLeft = carouselData.scrollLeft;\r\n  });\r\n}\r\n// 图片预览\r\nfunction previewImage(title: string, imgList: string[], index: number) {\r\n  emits(\"emitFunc\", {\r\n    title,\r\n    imgList,\r\n    index,\r\n  });\r\n}\r\nconst empowerTimer = setInterval(function () {\r\n  if (props.empowerPromiseLink) {\r\n    clearInterval(empowerTimer);\r\n    linkPdfLinkChange();\r\n  }\r\n}, 2000);\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_CustomPreviewImage = _resolveComponent(\"CustomPreviewImage\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createElementVNode(\"h5\", { class: \"title\" }, [\n      _cache[0] || (_cache[0] = _createElementVNode(\"div\", { class: \"counter-mark\" }, [\n        _createTextVNode(\" 3. 授权承诺书\"),\n        _createElementVNode(\"span\", null, \"契约锁电子签章\"),\n        _createElementVNode(\"span\", null, \"存证报告\"),\n        _createElementVNode(\"span\", null, \"CA认证\")\n      ], -1)),\n      _createElementVNode(\"div\", { class: \"button-group\" }, [\n        _createElementVNode(\"span\", { onClick: previewEmpowerPromise }, \"查看全部\"),\n        _createElementVNode(\"span\", { onClick: downEmpowerPromise }, \"下载全部\")\n      ])\n    ]),\n    _createElementVNode(\"div\", {\n      ref_key: \"carouselContainerRef\",\n      ref: carouselContainerRef,\n      class: _normalizeClass([\r\n        'carousel-container',\r\n        carouselData.list.length < carouselStyle.viewCount\r\n          ? 'carousel-center'\r\n          : '',\r\n      ]),\n      style: _normalizeStyle({ width: `${carouselStyle.containerWidth}px` })\n    }, [\n      _createElementVNode(\"div\", {\n        ref_key: \"carouselListRef\",\n        ref: carouselListRef,\n        class: \"carousel-list\",\n        onMousedown: handleMousedown,\n        onMouseup: handleMouseup,\n        onMousemove: handleMousemove\n      }, [\n        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(carouselData.list, (item, index) => {\n          return (_openBlock(), _createElementBlock(\"div\", {\n            class: \"carousel-item\",\n            onClick: ($event: any) => (previewImage('授权承诺书', carouselData.list, index)),\n            style: _normalizeStyle({\r\n            width: `${carouselStyle.itemWidth}px`,\r\n            height: `${carouselStyle.itemHeight}px`,\r\n            marginLeft: `${carouselStyle.spacingWidth}px`,\r\n          }),\n            key: index\n          }, [\n            _createElementVNode(\"img\", {\n              src: item,\n              alt: \"\"\n            }, null, 8, _hoisted_3)\n          ], 12, _hoisted_2))\n        }), 128))\n      ], 544),\n      _createElementVNode(\"div\", _hoisted_4, [\n        _createElementVNode(\"span\", {\n          class: \"arrow-left\",\n          onClick: handleArrowLeft\n        }),\n        _createElementVNode(\"span\", null, _toDisplayString(carouselData.list.length), 1),\n        _createElementVNode(\"span\", {\n          class: \"arrow-right\",\n          onClick: handleArrowRight\n        })\n      ])\n    ], 6),\n    _createVNode(_component_CustomPreviewImage, {\n      ref_key: \"previewImageRef\",\n      ref: previewImageRef\n    }, null, 512)\n  ]))\n}\n}\n\n})","<template>\r\n  <div class=\"empower-info\">\r\n    <h5 class=\"title\">\r\n      <div class=\"counter-mark\">\r\n        3. 授权承诺书<span>契约锁电子签章</span><span>存证报告</span\r\n        ><span>CA认证</span>\r\n      </div>\r\n      <div class=\"button-group\">\r\n        <span @click=\"previewEmpowerPromise\">查看全部</span>\r\n        <span @click=\"downEmpowerPromise\">下载全部</span>\r\n      </div>\r\n    </h5>\r\n    <div\r\n      ref=\"carouselContainerRef\"\r\n      :class=\"[\r\n        'carousel-container',\r\n        carouselData.list.length < carouselStyle.viewCount\r\n          ? 'carousel-center'\r\n          : '',\r\n      ]\"\r\n      :style=\"{ width: `${carouselStyle.containerWidth}px` }\"\r\n    >\r\n      <div\r\n        ref=\"carouselListRef\"\r\n        class=\"carousel-list\"\r\n        @mousedown=\"handleMousedown\"\r\n        @mouseup=\"handleMouseup\"\r\n        @mousemove=\"handleMousemove\"\r\n      >\r\n        <div\r\n          class=\"carousel-item\"\r\n          @click=\"previewImage('授权承诺书', carouselData.list, index)\"\r\n          :style=\"{\r\n            width: `${carouselStyle.itemWidth}px`,\r\n            height: `${carouselStyle.itemHeight}px`,\r\n            marginLeft: `${carouselStyle.spacingWidth}px`,\r\n          }\"\r\n          v-for=\"(item, index) in carouselData.list\"\r\n          :key=\"index\"\r\n        >\r\n          <img :src=\"item\" alt=\"\" />\r\n        </div>\r\n      </div>\r\n      <div class=\"carousel-arrow\">\r\n        <span class=\"arrow-left\" @click=\"handleArrowLeft\"></span>\r\n        <span>{{ carouselData.list.length }}</span>\r\n        <span class=\"arrow-right\" @click=\"handleArrowRight\"></span>\r\n      </div>\r\n    </div>\r\n    <CustomPreviewImage ref=\"previewImageRef\"></CustomPreviewImage>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive } from \"vue\";\r\nimport { ElMessage } from \"element-plus\";\r\nimport * as pdfJs from \"pdfjs-dist/build/pdf\";\r\nimport pdfJsWorker from \"pdfjs-dist/build/pdf.worker.js\";\r\nimport { getFileFromUrl } from \"@/assets/common\";\r\nimport { downloadFile } from \"@api/download-api\";\r\n\r\npdfJs.GlobalWorkerOptions.workerSrc = pdfJsWorker;\r\nconst props = defineProps<{\r\n  empowerPromiseLink: string;\r\n}>();\r\nconst emits = defineEmits<{\r\n  (e: \"emitFunc\", value: { title: string; imgList: string[]; index: number });\r\n}>();\r\nconst previewImageRef = ref();\r\nconst carouselListRef = ref();\r\nconst carouselContainerRef = ref();\r\nconst carouselData = reactive({\r\n  list: [],\r\n  isDown: false, // 是否按下鼠标\r\n  startX: 0, // 鼠标起始位置\r\n  scrollLeft: 0, // 滚动条位置\r\n});\r\nconst carouselStyle = {\r\n  itemWidth: 230,\r\n  itemHeight: 327,\r\n  viewCount: 4,\r\n  spacingWidth: 30,\r\n  containerWidth: 0,\r\n};\r\ncarouselStyle.containerWidth =\r\n  (carouselStyle.itemWidth + carouselStyle.spacingWidth) *\r\n  carouselStyle.viewCount;\r\n\r\n// 查看授权承诺书\r\nfunction previewEmpowerPromise() {\r\n  const url = props.empowerPromiseLink;\r\n  if (!url) {\r\n    ElMessage.warning(\"查看链接不能为空\");\r\n    return;\r\n  }\r\n  window.open(props.empowerPromiseLink, \"_blank\");\r\n}\r\n// 下载授权承诺书\r\nfunction downEmpowerPromise() {\r\n  const url = props.empowerPromiseLink;\r\n  if (!url) {\r\n    ElMessage.warning(\"下载链接不能为空\");\r\n    return;\r\n  }\r\n  getFileFromUrl(url, \"授权承诺书\", \"application/pdf\").then((data: any) => {\r\n    downloadFile({\r\n      api: URL.createObjectURL(data.blob),\r\n      filename: \"授权承诺书\",\r\n    });\r\n  });\r\n}\r\n// 直接使用链接\r\nfunction linkPdfLinkChange() {\r\n  const url = props.empowerPromiseLink;\r\n  if (!url) return;\r\n  getFileFromUrl(url, \"授权承诺书\", \"application/pdf\").then((data: any) => {\r\n    convertPdfToImage(URL.createObjectURL(data.file)).then((result) => {\r\n      (carouselData.list as any[]) = result;\r\n    });\r\n  });\r\n}\r\n// 文件流转pdf\r\nasync function convertPdfToImage(pdfUrl) {\r\n  const pdf = await pdfJs.getDocument(pdfUrl).promise;\r\n  const canvas = document.createElement(\"canvas\");\r\n  const context = canvas.getContext(\"2d\");\r\n  const imgList: any[] = [];\r\n  // 循环遍历每一页pdf，将其转成图片\r\n  for (let i = 1; i <= pdf._pdfInfo.numPages; i++) {\r\n    // 获取pdf页\r\n    const page = await pdf.getPage(i);\r\n    // 获取页的尺寸\r\n    const viewport = page.getViewport({ scale: 1 });\r\n    // 设置canvas的尺寸\r\n    canvas.width = viewport.width;\r\n    canvas.height = viewport.height;\r\n    // 将pdf页渲染到canvas上\r\n    await page.render({ canvasContext: context, viewport: viewport }).promise;\r\n    const imgSrc = canvas.toDataURL(\"image/png\");\r\n    imgList.push(imgSrc);\r\n  }\r\n  return imgList;\r\n}\r\n\r\n// 箭头向左\r\nconst handleArrowLeft = () => {\r\n  const carouselListWidth = carouselListRef.value.clientWidth;\r\n  const carouselListScrollLeft = carouselListRef.value.scrollLeft;\r\n  const itemClientWidth = carouselStyle.itemWidth + carouselStyle.spacingWidth;\r\n  const nextScrollLeft = carouselListScrollLeft - carouselListWidth;\r\n  if (nextScrollLeft >= 0) {\r\n    const remainder = carouselListScrollLeft % itemClientWidth;\r\n    const divisible = Math.floor(carouselListScrollLeft / itemClientWidth);\r\n    const count = remainder === 0 ? divisible - 1 : divisible;\r\n    carouselListRef.value.scrollTo({\r\n      left: count * itemClientWidth,\r\n      behavior: \"smooth\",\r\n    });\r\n  } else {\r\n    carouselListRef.value.scrollTo({\r\n      left: 0,\r\n      behavior: \"smooth\",\r\n    });\r\n  }\r\n};\r\n// 箭头向右\r\nconst handleArrowRight = () => {\r\n  const carouselListWidth = carouselListRef.value.clientWidth;\r\n  const carouselListScrollLeft = carouselListRef.value.scrollLeft;\r\n  const itemClientWidth = carouselStyle.itemWidth + carouselStyle.spacingWidth;\r\n  const maxScrollLeft = carouselListRef.value.scrollWidth - carouselListWidth;\r\n  const nextScrollLeft = carouselListScrollLeft + carouselListWidth;\r\n  if (nextScrollLeft <= maxScrollLeft) {\r\n    const remainder = carouselListScrollLeft % itemClientWidth;\r\n    const divisible = Math.ceil(carouselListScrollLeft / itemClientWidth);\r\n    const count = remainder === 0 ? divisible + 1 : divisible;\r\n    carouselListRef.value.scrollTo({\r\n      left: count * itemClientWidth,\r\n      behavior: \"smooth\",\r\n    });\r\n  } else {\r\n    carouselListRef.value.scrollTo({\r\n      left: maxScrollLeft,\r\n      behavior: \"smooth\",\r\n    });\r\n  }\r\n};\r\n// 鼠标按下\r\nfunction handleMousedown(e) {\r\n  carouselData.isDown = true;\r\n  carouselData.startX = e.pageX - carouselListRef.value.offsetLeft;\r\n  carouselData.scrollLeft = carouselListRef.value.scrollLeft;\r\n}\r\n// 鼠标收起\r\nfunction handleMouseup() {\r\n  carouselData.isDown = false;\r\n}\r\n// 鼠标移动\r\nfunction handleMousemove(e) {\r\n  if (!carouselData.isDown) return;\r\n  e.preventDefault();\r\n  const x = e.pageX - carouselListRef.value.offsetLeft; // 获取鼠标滑动时位置\r\n  const walk = x - carouselData.startX; // 滑动距离：鼠标滑动时位置-起始位置\r\n  carouselListRef.value.scrollLeft = carouselData.scrollLeft - walk;\r\n  carouselData.scrollLeft = carouselData.scrollLeft - walk;\r\n  requestAnimationFrame(() => {\r\n    carouselListRef.value.scrollLeft = carouselData.scrollLeft;\r\n  });\r\n}\r\n// 图片预览\r\nfunction previewImage(title: string, imgList: string[], index: number) {\r\n  emits(\"emitFunc\", {\r\n    title,\r\n    imgList,\r\n    index,\r\n  });\r\n}\r\nconst empowerTimer = setInterval(function () {\r\n  if (props.empowerPromiseLink) {\r\n    clearInterval(empowerTimer);\r\n    linkPdfLinkChange();\r\n  }\r\n}, 2000);\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.empower-info {\r\n  > .title {\r\n    @include flex(center, space-between);\r\n    margin-bottom: 48px;\r\n  }\r\n\r\n  .counter-mark {\r\n    span {\r\n      padding: 5px 8px;\r\n      font-size: 12px;\r\n      font-weight: 500;\r\n      color: #2ed4a9;\r\n      line-height: 14px;\r\n      background: rgba(46, 212, 169, 0.06);\r\n      border-radius: 4px;\r\n      margin-left: 4px;\r\n\r\n      &:first-child {\r\n        margin-left: 20px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .button-group {\r\n    @include flex(center);\r\n\r\n    span {\r\n      font-size: 14px;\r\n      font-weight: 400;\r\n      color: #0056ff;\r\n      line-height: 14px;\r\n      cursor: pointer;\r\n\r\n      &::after {\r\n        content: \"|\";\r\n        width: 1px;\r\n        height: 14px;\r\n        color: #e1e4e8;\r\n        margin: 0 8px;\r\n      }\r\n\r\n      &:last-child::after {\r\n        display: none;\r\n      }\r\n    }\r\n  }\r\n}\r\n.carousel-container {\r\n  margin: 0 auto;\r\n  overflow: hidden;\r\n  &.carousel-center {\r\n    @include flex(center, center, column);\r\n  }\r\n}\r\n.carousel-list {\r\n  display: flex;\r\n  overflow-x: scroll;\r\n  scroll-behavior: smooth;\r\n  scroll-snap-type: x mandatory;\r\n  -webkit-overflow-scrolling: touch;\r\n  cursor: pointer;\r\n  &::-webkit-scrollbar {\r\n    display: none;\r\n  }\r\n}\r\n\r\n.carousel-item {\r\n  flex: 0 0 auto;\r\n  overflow: hidden;\r\n  border-radius: 8px;\r\n  border: 1px solid #e1e4e8;\r\n  &:first-child {\r\n    margin-left: 0 !important;\r\n  }\r\n  img {\r\n    display: block;\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: contain;\r\n  }\r\n}\r\n\r\n.carousel-arrow {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  width: 140px;\r\n  height: 40px;\r\n  margin: 40px auto 0;\r\n  padding: 0 20px;\r\n  font-size: 14px;\r\n  font-weight: 400;\r\n  color: #ffffff;\r\n  line-height: 14px;\r\n  background: #9ca6b9;\r\n  border-radius: 26px;\r\n  .arrow-left,\r\n  .arrow-right {\r\n    position: relative;\r\n    width: 24px;\r\n    height: 24px;\r\n    cursor: pointer;\r\n    &::after {\r\n      position: absolute;\r\n      top: 8px;\r\n      content: \"\";\r\n      width: 8px;\r\n      height: 8px;\r\n      border: 1px solid #ffffff;\r\n      border-bottom: none;\r\n    }\r\n  }\r\n  .arrow-left::after {\r\n    left: 8px;\r\n    border-right: none;\r\n    transform: rotateZ(-45deg);\r\n  }\r\n  .arrow-right::after {\r\n    right: 8px;\r\n    border-left: none;\r\n    transform: rotateZ(45deg);\r\n  }\r\n}\r\n</style>\r\n","import script from \"./empower-info.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./empower-info.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./empower-info.vue?vue&type=style&index=0&id=45559fc3&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../../../../../node_modules/.pnpm/vue-loader@17.4.2_@vue+compiler-sfc@3.5.13_vue@3.5.13_typescript@5.7.2__webpack@5.97.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-45559fc3\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_defineComponent","__name","props","empowerPromiseLink","emits","setup","__props","emit","__emit","pdfJs","workerSrc","pdfJsWorker","previewImageRef","ref","carouselListRef","carouselContainerRef","carouselData","reactive","list","isDown","startX","scrollLeft","carouselStyle","itemWidth","itemHeight","viewCount","spacingWidth","containerWidth","previewEmpowerPromise","url","window","open","ElMessage","warning","downEmpowerPromise","getFileFromUrl","then","data","downloadFile","api","URL","createObjectURL","blob","filename","linkPdfLinkChange","convertPdfToImage","file","result","async","pdfUrl","pdf","promise","canvas","document","createElement","context","getContext","imgList","i","_pdfInfo","numPages","page","getPage","viewport","getViewport","scale","width","height","render","canvasContext","imgSrc","toDataURL","push","handleArrowLeft","carouselListWidth","value","clientWidth","carouselListScrollLeft","itemClientWidth","nextScrollLeft","remainder","divisible","Math","floor","count","scrollTo","left","behavior","handleArrowRight","maxScrollLeft","scrollWidth","ceil","handleMousedown","e","pageX","offsetLeft","handleMouseup","handleMousemove","preventDefault","x","walk","requestAnimationFrame","previewImage","title","index","empowerTimer","setInterval","clearInterval","_ctx","_cache","_component_CustomPreviewImage","_resolveComponent","_openBlock","_createElementBlock","_createElementVNode","_createTextVNode","onClick","ref_key","_normalizeClass","length","style","_normalizeStyle","onMousedown","onMouseup","onMousemove","_Fragment","_renderList","item","$event","marginLeft","key","src","alt","_toDisplayString","_createVNode","__exports__"],"sourceRoot":""}